<?xml version='1.0' encoding='UTF-8'?>
<rss 
version="2.0" xmlns:iffy="http://tech.interfluidity.com/xml/iffy/" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>tech — interfluidity</title>
    <link>https://tech.interfluidity.com/index.html</link>
    <description><![CDATA[Feed for blog 'tech — interfluidity', generated by unstatic]]></description>
    <language>en-us</language>
    <lastBuildDate>Tue, 28 Jan 2025 22:12:00 -0500</lastBuildDate>
    <generator>https://github.com/swaldman/unstatic</generator>
    <docs>https://cyber.harvard.edu/rss/rss.html</docs>
    <atom:link
    type="application/rss+xml" rel="self" href="https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/index.rss"/>
    <iffy:curation>
      <iffy:single/>
    </iffy:curation>
    <iffy:completeness>Content</iffy:completeness>
    <item>
      <pubDate>Wed, 23 Aug 2023 13:15:00 -0400</pubDate>
      <guid isPermalink="true">https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/index.html</guid>
      <description>
        <![CDATA[Motivation I'm really trying to put together a synchronous collaboration environment, self-hosting as much as possible, using third-party platforms as little as possible. My first step was getting Jitsi up and running. But conversations want notes. They sometimes become collaborations that should generate documents. I have, with various interlocutors, used Zoom's chat session as a kind of weirdly structured notes environment. Zoom does support one essential feature, "Save Chat", so that the...]]>
      </description>
      <link>https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/index.html</link>
      <title>Getting started with HedgeDoc</title>
      <dc:creator><![CDATA[Steve Randy Waldman]]></dc:creator>
      <content:encoded>
        <![CDATA[<article class="presentation-rss">
 <div class="entry-header">
 </div>
 <div class="entry-body">
  <div class="flexmark markdown">
   <h2><a href="https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/#motivation" id="motivation" name="motivation" class="anchorlink"></a>Motivation</h2>
   <p>I'm really trying to put together a synchronous collaboration environment, self-hosting as much as possible, using third-party platforms as little as possible. My first step was <a href="https://tech.interfluidity.com/2023/08/21/getting-started-with-jitsi/index.html">getting Jitsi up and running</a>.</p>
   <p>But conversations want notes. They sometimes become collaborations that should generate documents.</p>
   <p>I have, with various interlocutors, used Zoom's chat session as a kind of weirdly structured notes environment. Zoom does support one essential feature, "Save Chat", so that the notes you've shared, disguised as remarks, can be retained. Jitsi does offer chat, but it's a bit unwieldy and lacks that essential save feature. Jitsi chat is really not pervertable to a notes application.</p>
   <p>I've been looking for something better, and today I found <a href="https://hedgedoc.org/">HedgeDoc</a>, which looks perfect, and pretty amazing! Give it a look. Really.</p>
   <p>So, I decided to install HedgeDoc on my new collaboration server, the same Digitial Ocean droplet on which I <a href="https://tech.interfluidity.com/2023/08/21/getting-started-with-jitsi/index.html">just installed Jitsi</a>.</p>
   <p>(I don't think HedgeDoc will be super resource intensive, though I am a bit worried that adding bells and whistles might slow down the videoconferencing core on what already is virtualized and underpowered hardware.)</p>
   <h2><a href="https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/#trepidation" id="trepidation" name="trepidation" class="anchorlink"></a>Trepidation</h2>
   <p>HedgeDoc is a <a href="https://nodejs.org/en">node.js</a> application. In general, I find node applications intimidating. Their builds seem sprawling with little JSON and YML and lock files I don't understand. They use JSON for human-edited config files, but JSON is persnicketty and allows no comments. Life is full of persnicketty config files, but when they are not JSON, they tend to be lavish with hints in comments and suggestions you can comment out or comment in. Some people <a href="https://groups.google.com/g/nodejs/c/NmL7jdeuw0M/m/yTqI05DRQrIJ">argue</a> (ht <a href="https://hachyderm.io/@llimllib/110936243164836553">Bill Mill</a>) that the cleanliness that results from a hard separation between configuration data and documentation is a feature not a bug. I myself am a bug, though, and prefer informative clutter to sterile helplessness.</p>
   <p>Anyway, maybe some day I will become a Node-knower and have opinions about <a href="https://yarnpkg.com/">yarn</a> vs <a href="https://www.npmjs.com/">npm</a> and stuff. But that day has not yet come. In the meantime, I just run mysterious incantations from the <a href="https://docs.hedgedoc.org/setup/getting-started/">installation docs</a> and marvel at just how many dependencies seem to be flowing in.</p>
   <h2><a href="https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/#installation" id="installation" name="installation" class="anchorlink"></a>Installation</h2>
   <p>I went for HedgeDoc's <a href="https://docs.hedgedoc.org/setup/manual-setup/">Manual Installation</a>. My first step was to download <code>node</code> itself. The version that came in with <code>apt install nodejs</code> was too old, so I found some instructions on <a href="https://computingforgeeks.com/how-to-install-node-js-on-ubuntu-debian/">how to</a> (easily, lazily) get <code>node.js v16</code> onto my Ubuntu 22.04 server.</p>
   <p>I took that slowly, downloading the script to a file before executing it to at least <em>glance</em> at what I'd be running as root.</p>
   <p>I'm not a big fan of <code>curl -sL https://whoknowswhat.com/script.sh | bash -</code> style installs. But any half competent malicious script-kiddie could have gotten past my cursory inspection. Of course I end up treating most of the dependecies I download as pure black boxes. I hope that <code>deb.nodesource.com</code> is trustworthy!</p>
   <p>I was also going to need a Postgres database. That was just <code>apt install postgresql</code>.</p>
   <p>Once Postgres was installed I made a user <code>hedgedoc</code>, and could perform most of the build as that not-so-terribly powerful persona. <code>hedgedoc</code> was going to be the user under whose aegis the service would be run, so I needed it to have access to a database under Postgres. So, something like...</p>
   <pre><code class="language-plaintext"># su postgres
$ createuser hedgedoc
$ psql
postgres=# CREATE DATABASE hedgedoc;
postgres=# ALTER DATABASE hedgedoc OWNER TO hedgedoc;
postgres=# &lt;ctrl-D to exit psql&gt;
$ &lt;ctrl-D to exit user postgres&gt;
# su hedgedoc
$ psql
hedgedoc=&gt; ALTER USER hedgedoc WITH PASSWORD 'not-actually-this';
</code></pre>
   <p>That last bit actually came later, as I was <a href="https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/#hitch-1-postgress-password">trying to figure out why the app couldn't connect to the database</a>. Even though under postgres' default config passwordless <code>psql</code> was fine, the node app did need a password to connect over <code>localhost</code>.</p>
   <p>Anyway, in real life, setting up the password came later, but we might as well get it over with now.</p>
   <p>OK. I love <code>postgres</code>. That was the easy stuff. Now the hard part. The node app.</p>
   <p>The instructions ask us to set up some node dependencies with <code>npm</code> in order to get <code>yarn</code> to work. (They are frenemies I guess.)</p>
   <pre><code class="language-plaintext"># npm install -g node-gyp
# npm install -g npm install -g corepack
# corepack enable
</code></pre>
   <p>Then, as user <code>hedgedoc</code>, we clone the application repository and check out tag 1.9.9, the latest release. Then, <a href="https://docs.hedgedoc.org/setup/manual-setup/">following the instructions</a>, we run a setup script.</p>
   <pre><code class="language-plaintext">$ git clone https://github.com/hedgedoc/hedgedoc.git
$ git checkout 1.9.9
$ cd hedgedoc
$ bin/setup
</code></pre>
   <p>Stuff happens.</p>
   <p>When the script is done, we have a file called <code>config.json</code> (just a copy of repository file <code>config.json.example</code>).</p>
   <p>I then did my best to configure the application. This was... hard. The <a href="https://docs.hedgedoc.org/configuration/">configuration is very elaborate</a>. I had to iterate through some snags to get it right. Plus, the example file is divided into three separate configs, one each for <code>test</code>, <code>development</code>, and <code>production</code>. I only edited <code>production</code>, but the existence of multiple configurations became the source of later confusion. (See <a href="https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/#hitch-3-registering-users-hangs">below</a>.)</p>
   <p>Anyway, with a first-draft config in hand, we can complete the build instructions:</p>
   <pre><code class="language-plaintext">$ yarn install --immutable
$ yarn build
</code></pre>
   <p>Hooray!</p>
   <h2><a href="https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/#consternation" id="consternation" name="consternation" class="anchorlink"></a>Consternation</h2>
   <p>HedgeDoc was built. The next step was getting it to work. This was an iterative process with a few hitches.</p>
   <h3><a href="https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/#hitch-1-postgress-password" id="hitch-1-postgress-password" name="hitch-1-postgress-password" class="anchorlink"></a>Hitch 1: Postgress Password</h3>
   <p>First, following the instructions, I run (as <code>hedgedoc</code>)</p>
   <pre><code class="language-plaintext">$ NODE_ENV=production yarn start
</code></pre>
   <p>I get a lot of messages indicating that the app is failing to connect to the database. My database config at this point looked like</p>
   <pre><code class="language-json">{
    "production": {
        "db": {
            "username": "hedgedoc",
            "password": "",
            "database": "hedgedoc",
            "host": "127.0.0.1",
            "port": "5432",
            "dialect": "postgres"
        }
    }
}    
</code></pre>
   <p>Since I could authenticate to <code>psql</code> locally as hedgedoc without a password under the default authentication policy (<code>see /etc/postgresql/14/main/pg_hba.conf</code>), I wondered if passwordless would be okay. Nope.</p>
   <p>So I gave <code>hedgedoc</code> a password (<code>ALTER USER hedgedoc WITH PASSWORD 'not-actually-this';</code>, see above), and retried <code>NODE_ENV=production yarn start</code>. It started up beautifully.</p>
   <h3><a href="https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/#hitch-2-proxy-through-nginx" id="hitch-2-proxy-through-nginx" name="hitch-2-proxy-through-nginx" class="anchorlink"></a>Hitch 2: Proxy through <code>nginx</code></h3>
   <p>This wasn't a hitch really. It was planned and expected. But at this point, I still couldn't see hedgedoc, which was getting served on localhost only at port 3000. The HedgeDoc docs <a href="https://docs.hedgedoc.org/guides/reverse-proxy/#nginx">very helpfully include</a> a sample <code>nginx.conf</code> for proxying the service.</p>
   <p>Before I could do much with this, I had to decide at what URL I wanted the app to be served. I decided I'd make a separate virtual host for it, <code>notes.interfluidity.com</code>.</p>
   <p>So, I updated my DNS for interfluidity with a <code>CNAME</code> record pointing back to <code>loiter.interfluidity.com</code>, then used <code>certbot</code> / Let's Encrypt to get certificates for the new name (briefly stopping <code>nginx</code> so I could authenticate with certbot's internal web service):</p>
   <pre><code class="language-plaintext"># systemctl stop nginx
# certbot certonly -d notes.interfluidity.com
# systemctl start nginx
</code></pre>
   <p>Now I could copy the <code>nginx</code> proxy setup from the docs to <code>/etc/nginx/sites-available/notes.interfluidity.com.conf</code>, and edit it to fill in the new certificate locations. Initially this failed, because the reference config contained references to other ssl config I didn't have.</p>
   <pre><code class="language-plaintext">    include options-ssl-nginx.conf;
    ssl_dhparam ssl-dhparams.pem;
</code></pre>
   <p>I replace the first line with SSH config I have from elsewhere, and just omit (as I usually do, <a href="https://security.stackexchange.com/questions/94390/whats-the-purpose-of-dh-parameters">is this bad?</a>) the <code>ssl_dhaparam</code> directive.</p>
   <p>I also needed to add a stanza to redirect traffic from port 80 (regular <code>http</code>) to <code>https</code> at port 443.</p>
   <p>Ultimately, <code>/etc/nginx/sites-available/notes.interfluidity.com.conf</code> looks <a href="https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/#nginxconf">like this</a>.</p>
   <h3><a href="https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/#hitch-3-registering-users-hangs" id="hitch-3-registering-users-hangs" name="hitch-3-registering-users-hangs" class="anchorlink"></a>Hitch 3: Registering users hangs</h3>
   <p>This one befuddled me for a while. I don't want my HedgeDoc installation to be an open utility for anyone one the internet. So I have it configured to not permit web registation of new users. In <code>config.json</code>, at this point, I had</p>
   <pre><code class="language-json">{
    "test": {
        "db": {
            "dialect": "sqlite",
            "storage": ":memory:"
        },
        "linkifyHeaderStyle": "gfm"
    },
    "development": {
        "loglevel": "debug",
        "db": {
            "dialect": "sqlite",
            "storage": "./db.hedgedoc.sqlite"
        },
        "domain": "localhost",
        "urlAddPort": true
    },
    "production": {
        ...
        "email": true,
        "allowEmailRegister": false,
        "allowAnonymous": false,
        "allowAnonymousEdits": true,
	...
    }
}    
</code></pre>
   <p>Googling around, absent web registration of e-mails or using a third-party to authenticate, the way to set up new users is a utility bundled in the HedgeDoc distribution, <code>bin/manage_user</code>.</p>
   <pre><code class="language-plaintext">$ bin/manage_users 
You did not specify either --add or --del or --reset!

Command-line utility to create users for email-signin.

Usage: bin/manage_users [--pass password] (--add | --del) user-email
	Options:
		--add 	Add user with the specified user-email
		--del 	Delete user with specified user-email
		--reset Reset user password with specified user-email
		--pass	Use password from cmdline rather than prompting
</code></pre>
   <p>But when I try</p>
   <pre><code class="language-plaintext">$ bin/manage_users --pass NotGonnaTellYou --add swaldman@mchange.com
</code></pre>
   <p>I find that the script... just hangs.</p>
   <p>I have to <code>&lt;ctrl-c&gt;</code> to kill it. It provides no messages or information.</p>
   <p>Reviewing the script, its first few lines are</p>
   <pre><code class="language-javascript">#!/usr/bin/env node                                                                                                                                                                      

// First configure the logger, so it does not spam the console                                                                                                                           
const logger = require('../lib/logger')
logger.transports.forEach((transport) =&gt; transport.level = 'warning')
</code></pre>
   <p>The trick to making <code>bin/manage_users</code> informative was just commenting out the lines about the logger, so that it DOES spam the console.</p>
   <pre><code class="language-javascript">#!/usr/bin/env node                                                                                                                                                                      

// First configure the logger, so it does not spam the console                                                                                                                           
//const logger = require('../lib/logger')
//logger.transports.forEach((transport) =&gt; transport.level = 'warning')
</code></pre>
   <p>Messages then result, which renders our problem easy to diagnose. The script tries and fails to hit an <code>sqlite</code> database, because it was using the <code>development</code> rather than <code>production</code> config. (See the early <code>config.json</code> fragment above.)</p>
   <p>To solve this, it's just...</p>
   <pre><code class="language-plaintext">$ NODE_ENV=production bin/manage_users --pass NotGonnaTellYou --add swaldman@mchange.com 
</code></pre>
   <p>With the script's logger still commented out to encourage verbosity, this yields...</p>
   <pre><code class="language-plaintext">023-08-23T00:42:46.127Z warn: 	Neither 'domain' nor 'CMD_DOMAIN' is configured. This can cause issues with various components.
Hint: Make sure 'protocolUseSSL' and 'urlAddPort' or 'CMD_PROTOCOL_USESSL' and 'CMD_URL_ADDPORT' are configured properly.
2023-08-23T00:42:46.130Z warn: 	Session secret not set. Using random generated one. Please set `sessionSecret` in your config.json file. All users will be logged out.
2023-08-23T00:42:46.137Z error: 	uncaughtException: Dialect needs to be explicitly supplied as of v4.0.0
</code></pre>
   <p>I configure</p>
   <pre><code class="language-plaintext">{
    ...
    "production": {
        "domain": "notes.interfluidity.com",
	...,
        "sessionSecret": "Not-Gonna-Tell-You-64-Chars-Long-Though-I-Don't-Think-That's-Obligatory",
	...
    }
}
</code></pre>
   <p>Then</p>
   <pre><code class="language-plaintext">$ NODE_ENV=production bin/manage_users --pass NotGonnaTellYou --add swaldman@mchange.com 
</code></pre>
   <p>succeeds.</p>
   <pre><code class="language-plaintext">2023-08-23T00:42:59.833Z debug: 	dmp worker process started
Using password from commandline...
Created user with email swaldman@mchange.com
</code></pre>
   <p>But I should have paid more attention to that hint!</p>
   <pre><code class="language-plaintext">Hint: Make sure 'protocolUseSSL' and 'urlAddPort' or 'CMD_PROTOCOL_USESSL' and 'CMD_URL_ADDPORT' are configured properly.
</code></pre>
   <h3><a href="https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/#hitch-4-login-form-wont-submit" id="hitch-4-login-form-wont-submit" name="hitch-4-login-form-wont-submit" class="anchorlink"></a>Hitch 4: Login form won't submit</h3>
   <p>When I run it from the command line, the web application is now served at <code>notes.interfluidity.com</code>. I've succeeded at registering myself as a user. I hit the sign-in button, and a login form appears. but when I hit <code>submit</code>, nothing at all happens.</p>
   <p>To get any information at all about this, I needed to go to the Javascript console of my browser.</p>
   <p>There, only there, I could see log messages about the problem, noting security policy violations. The form was only allowed to hit the app that served it, the app that served it was <code>https://notes.interfluidity.com/</code>. But the form was trying to hit <code>http://notes.interfluidity.com/</code>.</p>
   <p>Spot the difference? It's <code>https</code> vs <code>http</code>.</p>
   <p>The solution was to add a <a href="https://docs.hedgedoc.org/configuration/">config parameter</a>...</p>
   <pre><code class="language-plaintext">{
    ...
    "production": {
	...,
        "protocolUseSSL": true,
	...
    }
}
</code></pre>
   <p>Now I can login!</p>
   <h2><a href="https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/#consummation" id="consummation" name="consummation" class="anchorlink"></a>Consummation</h2>
   <p>At this point, everything basically works. After the problems <a href="https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/#hitch-3-registering-users-hangs">introduced</a> by accidentally hitting the <code>development</code> config, I decide to clean away the unused configurations (<code>debug</code>, <code>development</code>) from <code>config.json</code>. The final (well, current) version is <a href="https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/#final-config-json">below</a>.</p>
   <p>I want HedgeDoc to be a permanent, <code>systemd</code> managed service, so I copy and modify the <a href="https://docs.hedgedoc.org/setup/manual-setup/#systemd-unit-example">unit file example the documentation helpfully supplies</a>. I have to uncomment the <code>After=postgresql.service</code> line, modify the <code>WorkingDirectory</code> to point to the location of my HedgeDoc build (which is not in <code>opt</code>), and comment out <code>ProtectHome=true</code> (because my HedgeDoc build is in fact in user <code>hedgedoc</code>'s home directory).</p>
   <p>Then it's just the usual, a symlink to the unit file from <code>/etc/systemd/system</code>, and then...</p>
   <pre><code class="language-plaintext"># systemctl enable hedgedoc
# systemctl start hedgedoc
</code></pre>
   <p>(It took a couple of rounds of editing the unit file to get the startup to succeed. Mostly I had to <a href="https://askubuntu.com/questions/1419541/trying-to-set-up-a-systemd-service-keep-getting-changing-to-the-requested-work">figure out</a> to comment out <code>ProtectHome=true</code>.)</p>
   <p>HedgeDoc offers a lot of integrations. One feature which I like is you can export your markdown documents into GitHub gists. I followed <a href="https://docs.hedgedoc.org/guides/auth/github/">these instructions</a>, and gist export worked with no trouble.</p>
   <p>That's it! Everything seems golden!</p>
   <h2><a href="https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/#security-considerations" id="security-considerations" name="security-considerations" class="anchorlink"></a>Security considerations</h2>
   <p>HedgeDoc's documentation is admirably security conscious, and its defaults are unusually tight. I made a few choices that involved weakening those defaults:</p>
   <ul>
    <li>
     <p>I've configured <code>csp.allowFraming</code> to <code>true</code>. I intend for my "collaboration server" to take the form of a palette of multiple apps embedded on a webpage in <code>iframe</code>s. Each frame would be maximizable, or you could view work with multiple frames at once. So I really want HedgeDoc to work from an iframe.</p>
     <ul>
      <li>The <a href="https://docs.hedgedoc.org/configuration/">docs</a> "<strong>strongly recommend disabling</strong> this option, as it increases the attack surface of XSS attacks." (Their emphasis!) If users do choose to enable framing, the docs <a href="https://docs.hedgedoc.org/faq/">recommend</a> serving over <code>https</code> and setting a <code>cookiePolicy</code> of <code>none</code>, which we do. So identification is by SSL session information, and there is no cookie to steal. I feel pretty okay with this, but what am I missing?</li>
     </ul></li>
    <li>
     <p>As discussed above, I don't set <a href="https://security.stackexchange.com/questions/94390/whats-the-purpose-of-dh-parameters"><code>ssl_dhparam</code></a>) in my SSH config. I've never encountered this before, but now I wonder whether I shouldn't get in the habit of setting this up across the sites I maintain. How much does it matter?</p></li>
    <li>
     <p>I often build services beneath the home directory of the user I create to run them. They are not run on machines on which users are likely to store sensitive personal information in home directories, but given the existence of the <code>systemd</code> <code>ProtectHome</code> restriction, perhaps it's a bad habit that I should revise?</p></li>
   </ul>
   <p>I also remain concerned about the promiscuity of the <code>node</code> dependency ecosystem, and the possibility of supply chain attacks. I'm concerned about that across ecosystems: The JVM world in which I typically develop carries some of the same risks.</p>
   <p>But the problem is <a href="https://timotijhof.net/posts/2019/protect-yourself-from-npm/">arguably worse in the node ecosystem</a>. I'm not running in <code>docker</code> containers or <code>chroot</code> or anything like that.</p>
   <p>The Digital Ocean droplet I am running on is pretty low-stakes in terms of the information it stores, but it wouldn't be great if some third party gave themselves access and could join a botnet or spy on videoconferences or read all the meeting notes.</p>
   <p>Running <code>npm -g install</code> as root, which I did do, feels partcularly ill-advised and dirty. I think I'll try to avoid that in the future.</p>
   <h2><a href="https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/#update-2023-10-20" id="update-2023-10-20" name="update-2023-10-20" class="anchorlink"></a>Update 2023-10-20</h2>
   <p>I use my HedgeDoc's instance as a notes platform for weekly meetings, and I want the notes to be created in advance, so that people can suggest agenda items in advance. I want to automate this.</p>
   <p>HedgeDoc does offer <a href="https://docs.hedgedoc.org/dev/api/">an API</a> by which one can automate creation of new notes. So, the first thing I did was get comfortable using that by <a href="https://github.com/swaldman/scalascripts-misc/blob/main/bin/hedgedoc-new-note">writing a script</a> to create a new note.</p>
   <p>However, I hit another snag. I want the notes to be freely editable upon creation (so that the people my automaton notifies about the new notes can add their agenda items). As far as I can tell, HedgeDoc's API does not offer any means of setting note permissions.</p>
   <p>Fortunately, in HedgeDoc's <a href="https://docs.hedgedoc.org/configuration/">config file</a>, there is a <code>defaultPermission</code> key. Until now, I've not been using it, so the default <code>defaultPermission</code> defaulted to <code>editable</code>.</p>
   <p>I've just inserted this key explicitly in the config file, with the value <code>freely</code>. It seems to work! New notes I make (via the API or in the app) are now freely editable by default, as I want.</p>
   <p>It would be better if there were an API to reset permissions. I'd love to automate setting notes to <code>locked</code> after my meetings.</p>
   <hr>
   <h2><a href="https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/#appendix" id="appendix" name="appendix" class="anchorlink"></a>Appendix</h2>
   <h3><a href="https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/#final-configjson" id="final-configjson" name="final-configjson" class="anchorlink"></a>final config.json</h3>
   <pre><code class="language-plaintext">{
    "production": {
        "domain": "notes.interfluidity.com",
        "protocolUseSSL": true,
        "email": true,
        "allowEmailRegister": false,
        "host": "localhost",
        "allowAnonymous": false,
        "allowAnonymousEdits": true,
        "allowFreeURL": true,
        "loglevel": "info",
        "hsts": {
            "enable": true,
            "maxAgeSeconds": 31536000,
            "includeSubdomains": true,
            "preload": true
        },
        "csp": {
            "enable": true,
            "directives": {
            },
            "upgradeInsecureRequests": "auto",
            "addDefaults": true,
            "addDisqus": false,
            "addGoogleAnalytics": false,
            "allowFraming": true
        },
        "cookiePolicy": "none",
        "db": {
            "username": "hedgedoc",
            "password": "Not-Gonna-Tell-You",
            "database": "hedgedoc",
            "host": "127.0.0.1",
            "port": "5432",
            "dialect": "postgres"
        },
        "sessionSecret": "Not-Gonna-Tell-You",
        "github": {
            "clientID": "Not-Gonna-Tell-You",
            "clientSecret": "Not-Gonna-Tell-You"
        }
    }
}
</code></pre>
   <h3><a href="https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/#nginxconf" id="nginxconf" name="nginxconf" class="anchorlink"></a>nginx.conf</h3>
   <pre><code class="language-plaintext"># modified from https://docs.hedgedoc.org/guides/reverse-proxy/

map $http_upgrade $connection_upgrade {
        default upgrade;
        ''      close;
}
server {
    listen 80;
    listen [::]:80;
    server_name notes.interfluidity.com;

    location / {
        return 301 https://$host$request_uri;
    }
}
server {
        server_name notes.interfluidity.com;

        location / {
                proxy_pass http://127.0.0.1:3000;
                proxy_set_header Host $host; 
                proxy_set_header X-Real-IP $remote_addr; 
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 
                proxy_set_header X-Forwarded-Proto $scheme;
        }

        location /socket.io/ {
                proxy_pass http://127.0.0.1:3000;
                proxy_set_header Host $host; 
                proxy_set_header X-Real-IP $remote_addr; 
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 
                proxy_set_header X-Forwarded-Proto $scheme;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection $connection_upgrade;
        }

    listen [::]:443 ssl http2;
    listen 443 ssl http2;
    ssl_certificate /etc/letsencrypt/live/notes.interfluidity.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/notes.interfluidity.com/privkey.pem;

    # Mozilla Guideline v5.4, nginx 1.17.7, OpenSSL 1.1.1d, intermediate configuration
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;

    ssl_session_timeout 1d;
    ssl_session_cache shared:SSL:10m;  # about 40000 sessions
    ssl_session_tickets off;
}
</code></pre>
  </div>
 </div>
 <div class="entry-footer">
  <div class="post-metainfo">
   <hr>
   <div>
    by Steve Randy Waldman on 2023-08-23 @ <a href="https://tech.interfluidity.com/2023/08/23/getting-started-with-hedgedoc/index.html" class="pubtime">01:15 PM EDT</a>
   </div>
  </div>
 </div>
</article>
<div class="after-article">
</div><!-- after-article -->]]>
      </content:encoded>
    </item>
  </channel>
</rss>
