<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="description" content="tech notebook @ interfluidity">
    <meta name="keywords" content="Scala, tech, interfluidity">
    <meta name="author" content="Steve Randy Waldman">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- icons / favicons -->

    <!-- we just want the squared-corner image with no overlays for traditional favicon uses at tiny sizes -->
    <!-- swaldman added, ick, firefox scales down the biggest size for its tab icon, so we use the graphic we want for small sizes as the largest... -->
    <link rel="icon" type="image/png" sizes="500x500" href="icon/interfluidity-wave-blank-square-500x500.png"> 
    <link rel="icon" type="image/png" sizes="32x32" href="icon/interfluidity-wave-blank-square-32x32.png">     <!-- swaldman added, for standard favicon size -->
    <link rel="icon" type="image/png" sizes="16x16" href="icon/interfluidity-wave-blank-square-16x16.png">     <!-- swaldman added, for standard favicon size -->
    <link rel="icon" type="image/png" href="icon/interfluidity-wave-blank-square-57x57.png">                   <!-- swaldman added, for small icons by default -->

    <!-- at bigger sizes, we overlay a bit of text -->
    <!-- icons as recommened by https://mathiasbynens.be/notes/touch-icons -->
    <!-- For Chrome for Android: -->
    <link rel="icon" sizes="192x192" href="icon/interfluidity-wave-tech-192x192.png">
    <!-- For iPhone 6 Plus with @3× display: -->
    <link rel="apple-touch-icon-precomposed" sizes="180x180" href="icon/interfluidity-wave-tech-180x180.png">
    <!-- For iPad with @2× display running iOS ≥ 7: -->
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="icon/interfluidity-wave-tech-152x152.png">
    <!-- For iPad with @2× display running iOS ≤ 6: -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="icon/interfluidity-wave-tech-144x144.png">
    <!-- For iPhone with @2× display running iOS ≥ 7: -->
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="icon/interfluidity-wave-tech-120x120.png">
    <!-- For iPhone with @2× display running iOS ≤ 6: -->
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="icon/interfluidity-wave-tech-114x114.png">
    <!-- For the iPad mini and the first- and second-generation iPad (@1× display) on iOS ≥ 7: -->
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="icon/interfluidity-wave-tech-76x76.png">
    <!-- For the iPad mini and the first- and second-generation iPad (@1× display) on iOS ≤ 6: -->
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="icon/interfluidity-wave-tech-72x72.png">
    <!-- For non-Retina iPhone, iPod Touch, and Android 2.1+ devices: -->
    <link rel="apple-touch-icon-precomposed" href="icon/interfluidity-wave-blank-square-57x57.png">

    <!-- end icons / favicons -->
    
    <link rel="alternate" type="application/rss+xml" title="tech.interfluidity.com updates" href="feed/index.rss">
    <link rel="alternate" type="application/x-all-item-rss+xml" title="tech.interfluidity.com - all items" href="https://tech.interfluidity.com/all-item-feed/index.rss">
    <link rel="alternate" type="application/rss+xml" title="interfluidity - all blogs" href="https://www.interfluidity.com/unify-rss/all-blogs.rss">
    <link rel="alternate" type="application/rss+xml" title="interfluidity - all blogs and microblogs" href="https://www.interfluidity.com/unify-rss/all-blogs-and-microblogs.rss">
    
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/highlightjs/steve-night-owl.css"><!-- theme for highlight.js -->
    <script src="js/highlight/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
          const regex = /(^.*)\-oldcommit\-[0-9A-Fa-f]+\.html/;
          const match = window.location.pathname.match(regex);
          if (match) {
              const b  = document.querySelector("body");
              const tb = document.getElementById("top-banner");
              b.classList.add("old-draft");
              tb.innerHTML = "You are looking at an old, superceded version of this page. For the current version, please <a href=\"" + match[1] + ".html\">click here</a>.";
          }
       });
    </script>
    <title>tech &mdash; interfluidity</title>
  </head>
  <body>
    <div id="top-banner"></div>
    <div id="header">
      <div id="rss-link-container">
        <a id="rss-link" href="feed/index.rss"><span class="outer">(</span><span class="middle">(</span><span class="inner">(</span><span class="bullet">&bull;</span><span class="inner">)</span><span class="middle">)</span><span class="outer">)</span></a>
      </div>
      <div class="main-title"><a href="https://tech.interfluidity.com/">tech.interfluidity.com</a></div>
      <div class="tagline">a notebook by <a href="https://www.interfluidity.com/">steve&nbsp;randy&nbsp;waldman</a></div>
      <div class="see-also">&rarr; See also <a href="index.html">top</a>, <a href="archive.html">archive</a>, <a href="subscribe.html">subscribe</a>, <a href="https://drafts.interfluidity.com/">drafts blog</a>, <a href="https://www.interfluidity.com/">interfluidity main</a></div>
    </div>
    <div id="main">
      <div id="left-sidebar">
      </div>
      <div id="content">
        <div class="day-stamp">
 2025-04-03 <span class="arrow">⇒</span>
</div>
<article class="presentation-multiple synthetic">
 <div class="entry-header">
  <h1><a href="2024/06/06/neonix/index-updated-2025-04-03-21-10-00.html">Updated: Neonix</a></h1>
  <hr class="below-title">
 </div>
 <div class="entry-body">
  <p>A significant update of <a href="2024/06/06/neonix/index.html"><i>Neonix</i></a> was made on 2025-04-03 @ 09:10 PM EDT.</p>
  <blockquote>
   → Add update regarding 'gum', ht Bill Mill
  </blockquote>
  <p>The post was originally published 2024-06-06 @ 03:35 PM EDT.</p>
 </div>
 <div class="entry-footer">
  <div class="post-metainfo">
   <div class="synthetic-note">
    <em>This is an automatically generated post.</em>
   </div>
   <div>
    <a href="2024/06/06/neonix/index-updated-2025-04-03-21-10-00.html" class="pubtime">09:10 PM EDT</a>
   </div>
  </div>
 </div>
</article>
<div class="after-article">
</div><!-- after-article --><div class="entry-separator"></div><div class="day-stamp">
 2025-01-28 <span class="arrow">⇒</span>
</div>
<article class="presentation-multiple uid-adolescent-deepseek-on-a-mac-laptop">
 <div class="entry-header">
  <h1><a href="2025/01/28/adolescent-deepseek-on-a-mac-laptop/index.html">Adolescent DeepSeek on a Mac laptop</a></h1>
  <hr class="below-title">
 </div>
 <div class="entry-body">
  <div class="flexmark markdown">
   <p><strong>TL; DR:</strong> DeepSeek-R1-14B seems pretty "smart". For tasks that, um, don't involve syllable counting, it might be sophisticated enough to be useful. (Or not! It'd take more experimentation to decide.)</p>
   <p>But it runs too slowly on my 5-year-old Intel-based MacBookPro, even tricked out with 64GB of RAM. Smaller models run with better performance, but the result quality is likely too poor to be useful. For whatever I do with LLMs, I'm afraid I'm stuck with the online services for now.</p>
   <hr>
   <p>In the <a href="2025/01/28/baby-deepseek-on-on-mac-laptop/index.html">previous post</a> I ran the "baby" <a href="https://www.deepseek.com/">DeepSeek</a> generative AI model on my Mac laptop.</p>
   <p>(For instructions on how I installed <code>ollama</code>, and information about its basic use, see that <a href="2025/01/28/baby-deepseek-on-on-mac-laptop/index.html">previous post</a> and its postscript.)</p>
   <p>The model ran fine, used a lot of CPU but not a lot of memory, generated output at a reasonable pace. Unfortunately, that model is not so "smart". It tells you how it's thinking, and it's not thinking very well. It misunderstands simple things and draws poor inferences.</p>
   <p>So now I've decided to try out a still small but bigger, less toy-ish model. The baby model had 1.5B parameters. This one has 14B, so almost 10 times as big.</p>
   <p>Downloading the model was trivial with <code>ollama</code>:</p>
   <pre><code class="language-plaintext">% ollama pull deepseek-r1:14b
</code></pre>
   <p>It's actually a bit less 10 times as big as the baby model, which was about 1GB. Presumably there's some shared, fixed infrastructure, beyond the parameters. (I'm storage constrained, so I'm not retaining models in <code>~/.ollama</code>, there's just the one model there.)</p>
   <pre><code class="language-plaintext">% du -sh ~/.ollama
8.4G	/Users/swaldman/.ollama
</code></pre>
   <p>Running the model was also trivial:</p>
   <pre><code class="language-plaintext">% ollama run deepseek-r1:14b
&gt;&gt;&gt; Send a message (/? for help)
</code></pre>
   <p>I first tried the same prompt as yesterday, "Write a 'Hello, world!' haiku."</p>
   <p>The model did run, but...</p>
   <ol>
    <li>
     <p>It ran very, very slowly. The "baby" model ran quite briskly on my laptop. The 14B-parameter version ran like syrup.</p></li>
    <li>
     <p>The compute load was similar (5-6 full cores saturated), but this model also occupied ~10GB of memory when running. The 1.5B-parameter version used too little memory for me to notice or care.</p></li>
   </ol>
   <p>The 1.5B-parameter model failed to generate a haiku before I grew frustrated and quit it. The 14B-parameter also ultimately failed.</p>
   <p>I think I chose a hard "Hello, world!" prompt for all of these models! Haikus are defined by lines with set numbers of syllables. The 1.5B-parameter model mistook letters for syllables. The 14B parameter mostly (but not always!) correctly identified syllables, but often miscounted them.</p>
   <p>Even though it too ultimately went 'round and 'round until I interrupted it, the 14B-parameter model's <code>&lt;think&gt;...&lt;/think&gt;</code> process was much more relevant and coherent than the <a href="2025/01/28/baby-deepseek-on-on-mac-laptop/index.html">1.5B-parameter model</a>:</p>
   <pre><code class="language-plaintext">&gt;&gt;&gt; Write a 'Hello, world!' haiku.
&lt;think&gt;
Okay, so I need to write a 'Hello, world!' haiku. Hmm, I remember that a haiku is a traditional Japanese poem with three lines. The structure is usually 5 syllables in the first line, then 7 syllables in the second, and ending with another 5 syllables. 

Alright, so the theme here is "Hello, world!" which is pretty much about greeting the world or introducing oneself. I should think of imagery that represents a welcoming or introductory moment.

Let me brainstorm some words related to saying hello and the world. Maybe morning, sunrise, nature sounds like a good setting for a greeting. Dawn could symbolize a new beginning or a fresh start, which fits with saying hello to the world.

For the first line, I want something that captures attention and sets the scene. "Hello, gentle dawn" comes to mind. That's 5 syllables: He-ll-o, gen-tle, dawn. Yep, that works.

Next, the second line needs to be 7 syllables and connect with the first line while expanding on the theme. I want something that shows interaction or response from the world. Maybe "The world whispers back." Let's count: The -world-whis-pers-back. That's 5 syllables? Wait, no. Let me 
break it down.

"The" (1), "world" (2), "whis-pers" (3), "back" (4). Oh, only 4 syllables. Hmm, I need three more. Maybe rephrase it. How about "The world hums a welcome"? That's 6 syllables: The-world-hums-a-wel-come. Wait, that might be stretching it.

Alternatively, "The world greets me softly." Let's see: the (1), world (2), greets (3), me (4), soft-ly (5). No, still not 7. Maybe "The world responds with a smile." That's longer but syllables-wise: The (1), world (2), re-sponds (3), with (4), a (5), smile (6). Still only 6.

Wait, maybe I'm overcomplicating it. Let me think of the action after the hello. Maybe something like "A new day begins." But that's more about the day starting. Alternatively, "Echoes of greeting fill the air." That's longer than 7 syllables though.

Hmm, perhaps "The world says hello too." Wait, let me count: The (1), world (2), says (3), hel-lo (4), too (5). No, that's only 5. I need two more syllables. Maybe "The world hums in reply." That's He-world-hums-in-reply. Let me break it down: the (1), world (2), hums (3), in (4), re ply 
(5 and 6). Wait, no, that's only 6.

Wait, maybe I can use "The world answers back." The (1), world (2), an-sers (3), back (4). That's 4 syllables. Not enough. Hmm.

Alternatively, think about nature sounds. Maybe "Birds sing in reply." That's 7 syllables: Birds (2), sing (1), in (1), reply (2). Wait, that doesn't add up. Let me count each word as syllables:

"Birds" - 1
"sing" - 1
"in" -1
"reply" -2

Total: 5. Not enough.

Wait, perhaps "Birdsong answers back." That's 7 syllables: Bird-song (2), an-swers (2), back (1). Wait, no:

"Birdsong" is two syllables, "answers" is two, "back" is one. Total 5 again.

I'm getting stuck on the second line. Maybe I should think of something else. How about a sunrise? "Sunrise breaks the silence." That's 7 syllables: Sun-rise (2), breaks (1), the (1), si-lence (2). Wait, that adds up to 6 syllables.

Wait, no: Sunrise is two, breaks is one, the is one, silence is two. Total 6. Hmm.

Alternatively, "Gentle breeze returns." That's 7? Gentle (2), breeze (1), re-turns (2). Wait, gentle is two syllables, breeze is one, returns is two: total 5.

Hmm, maybe I'm overcomplicating. Let me try to think differently. Maybe the second line can be about reaching out or communication. "I reach out to you." That's 6 syllables: I (1), rea-ech (2), out (1), to (1), you (1). No, that's only 5.

Wait, maybe "I send a greeting far and wide." That's way too long. Let me think about natural elements again. Maybe water? "Waves whisper hello." That's waves (1), whisper (2), hel-lo (2). Wait: waves (1), whisper (2), hello (2). Total 5 syllables, but I need 7.

Alternatively, "Ripples greet the shore." Ripples (2), greet (1), the (1), shore (1). That's 5 again.

I'm getting a bit stuck. Let me look back at the first line: "Hello, gentle dawn." Maybe the second line can continue that imagery. Dawn brings light, so perhaps something like "Light breaks the silence." That's 6 syllables: Light (1), breaks (1), the (1), si-lence (2). Total 5 again.

Wait, maybe "Dawn greets the morning sky." That's dawn (1), greets (1), the (1), morn-ing (2), sky (1). Total is 6 syllables. Hmm.

Alternatively, "A new day starts with a smile." New (1), day (1), starts (1), with (1), a (1), smile (1). That's 6.

I'm still not hitting that 7-syllable mark for the second line. Maybe I should try something else. How about focusing on the feeling of greeting? "Heart beats in rhythm." Heart (1), beats (1), in (1), rhyth-m (2). Total is 5.

Wait, maybe "Echoes fill the air." Echoes (2), fill (1), the^C
</code></pre>
   <p>As before, my next step was to see if the model could code a simple "Hello, world!" program in Scala. The 1.5B-parameter model failed abysmally. Even when presented with compiler errors, and then my suggestions to tutor it, it was not making progress towards a correct solution.</p>
   <p>The 14B parameter produced a correct program on its first attempt. It's <code>&lt;think&gt;...&lt;/think&gt;</code>-ing was not perfect, but was mostly pretty good.</p>
   <pre><code class="language-plaintext">&gt;&gt;&gt; Please write a Scala program that prints "Hello, world!"
&lt;think&gt;
Okay, I need to write a Scala program that prints "Hello, world!". Hmm, where do I start? Well, I know that in Scala, you can print something using the println function. So maybe I just call println("Hello, world!")?

Wait, but how does aScala script work? Do I need to have an object or is it simpler than that? Oh right, for a simple program like this, I think you can just write it in a single line. But wait, when compiling with scalac, do I need to structure it as an object?

Let me think. If I'm writing a script, maybe I can use the main method inside an object. So perhaps the code should be something like:

object HelloWorld {
  def main(args: Array[String]): Unit = {
    println("Hello, world!")
  }
}

Yes, that makes sense. Because when you run a Scala program, it looks for an object with a main method. So this structure is correct.

Alternatively, I remember that in older versions of Scala, you could just write the code without defining an object if using the scalaz script compiler or something like that. But perhaps the more standard way is to define an object with the main method.

So putting it all together, the code should be an object named HelloWorld (or any name really), and inside the main function, we call println with the desired string.

Let me double-check: When I run this program, either by compiling with scalac and then running with scala, or using a Scala IDE, it should print "Hello, world!" correctly. Yeah, that should work.
&lt;/think&gt;

To write a Scala program that prints "Hello, world!", follow these steps:

1. **Create a new file** for your Scala program. It can be named `HelloWorld.scala`.

2. **Write the code**: The code will define an object with a main method that calls `println` to output the desired message.

Here's the complete Scala code:

```scala
object HelloWorld {
  def main(args: Array[String]): Unit = {
    println("Hello, world!")
  }
}
``` 

3. **Run the program**:
   - **Using the command line**:
     - Compile the file using `scalac HelloWorld.scala`.
     - Run it with ` scala HelloWorld`.
   - **Using an IDE**: Simply run the script through your preferred Scala IDE.

This program will output:

``` 
Hello, world!
``` 
</code></pre>
   <p>And so it did.</p>
   <pre><code class="language-plaintext">% scala-cli run hello-ds14b.scala 
Compiling project (Scala 3.6.3, JVM (17))
Compiled project (Scala 3.6.3, JVM (17))
Hello, world!
</code></pre>
   <p>Since it got it right, I thanked it! Its "thought-process" in response was kind of fun:</p>
   <pre><code class="language-plaintext">&gt;&gt;&gt; Great! Thank you.
&lt;think&gt;
Alright, so the user just thanked me for the previous explanation on writing a "Hello, world!" program in Scala. They were probably satisfied with the answer, but I should think about how to respond appropriately. 

I want to be polite and encouraging, so I'll acknowledge their gratitude. Maybe add an emoji to keep it friendly. Also, since they might be new to programming orScala, offering further help is a good idea. I can ask if there's anything else they need assistance with.

Hmm, perhaps I should also provide options for what they might want next—like solving another problem or explaining more concepts. That way, it shows I'm ready to assist them in various ways.

I should keep the response concise and positive, making sure they feel comfortable asking more questions if needed.
&lt;/think&gt;

You're welcome! If you have any other questions or need help with anything else, feel free to ask! 😊
</code></pre>
   <hr>
   <p>I really want to do whatever AI-using I eventually do on my own infrastructure, or infrastructure of someone I trust, rather than a distant megafirm. But this current family of models, on my current best hardware, won't get me there.</p>
   <p>Sometime soon I may upgrade to an Apple Silicon Mac, and then retry these exercises.</p>
   <p>I'd consider a cloud server I rent and fully control (as opposed to API access) "my own infrastructure", but cloud servers with the resources of my laptop are too pricey for me, for now. The trendy AI-ready GPU-endowed servers some cloud providers are renting are way beyond my price point.</p>
   <p>So, for now, I think I'm stuck with the megafirms, to the degree that I use this stuff at all. But the DeepSeek models are a big step closer towards LLMs more consistent with our independence, and I'm grateful for that.</p>
  </div>
 </div>
 <div class="entry-footer">
  <div class="post-metainfo">
   <div>
    <a href="2025/01/28/adolescent-deepseek-on-a-mac-laptop/index.html" class="pubtime">10:00 PM EST</a>
   </div>
  </div>
 </div>
</article>
<div class="after-article">
</div><!-- after-article --><div class="entry-separator"></div><article class="presentation-multiple uid-baby-deepseek-on-a-mac-laptop">
 <div class="entry-header">
  <h1><a href="2025/01/28/baby-deepseek-on-on-mac-laptop/index.html">Baby DeepSeek on a Mac laptop</a></h1>
  <hr class="below-title">
 </div>
 <div class="entry-body">
  <div class="flexmark markdown">
   <p><strong>TL; DR:</strong> It's really fun to watch DeepSeek-R1-1.5B, <code>&lt;think&gt;...&lt;/think&gt;</code>.</p>
   <p>But this tiniest DeepSeek model is, um, not so smart. It seems to misinterpret the prompt input a fair amount, and draws inferences that are not quite coherent, even though in some superficial but nonsensical way you can understand the connections it's drawing.</p>
   <hr>
   <p>For the heck of it, I decided to try to run the smallest <a href="https://www.deepseek.com/">DeepSeek</a> generative AI model on my laptop. My laptop is an Intel MacBook Pro purchased in 2020 (but I think a 2019 model), 8 cores. It's tricked out with 64GB of memory.</p>
   <p>After checking out a <a href="https://www.digitalocean.com/community/tutorials/deepseek-r1-gpu-droplets">DigitalOcean tutorial</a> for clues, Running the model was beyond trivial:</p>
   <pre><code class="language-plaintext">% brew install ollama
% brew services start ollama
% ollama run deepseek-r1:1.5b
pulling manifest 
pulling aabd4debf0c8... 100% ▕██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏ 1.1 GB                         
pulling 369ca498f347... 100% ▕██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏  387 B                         
pulling 6e4c38e1172f... 100% ▕██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏ 1.1 KB                         
pulling f4d24e9138dd... 100% ▕██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏  148 B                         
pulling a85fe2a2e58e... 100% ▕██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏  487 B                         
verifying sha256 digest 
writing manifest 
success 
&gt;&gt;&gt; Send a message (/? for help)
</code></pre>
   <p>That last line is prompting me for a prompt.</p>
   <p>When I run prompts, I find that the model does not stress out my memory at all, but does use up 5 to 6 cores of CPU while it is active.</p>
   <p>For the purpose of this post, I tried what I thought would be a simple prompt:</p>
   <pre><code class="language-plaintext">&gt;&gt;&gt; Write a 'Hello, world!' haiku.
</code></pre>
   <p>The model generates a <code>&lt;think&gt;...&lt;/think&gt;</code> section in which it describes its own "thought" process. But it is so neurotic! Endearingly neurotic! It went around in circles. I eventually grew impatient and aborted it with <code>&lt;ctrl-c&gt;</code>.</p>
   <pre><code class="language-plaintext">&lt;think&gt;
Okay, so I need to write a haiku in lowercase for "Hello, world!" that reads backwards both in the traditional way and when reversed again. Let me start by recalling what a haiku is. It's a three-line poem where the first line has five characters, the second eight, and the third five, 
all in iambic pentameter.

First, I'll break down "Hello, world!". The words are H, E, L, L, O, ,, W, O, R, L, D. But since we're writing it in lowercase as "hello, world!", that's h e l l o , w o r l d. Now, for the haiku structure, I need to arrange these into three lines with specific syllable counts and stress 
patterns.

The first line should have five syllables. So I'll pick a part of "hello" that has five letters, counting each vowel as one syllable. H-e-l-ll-o is 1+1+2+2+1=7 syllables. Hmm, too many. Maybe h-e-llo would be better—h (1) + e (1) + l (1) + l (1) + o (1) = 5 syllables.

Wait, but "hello" is H E L L O, so five letters with four consonants and one vowel. So that's correct for the first line: h-e-l-l-o.

Now, I need to make it into a haiku. The second line should have eight syllables, and the third line back to five again. Also, when reversed in both ways, they should form "hello, world!" correctly.

Let me think about how to mirror "hello" in some way. Maybe using symmetrical patterns or mirrors. Alternatively, considering the punctuation: comma and exclamation mark. The second word is a bit tricky with the comma—perhaps that's intentional as part of the haiku structure.

Looking at "hello", the next word after the first line would be two syllables for eight in total, but including the comma it might need to be longer. Maybe h-e-ll-o-, which has four letters plus the comma. That could work: h-e-l-l-o- (four characters) and then another line.

Wait, let me try that. First line: h-e-l-l-o—5 syllables. Second line: h-e-llo- (but wait, h-e-l-l-o is five letters; maybe I'm overcomplicating). Alternatively, the second word could be "ll" with a hyphen or something? But in haikus, usually words are separated by spaces.

Wait, perhaps it's better to think of the syllables. The first line: 1+1+2+2+1=7 syllables—need to adjust to 5. So maybe h-e-l-l-o is correct as five letters, but I need to represent it with five syllables in a four-letter base? Or perhaps use an alliteration.

Alternatively, think about "hello" and mirror the words somehow. Maybe H-e-llo-world? But that's eight letters for two lines and five again. Wait, no—haiku is three lines: 5-8-5.

So first line: h-e-l-l-o (h + e + l + l + o = 5 syllables). Second line needs to have eight syllables. Maybe h-e-ll-o-w (but that's only seven letters; maybe with an exclamation or hyphen? Alternatively, think of the second word as a two-syllable word but longer in terms of letters.

Wait, perhaps I'm approaching this wrong. Let me try to mirror "hello" around the center. So H E L L O would be mirrored as D O L L E, but that doesn't fit into the haiku structure. Alternatively, think of it in a way where each word relates somehow.

Alternatively, consider that the second line is a contraction or reflection. Maybe h-e-ll-o-, then w-o-r-l-d. But I'm not sure about the syllables here. Let me count:

First line: h-e-l-l-o → 5 syllables.
Second line: h-e-llo-w (h + e + l + l + o + w → six letters, which is more than eight; maybe this approach isn't right.)

Alternatively, perhaps using alliteration or a more specific pattern. Let me think of "hello" and how it can be mirrored with the second word being two syllables but having more letters.

Wait, another approach: The first line is 5 syllables (h-e-l-l-o), then for eight, maybe h-e-ll-o-w (but that's six characters; perhaps including a hyphen or something). Alternatively, think of "hello" and "world" as related in some way, like the second word being two syllables but 
longer.

Wait, let me consider "h-e-llo-world"—but no, it would be 12 letters. Maybe h-e-ll-o-w (but I'm getting confused with syllable counts).

Alternatively, perhaps think of each word as having a certain number of stressed vowels or consonants. For example, in the second line, the stress pattern might require two stressed syllables.

Wait, maybe it's better to look for existing haikus and see if any are similar to "hello" that can be mirrored. But since I'm supposed to create this from scratch, let me try again.

First line: h-e-l-l-o → 5 syllables.
Second line needs to have eight syllables. Maybe h-e-llo-w (h + e + l + l + o + w = six letters) but that's seven characters with an exclamation mark—maybe h-e-ll-o-w? Let me check the stress pattern for "hello". The word is h-e-l-l-o, which has four consonants and one vowel. So it 
sounds like a single syllable maybe.

Wait, no: 'Hello' has two syllables: H-e and llo, but in reality, it's pronounced as one syllable. But I need to make the haiku with five syllables for the first line.

Alternatively, perhaps h-e-ll-o would have four consonants, so that's 4 letters which is too few for a five-syllable word. Wait, no: h (1) + e (2) + l (3) + l (4) + o (5). So it's five syllables.

So first line: H E L L O → 5 syllables.

Second line needs to have eight syllables. Maybe h-e-ll-o-w? Let me check the syllable count for "hello, world": two lines of 5 and 8 respectively. Wait, no—the haiku is five, then eight, then five. But in this case, first line: hello (h-e-l-l-o) → five syllables.

Second line: h-e-ll-o-w? Let's see: h (1), e (2), l (3), l (4), o (5), w (6). That's six letters, which would be eight syllables if each word is broken down. Wait, that doesn't add up.

Alternatively, perhaps "h-e-ll-o-w" as the second line but considering more syllables. Hmm, I'm getting stuck here. Maybe I should look for existing haikus in the style of "hello, world!" and see how they mirror each other.

Wait, another idea: The second word is two syllables, so maybe h-e-ll-o-w? That's six letters but seven characters (including the comma). Alternatively, perhaps it's h-e-llo-w with a hyphen or something. But I'm not sure.

Alternatively, think of "h-e-ll-o" as one line and then mirroring with "w-o-r-l-d" in reverse. So maybe h-e-ll-o-, w-o-rld? Let me check the syllables:

First line: h-e-l-l-o → five syllables.
Second line: h-e-ll-o-w (h + e + l + l + o + w = six letters) but that's seven characters with a comma. Maybe hyphenated or something else, but it's tricky.

Alternatively, perhaps the second word is "h-e-llo", which is four syllables, and then "world" as two? No, that doesn't fit.

Wait, maybe I'm overcomplicating this. Let me try to write the lines step by step:

First line: h-e-l-l-o → 5 syllables.
Second line needs to be eight syllables. Maybe h-e-ll-o-w (six letters) but with a hyphen or something, making it seven characters. Alternatively, think of "h-e-ll-o-w" as the second word, which would make the entire line longer.

Alternatively, maybe I'm supposed to mirror the words somehow. So H-E-L-L-O could be mirrored around the center, perhaps h-e-llo-world, but that's too long.

Wait, another idea: The first line is 5 syllables, and the second word is two syllables with more letters. For example, h-e-ll-o (five letters) vs. w-o-r-l-d (but that would be in reverse). Alternatively, think of "h-e-ll-o" as one line and then "world" mirrored.

Wait, perhaps I'm stuck. Let me try to write the second line as h-e-ll-o-w with a hyphen or something, making it 6 characters. But no, haikus have strict syllable counts.

Alternatively, think of each word in terms of syllables: first line is five, second is eight, third is five.

So second line needs to be eight syllables. Maybe h-e-llo-w (h + e + l + l + o + w = six letters) but that's seven characters. Alternatively, maybe "h-e-ll-o" and "w-d", making it two lines: h-e-ll-o- and w-o-rld? No, that doesn't make sense.

Wait, I'm getting stuck here. Let me try to write the second line as h-e-llo-w with a hyphen in the middle or something, but^C

&gt;&gt;&gt;
</code></pre>
   <p>Then I tried a simpler variation:</p>
   <pre><code class="language-plaintext">&gt;&gt;&gt; Write me a joyful greeting, please?
&lt;think&gt;
Okay, so I just received this message: "Write me a joyful greeting, please?" Hmm, that's interesting. At first glance, it sounds like someone is trying to ask for a greeting but maybe they don't realize how important it is. Let me try to unpack what's going on here.

So, the person wrote a greeting that ends with a question mark. That's a bit unusual because usually, greetings are polite and direct without any questions. Maybe they're testing something or just curious about why they're asking for this specific type of greeting. Perhaps they want to 
see if I can recognize different types of requests.

I should consider what kind of response they might expect. Since it ends with a question mark, maybe the next step is to acknowledge their request and provide a friendly reply. But how? A simple "Yes! Thank you for your kindness!" would be appropriate. It's concise and acknowledges their 
message without being repetitive or too formal.

I wonder if there are any underlying reasons behind their query. Maybe they're trying to get my attention quickly or set a context where I can respond further. Without more information, it's hard to say exactly what they need next, but focusing on a heartfelt greeting seems like the best 
approach right now.

Also, considering the tone, it should feel warm and caring. Using words that convey gratitude and appreciation is key here. Phrases like "I appreciate your kind words" or "Thank you for your kind gesture" can make the response more genuine.

Another angle to think about is the purpose of the greeting. If this is part of a larger conversation, maybe they need something specific for that context. But since I don't have any additional details, it's safer to keep it general and flexible.

I should also consider if there are alternative greetings that might be more suitable based on their message. For example, "How can I help you today?" or "Could you please let me know how I can assist you?" Each of these has its own merits, but the original question ends with a question 
mark, so focusing back on a simple, heartfelt response makes sense.

In summary, my approach should be to acknowledge their message, provide a genuine reply that shows appreciation, and keep it concise. This way, they know I'm listening without overcomplicating things.
&lt;/think&gt;

Certainly! Here's a heartfelt greeting in the requested format:

---

Hey there! I hope you're doing well today. It sounds like your kind words are always appreciated—thanks for taking the time to connect with me!

---

This response is warm, genuine, and acknowledges their message while keeping it concise.
</code></pre>
   <p>A bit off. But not terrible!</p>
   <p>Next I tried to see if it could code:</p>
   <pre><code class="language-plaintext">&gt;&gt;&gt; Please write a Scala program that prints "Hello, world!"
</code></pre>
   <p>This... didn't go so well.</p>
   <p>To be fair, Scala is not likely to be its most prominant training language, and some of its attempts could be excused as not quite knowing whether to write Scala 2 or Scala 3. Its first attempt was closer to Scala 3 than Scala 2. (It offered a naked top-level function, supported as <code>main</code> entry points only in Scala 3.) So I tried to tutor it towards s Scala 3 solution.</p>
   <p>It came pretty close! But after three or four back and forths over ~25 minutes, it still wasn't quite right and I gave up.</p>
   <p>This is the tiniest DeepSeek model. I wonder if I can run a bigger one, and if it performs a bit better?</p>
   <p>Stay tuned on that, I guess.</p>
   <hr>
   <p><strong>Postscript:</strong></p>
   <p>I'm pretty short storage space on the ol' laptop, so I want to clean up after this exercise. A bit of searching <a href="https://www.restack.io/p/ollama-models-storage-answer-cat-ai">tells me</a> that on a Mac, models will be stored under a <code>~/.ollama</code> directory.</p>
   <pre><code class="language-plaintext">% find ~/.ollama 
/Users/swaldman/.ollama
/Users/swaldman/.ollama/id_ed25519
/Users/swaldman/.ollama/id_ed25519.pub
/Users/swaldman/.ollama/models
/Users/swaldman/.ollama/models/blobs
/Users/swaldman/.ollama/models/blobs/sha256-6e4c38e1172f42fdbff13edf9a7a017679fb82b0fde415a3e8b3c31c6ed4a4e4
/Users/swaldman/.ollama/models/blobs/sha256-369ca498f347f710d068cbb38bf0b8692dd3fa30f30ca2ff755e211c94768150
/Users/swaldman/.ollama/models/blobs/sha256-aabd4debf0c8f08881923f2c25fc0fdeed24435271c2b3e92c4af36704040dbc
/Users/swaldman/.ollama/models/blobs/sha256-a85fe2a2e58e2426116d3686dfdc1a6ea58640c1e684069976aa730be6c1fa01
/Users/swaldman/.ollama/models/blobs/sha256-f4d24e9138dd4603380add165d2b0d970bef471fac194b436ebd50e6147c6588
/Users/swaldman/.ollama/models/manifests
/Users/swaldman/.ollama/models/manifests/registry.ollama.ai
/Users/swaldman/.ollama/models/manifests/registry.ollama.ai/library
/Users/swaldman/.ollama/models/manifests/registry.ollama.ai/library/deepseek-r1
/Users/swaldman/.ollama/models/manifests/registry.ollama.ai/library/deepseek-r1/1.5b
/Users/swaldman/.ollama/history
% du -sh ~/.ollama 
1.0G	/Users/swaldman/.ollama
</code></pre>
   <p>It's not huge, but I'm going to remove it anyway for now.</p>
   <pre><code class="language-plaintext">% ollama help
Large language model runner

Usage:
  ollama [flags]
  ollama [command]

Available Commands:
  serve       Start ollama
  create      Create a model from a Modelfile
  show        Show information for a model
  run         Run a model
  stop        Stop a running model
  pull        Pull a model from a registry
  push        Push a model to a registry
  list        List models
  ps          List running models
  cp          Copy a model
  rm          Remove a model
  help        Help about any command

Flags:
  -h, --help      help for ollama
  -v, --version   Show version information

Use "ollama [command] --help" for more information about a command.

% ollama list
NAME                ID              SIZE      MODIFIED
deepseek-r1:1.5b    a42b25d8c10a    1.1 GB    About an hour ago

% ollama rm deepseek-r1:1.5b
deleted 'deepseek-r1:1.5b'

% du -sh ~/.ollama
 12K	/Users/swaldman/.ollama
</code></pre>
   <p>All cleaned up!</p>
  </div>
 </div>
 <div class="entry-footer">
  <div class="post-metainfo">
   <div>
    <a href="2025/01/28/baby-deepseek-on-on-mac-laptop/index.html" class="pubtime">12:20 AM EST</a>
   </div>
  </div>
 </div>
</article>
<div class="after-article">
</div><!-- after-article --><div class="entry-separator"></div><div class="day-stamp">
 2025-01-14 <span class="arrow">⇒</span>
</div>
<article class="presentation-multiple uid-syndicating-rss-to-mastodon-and-bluesky-with-feedletter">
 <div class="entry-header">
  <h1><a href="2025/01/14/syndicating-rss-to-mastodon-and-bluesky-with-feedletter/index.html">Syndicating RSS to Mastodon and BlueSky with feedletter</a></h1>
  <hr class="below-title">
 </div>
 <div class="entry-body">
  <div class="flexmark markdown">
   <p><a href="https://github.com/swaldman/feedletter"><code>feedletter</code></a> is a service I wrote mostly to convert RSS newsfeeds into e-mail newsletters.</p>
   <p>If you subscribe to this blog by e-mail, or to <a href="https://drafts.interfluidity.com/"><code>drafts.interfluidity.com</code></a>, <code>feedletter</code> is the service to which you subscribed, and which mails you my blogposts.</p>
   <p>I wrote an <a href="https://tech.interfluidity.com/2024/01/29/feedletter-tutorial/index.html">elaborate tutorial</a> documenting how to set up newsletter subscriptions about a year ago.</p>
   <p>But <code>feedletter</code> can also syndicate RSS announcements (or posts, length permitting) to Mastodon and BlueSky.</p>
   <p>I thought I'd do a quick tutorial on how it works.</p>
   <h3><a href="#table-of-contents" id="table-of-contents" name="table-of-contents" class="anchorlink"></a>Table of contents</h3>
   <ol>
    <li><a href="#1-prerequisites">Prerequisites</a></li>
    <li><a href="#2-create-user-feedletter">Create user <code>feedletter</code></a></li>
    <li><a href="#3-install-feedletter">Install <code>feedletter</code></a></li>
    <li><a href="#4-prepare-the-postgres-database">Prepare the <code>postgres</code> database</a></li>
    <li><a href="#5-create-the-etcfeedletter-directory">Create the <code>/etc/feedletter</code> directory</a></li>
    <li><a href="#6-create-a-mastodon-app-password">Create a Mastodon app password</a></li>
    <li><a href="#7-create-etcfeedletterfeedletter-secretsproperties-and-configure-mastodon-access">Create <code>/etc/feedletter/feedletter-secrets.properties</code> and configure Mastodon access</a></li>
    <li><a href="#8-configure-bluesky-access">Configure BlueSky access</a></li>
    <li><a href="#9-add-c3p0-database-configuration-to-etcfeedletterfeedletter-secretsproperties">Add <code>c3p0</code> (database) configuration to <code>/etc/feedletter/feedletter-secrets.properties</code></a></li>
    <li><a href="#10-add-a-secret-salt-to-etcfeedletterfeedletter-secretsproperties">Add a "secret salt" to <code>/etc/feedletter/feedletter-secrets.properties</code></a></li>
    <li><a href="#11-check-out-the-feedletter-app">Check out the feedletter app</a></li>
    <li><a href="#12-initialize-the-feedletter-database">Initialize the feedletter database</a></li>
    <li><a href="#13-add-a-feed-you-wish-to-syndicate">Add a feed you wish to syndicate</a></li>
    <li><a href="#14-define-your-subscribables">Define your subscribables</a></li>
    <li><a href="#15-subscribe-the-target-mastodon-and-bluesky-accounts-to-the-subscribables">Subscribe the target Mastodon and BlueSky accounts to the subscribables.</a></li>
    <li><a href="#16-test-in-the-terminal">Test in the terminal</a></li>
    <li><a href="#17-enable-feedletter-as-a-systemd-daemon">Enable <code>feedletter</code> as a <code>systemd</code> daemon</a></li>
    <li><a href="#18-conclusion">Conclusion</a></li>
   </ol>
   <hr>
   <h3><a href="#1-prerequisites" id="1-prerequisites" name="1-prerequisites" class="anchorlink"></a>1. Prerequisites</h3>
   <p>You'll need a systemd-based server on the internet, git, postgres, and a Java 17+ JVM installed.</p>
   <h3><a href="#2-create-user-feedletter" id="2-create-user-feedletter" name="2-create-user-feedletter" class="anchorlink"></a>2. Create user feedletter</h3>
   <p>We'll create a passwordless user:</p>
   <pre><code class="language-plaintext"># adduser --disabled-password feedletter
</code></pre>
   <h3><a href="#3-install-feedletter" id="3-install-feedletter" name="3-install-feedletter" class="anchorlink"></a>3. Install feedletter</h3>
   <p>We just clone a git repository. We'll make it become <code>/opt/feedletter</code>, and make sure our new user <code>feedletter</code> owns it:</p>
   <pre><code class="language-plaintext"># cd /opt
# git clone https://github.com/swaldman/feedletter-install.git feedletter
Cloning into 'feedletter'...
remote: Enumerating objects: 81, done.
remote: Counting objects: 100% (81/81), done.
remote: Compressing objects: 100% (48/48), done.
remote: Total 81 (delta 40), reused 64 (delta 23), pack-reused 0 (from 0)
Receiving objects: 100% (81/81), 12.32 KiB | 4.10 MiB/s, done.
Resolving deltas: 100% (40/40), done.
# chown -R feedletter:feedletter feedletter
</code></pre>
   <h3><a href="#4-prepare-the-postgres-database" id="4-prepare-the-postgres-database" name="4-prepare-the-postgres-database" class="anchorlink"></a>4. Prepare the postgres database</h3>
   <pre><code class="language-plaintext"># su - postgres
$ createdb feedletter
$ createuser feedletter
$ psql
psql (16.6 (Ubuntu 16.6-0ubuntu0.24.10.1))
Type "help" for help.

postgres=# ALTER DATABASE feedletter OWNER TO feedletter;
ALTER DATABASE
postgres=# ALTER USER feedletter WITH PASSWORD 'not-actually-this';
ALTER ROLE
postgres=# \q
$ exit
</code></pre>
   <h3><a href="#5-create-the-etcfeedletter-directory" id="5-create-the-etcfeedletter-directory" name="5-create-the-etcfeedletter-directory" class="anchorlink"></a>5. Create the /etc/feedletter directory</h3>
   <pre><code class="language-plaintext"># mkdir /etc/feedletter
# chown feedletter:feedletter /etc/feedletter
</code></pre>
   <h3><a href="#6-create-a-mastodon-app-password-and-place-it-in-etcfeedletterfeedletter-secretsproperties" id="6-create-a-mastodon-app-password-and-place-it-in-etcfeedletterfeedletter-secretsproperties" name="6-create-a-mastodon-app-password-and-place-it-in-etcfeedletterfeedletter-secretsproperties" class="anchorlink"></a>6. Create a Mastodon app password, and place it in /etc/feedletter/feedletter-secrets.properties</h3>
   <p>In the Mastodon account to which you intend to syndicate announcements, go to Settings &gt; Development, and click the "New Application" button.</p>
   <p>Define an application name. We'll use "feedletter-syndication".</p>
   <p><em><strong>Be sure to enable write permissions!</strong></em></p>
   <p>Finally click the Submit button.</p>
   <p>You should see your new application listed now in the applications page. Click on it. On the resulting page, note the field "Your access token". You'll need its value in the next step.</p>
   <h3><a href="#7-create-etcfeedletterfeedletter-secretsproperties-and-configure-mastodon-access" id="7-create-etcfeedletterfeedletter-secretsproperties-and-configure-mastodon-access" name="7-create-etcfeedletterfeedletter-secretsproperties-and-configure-mastodon-access" class="anchorlink"></a>7. Create /etc/feedletter/feedletter-secrets.properties and configure Mastodon access</h3>
   <p>We'll first become user feedletter, then open a text editor on <code>/etc/feedletter/feedletter-secrets.properties</code>.</p>
   <pre><code class="language-plaintext"># su - feedletter
$ touch /etc/feedletter/feedletter-secrets.properties
$ chmod 600 /etc/feedletter/feedletter-secrets.properties
$ emacs /etc/feedletter/feedletter-secrets.properties
</code></pre>
   <div class="note">
    <p><code>feedletter</code> will insist that <code>/etc/feedletter/feedletter-secrets.properties</code> has restrictive permissions.</p>
    <p>It will refuse to run if you skip the <code>chmod</code> bit.</p>
    <pre><code>$ chmod 600 /etc/feedletter/feedletter-secrets.properties`
</code></pre>
   </div>
   <p>Now we'll add an entry to our properties file in the form</p>
   <pre><code class="language-plaintext">feedletter.masto.access.token.&lt;arbitrary-name&gt;=&lt;access-token&gt;`:
</code></pre>
   <p>Just to be dumb, we'll use "arbitrary-name" as our, um, arbitrary name.</p>
   <pre><code class="language-plaintext">feedletter.masto.access.token.arbitrary-name=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
</code></pre>
   <div class="note">
    <p>Your access token probably is not all <code>XXXXXXXXXX</code>!</p>
   </div>
   <h3><a href="#8-configure-bluesky-access" id="8-configure-bluesky-access" name="8-configure-bluesky-access" class="anchorlink"></a>8. Configure BlueSky access</h3>
   <p>In the BlueSky account you intend to syndicate to, go to Settings &gt; Privacy and security &gt; App passwords.</p>
   <p>Click "Add App Password".</p>
   <p>Give your app a name. We'll use "feedletter-syndication" again.</p>
   <p>Your app password will appear.</p>
   <p>Add a new line to <code>/etc/feedletter/feedletter-secrets.properties</code>, in the form <code>feedletter.bsky.identifier.&lt;identifier&gt;=&lt;app-password&gt;</code>.</p>
   <div class="note">
    <p>This is a bit different from Mastodon!</p>
    <p>In Mastodon, a totally arbitrary name went at the end of the key. Here it is the <em>user identifier</em>, which usually a DNS handle (but it can also be a <a href="https://atproto.com/">atproto</a> <a href="https://atproto.com/specs/did"><code>did</code></a>).</p>
   </div>
   <p>The account we're syndicating to will be <code>testable-bsky.bsky.social</code></p>
   <p>So <code>/etc/feedletter/feedletter-secrets.properties</code> should look something like this, albeit with a real access tokens / passwords.</p>
   <pre><code class="language-plaintext">feedletter.masto.access.token.arbitrary-name=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
feedletter.bsky.identifier.testable-bsky.bsky.social=xxxx-xxxx-xxxx-xxxx
</code></pre>
   <h3><a href="#9-add-c3p0-database-configuration-to-etcfeedletterfeedletter-secretsproperties" id="9-add-c3p0-database-configuration-to-etcfeedletterfeedletter-secretsproperties" name="9-add-c3p0-database-configuration-to-etcfeedletterfeedletter-secretsproperties" class="anchorlink"></a>9. Add c3p0 (database) configuration to /etc/feedletter/feedletter-secrets.properties</h3>
   <p>Remember when we set the Postgres password a while back? We'll use it now.</p>
   <p>Postgres by default runs on port 5432, so let's add some database access and authentication information.</p>
   <p><code>feedletter</code> uses the <code>c3p0</code> connection pooling library.</p>
   <p>Edit <code>/etc/feedletter/feedletter-secrets.properties</code> so that it looks something like this:</p>
   <pre><code class="language-plaintext">feedletter.masto.access.token.arbitrary-name=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
feedletter.bsky.identifier.testable-bsky.bsky.social=xxxx-xxxx-xxxx-xxxx
c3p0.jdbcUrl=jdbc:postgresql://localhost:5432/feedletter
c3p0.user=feedletter
c3p0.password=not-actually-this
</code></pre>
   <h3><a href="#10-add-a-secret-salt-to-etcfeedletterfeedletter-secretsproperties" id="10-add-a-secret-salt-to-etcfeedletterfeedletter-secretsproperties" name="10-add-a-secret-salt-to-etcfeedletterfeedletter-secretsproperties" class="anchorlink"></a>10. Add a "secret salt" to /etc/feedletter/feedletter-secrets.properties</h3>
   <p><code>/etc/feedletter/feedletter-secrets.properties</code> should contain a "secret salt", whose value is entirely arbitrary but should be kept secret. We'll add that, so <code>/etc/feedletter/feedletter-secrets.properties</code> now looks like:</p>
   <pre><code class="language-plaintext">feedletter.masto.access.token.arbitrary-name=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
feedletter.bsky.identifier.testable-bsky.bsky.social=xxxx-xxxx-xxxx-xxxx
c3p0.jdbcUrl=jdbc:postgresql://localhost:5432/feedletter
c3p0.user=feedletter
c3p0.password=not-actually-this
feedletter.secret.salt=This is an arbitrary string.
</code></pre>
   <h3><a href="#11-check-out-the-feedletter-app" id="11-check-out-the-feedletter-app" name="11-check-out-the-feedletter-app" class="anchorlink"></a>11. Check out the feedletter app</h3>
   <p>As user <code>feedletter</code>, cd into <code>/opt/feedletter</code> and type</p>
   <pre><code class="language-plaintext">$ ./feedletter --help
</code></pre>
   <p>The first time you do this, it will download a lot of stuff!</p>
   <p>Eventually you will see a help message, like this:</p>
   <pre><code class="language-plaintext">Usage:
     feedletter [--secrets &lt;propsfile&gt;] add-feed
     feedletter [--secrets &lt;propsfile&gt;] alter-feed
     feedletter [--secrets &lt;propsfile&gt;] daemon
     feedletter [--secrets &lt;propsfile&gt;] db-dump
     feedletter [--secrets &lt;propsfile&gt;] db-init
     feedletter [--secrets &lt;propsfile&gt;] db-migrate
     feedletter [--secrets &lt;propsfile&gt;] define-bluesky-subscribable
     feedletter [--secrets &lt;propsfile&gt;] define-email-subscribable
     feedletter [--secrets &lt;propsfile&gt;] define-mastodon-subscribable
     feedletter [--secrets &lt;propsfile&gt;] drop-feed-and-subscribables
     feedletter [--secrets &lt;propsfile&gt;] drop-subscribable
     feedletter [--secrets &lt;propsfile&gt;] edit-subscribable
     feedletter [--secrets &lt;propsfile&gt;] export-subscribers
     feedletter [--secrets &lt;propsfile&gt;] list-config
     feedletter [--secrets &lt;propsfile&gt;] list-feeds
     feedletter [--secrets &lt;propsfile&gt;] list-items-excluded
     feedletter [--secrets &lt;propsfile&gt;] list-subscribables
     feedletter [--secrets &lt;propsfile&gt;] list-subscribers
     feedletter [--secrets &lt;propsfile&gt;] list-untemplates
     feedletter [--secrets &lt;propsfile&gt;] send-test-email
     feedletter [--secrets &lt;propsfile&gt;] set-config
     feedletter [--secrets &lt;propsfile&gt;] set-extra-params
     feedletter [--secrets &lt;propsfile&gt;] set-untemplates
     feedletter [--secrets &lt;propsfile&gt;] subscribe
 
 Manage e-mail subscriptions to and notifications from RSS feeds.
 
 Options and flags:
     --help
         Display this help text.
     --secrets &lt;propsfile&gt;
         Path to properties file containing SMTP, postgres, c3p0, and other configuration details.
 
 Environment Variables:
     FEEDLETTER_SECRETS=&lt;path&gt;
         Path to properties file containing SMTP, postgres, c3p0, and other configuration details.
 
 Subcommands:
     add-feed
         Add a new feed from which mail or notifications may be generated.
     alter-feed
         Alter the timings of an already-defined feed.
     daemon
         Run daemon that watches feeds and sends notifications.
     db-dump
         Dump a backup of the database into a configured directory.
     db-init
         Initialize the database schema.
     db-migrate
         Migrate to the latest version of the database schema.
     define-bluesky-subscribable
         Define a BlueSky subscribable, a source from which BlueSky feeds can receive automatic posts..
     define-email-subscribable
         Define a new email subscribable, a mailing lost to which users can subscribe.
     define-mastodon-subscribable
         Define a Mastodon subscribable, a source from which Mastodon feeds can receive automatic posts..
     drop-feed-and-subscribables
         Removes a feed, along with any subscribables defined upon it, from the service.
     drop-subscribable
         Removes a subscribable from the service.
     edit-subscribable
         Edit an already-defined subscribable.
     export-subscribers
         Dump subscriber information for a subscribable in CSV format.
     list-config
         List all configuration parameters.
     list-feeds
         List all feeds the application is watching.
     list-items-excluded
         List items excluded from generating notifications.
     list-subscribables
         List all subscribables.
     list-subscribers
         List all subscribers to a subscribable.
     list-untemplates
         List available untemplates.
     send-test-email
         Send a brief email to test your SMTP configuration.
     set-config
         Set configuration parameters.
     set-extra-params
         Add, update, or remove extra params you may define to affect rendering of notifications and messages.
     set-untemplates
         Update the untemplates used to render subscriptions.
     subscribe
         Subscribe to a subscribable.
</code></pre>
   <div class="note">
    <p>This might be surrounded by some noise from the <a href="https://mill-build.org/mill/index.html"><code>mill</code></a> process used to launch it. It might end with <code>Subprocess failed.</code></p>
    <p>That's all fine.</p>
   </div>
   <h3><a href="#12-initialize-the-feedletter-database" id="12-initialize-the-feedletter-database" name="12-initialize-the-feedletter-database" class="anchorlink"></a>12. Initialize the feedletter database</h3>
   <p>As user <code>feedletter</code>, from within <code>/opt/feedletter</code>, type</p>
   <pre><code class="language-plaintext">$ ./feedletter db-init
</code></pre>
   <p>That's all!</p>
   <h3><a href="#13-add-a-feed-you-wish-to-syndicate" id="13-add-a-feed-you-wish-to-syndicate" name="13-add-a-feed-you-wish-to-syndicate" class="anchorlink"></a>13. Add a feed you wish to syndicate</h3>
   <p>As user <code>feedletter</code>, from within <code>/opt/feedletter</code>, type</p>
   <pre><code class="language-plaintext">$ ./feedletter add-feed --help
</code></pre>
   <p>You should see</p>
   <pre><code class="language-plaintext"> Usage:
     feedletter add-feed --ping &lt;feed-url&gt;
     feedletter add-feed [--min-delay-minutes &lt;minutes&gt;] [--await-stabilization-minutes &lt;minutes&gt;] [--max-delay-minutes &lt;minutes&gt;] [--recheck-every-minutes &lt;minutes&gt;] &lt;feed-url&gt;
 
 Add a new feed from which mail or notifications may be generated.
 
 Options and flags:
     --help
         Display this help text.
     --ping
         Check feed as often as possible, notify as soon as possible, regardless of (in)stability.
     --min-delay-minutes &lt;minutes&gt;
         Minimum wait (in miunutes) before a newly encountered item can be notified.
     --await-stabilization-minutes &lt;minutes&gt;
         Period (in minutes) over which an item should not have changed before it is considered stable and can be notified.
     --max-delay-minutes &lt;minutes&gt;
         Notwithstanding other settings, maximum period past which an item should be notified, regardless of its stability.
     --recheck-every-minutes &lt;minutes&gt;
         Delay between refreshes of feeds, and redetermining items' availability for notification.
</code></pre>
   <p><code>feedletter</code> is general very cautious about announcing / e-mailing posts. Since posts are often edited soon after they are published, by default it waits a period of time, and then checks to make sure the post has been stable a while before announcing or e-mailing. By default <code>min-delay-minutes</code> is 30, <code>await-stabilization-minutes</code> is 15, <code>max-delay-minutes</code> is 180, and <code>recheck-every-minutes</code> is 10.</p>
   <p>It's probably best to use cautious settings like this, so you don't announce your links while you are still re-editing them. (I don't think I'm the only writer who inevitably finds important edits just after hitting publish.)</p>
   <p>For this tutorial, I'm going to use a feed of all the articles in my newsreader, <a href="https://www.inoreader.com">inoreader</a>. Its URL looks like</p>
   <blockquote>
    <p><code>https://www.inoreader.com/stream/user/0000000000/tag/all-articles</code>,</p>
   </blockquote>
   <p>although <code>0000000000</code> is not in fact my user id, I'm altering that for privacy. You should use whatever feed you are interested in syndicating.</p>
   <p>To use the defaults, you could just type</p>
   <pre><code class="language-plaintext">$ ./feedletter add-feed https://www.inoreader.com/stream/user/0000000000/tag/all-articles
</code></pre>
   <p>For the purposes of our little experiment here, I want articles announced as soon as <code>feedletter</code> sees them, even if they have not "stabilized". For that, it will just be</p>
   <pre><code class="language-plaintext">$ ./feedletter add-feed --ping https://www.inoreader.com/stream/user/0000000000/tag/all-articles
</code></pre>
   <p>You should see something like</p>
   <pre><code class="language-plaintext">+---------+-------------------------------------------------------------------+----------------+--------------------------+----------------+--------------------+-----------------------------+-----------------------------+
¦ Feed ID ¦ Feed URL                                                          ¦ Min Delay Mins ¦ Await Stabilization Mins ¦ Max Delay Mins ¦ Recheck Every Mins ¦ Added                       ¦ Last Assigned               ¦
+---------+-------------------------------------------------------------------+----------------+--------------------------+----------------+--------------------+-----------------------------+-----------------------------+
¦ 1       ¦ https://www.inoreader.com/stream/user/0000000000/tag/all-articles ¦ 0              ¦ 0                        ¦ 0              ¦ 0                  ¦ 2025-01-11T05:00:47.128363Z ¦ 2025-01-11T05:00:47.128363Z ¦
+---------+-------------------------------------------------------------------+----------------+--------------------------+----------------+--------------------+-----------------------------+-----------------------------+
</code></pre>
   <p>The numbers will be different if you (wisely!) don't use the <code>--ping</code> flag.</p>
   <div class="note">
    <p>Using <code>--ping</code> will cause the feed to be checked very frequently, currently about once a minute. Some servers may grow cross! You may be blocked or rate-limited!</p>
    <p>You can use <code>./feedletter alter-feed</code> to set a gentler <code>recheck-every-minutes</code>.</p>
   </div>
   <h3><a href="#14-define-your-subscribables" id="14-define-your-subscribables" name="14-define-your-subscribables" class="anchorlink"></a>14. Define your subscribables</h3>
   <p><code>feedletter</code> is a layered application. First you tell it what feeds to watch, then you define different kinds of "subscribables" — e.g. email, Mastodon, BlueSky — to each of which multiple recipients can subscribe in order to receive notifications.</p>
   <p>Typically an e-mail subscribable will have many — 100s, 1000s — of destinations.</p>
   <p>BlueSky and Mastodon "subscribable" often have just one subscriber, the accounts to which entries will be syndicated. You can attach as many subscribers as you want, though, if you want to post announcements to many accounts.</p>
   <p>Let's start with our Mastodon subscribable:</p>
   <pre><code class="language-plaintext">$ ./feedletter define-mastodon-subscribable --help
</code></pre>
   <p>You'll see something like</p>
   <pre><code class="language-plaintext"> Usage: feedletter define-mastodon-subscribable --feed-id &lt;feed-id&gt; --name &lt;name&gt; [--extra-param &lt;key:value&gt;]...
 
 Define a Mastodon subscribable, a source from which Mastodon feeds can receive automatic posts..
 
 Options and flags:
     --help
         Display this help text.
     --feed-id &lt;feed-id&gt;
         The ID of the RSS feed to be watched.
     --name &lt;name&gt;
         A name for the new subscribable.
     --extra-param &lt;key:value&gt;
         An extra parameter your notification renderers might use.
</code></pre>
   <p>We saw the <code>feed-id</code> in the output to <code>./feedletter add-feed</code> (and if we forget it, we can always run <code>./feedletter list-feeds</code>).</p>
   <p>The subscribable name can be anything we want, but by default it will appear in announcements. I'm going to call this subscribable <code>stevefeeds-masto</code>:</p>
   <pre><code class="language-plaintext">$ ./feedletter define-mastodon-subscribable --feed-id=1 --name=stevefeeds-masto
 
 -*-*-*-
 
 Subscribable Name:    stevefeeds-masto
 Feed ID:              1
 Subscription Manager: {
     "extraParams": {},
     "type": "Mastodon.Announce",
     "version": 1
 }
 A Mastodon subscribable to feed with ID '1' named 'stevefeeds-masto' has been created.
</code></pre>
   <p>Let's do the same, and make a BlueSky subscribable:</p>
   <pre><code class="language-plaintext">$ ./feedletter define-bluesky-subscribable --feed-id=1 --name=stevefeeds-bsky

 -*-*-*-
 
 Subscribable Name:    stevefeeds-bsky
 Feed ID:              1
 Subscription Manager: {
     "extraParams": {},
     "type": "BlueSky.Announce",
     "version": 1
 }
 A BlueSky subscribable to feed with ID '1' named 'stevefeeds-bsky' has been created.
</code></pre>
   <h3><a href="#15-subscribe-the-target-mastodon-and-bluesky-accounts-to-the-subscribables" id="15-subscribe-the-target-mastodon-and-bluesky-accounts-to-the-subscribables" name="15-subscribe-the-target-mastodon-and-bluesky-accounts-to-the-subscribables" class="anchorlink"></a>15. Subscribe the target Mastodon and BlueSky accounts to the subscribables.</h3>
   <p>Let's check out the <code>subscribe</code> subcommand.</p>
   <pre><code class="language-plaintext">$ ./feedletter subscribe --help

 Usage:
     feedletter subscribe --subscribable-name &lt;name&gt; --e-mail &lt;address&gt; [--display-name &lt;name&gt;] [--unconfirmed]
     feedletter subscribe --subscribable-name &lt;name&gt; --sms &lt;number&gt; [--unconfirmed]
     feedletter subscribe --subscribable-name &lt;name&gt; --masto-instance-name &lt;name&gt; --masto-instance-url &lt;url&gt; [--unconfirmed]
     feedletter subscribe --subscribable-name &lt;name&gt; --bsky-identifier &lt;identifier&gt; [--bsky-entryway-url &lt;name&gt;] [--unconfirmed]
 
 Subscribe to a subscribable.
 
 Options and flags:
     --help
         Display this help text.
     --subscribable-name &lt;name&gt;
         The name of an already-defined subscribable.
     --e-mail &lt;address&gt;
         The e-mail address to subscribe.
     --display-name &lt;name&gt;
         A display name to wrap around the e-mail address.
     --sms &lt;number&gt;
         The number to which messages should be sent.
     --masto-instance-name &lt;name&gt;
         A private name for this Mastodon instance.
     --masto-instance-url &lt;url&gt;
         The URL of the Mastodon instance
     --bsky-identifier &lt;identifier&gt;
         An account identifier, usually a DNS name or value beginning with 'did:'.
     --bsky-entryway-url &lt;name&gt;
         The base URL of the bluesky service.
     --unconfirmed
         Mark the subscription unconfirmed.
</code></pre>
   <p>Recall that when we placed our Mastodon access token in <code>feedletter-secrets.properties</code>, we gave it a name. We chose "arbitrary-name", because it's lovely. That becomes our <code>masto-instance-name</code>. The URL of the instance that hosts our accounts will be <code>masto-instance-url</code>. So we just...</p>
   <pre><code class="language-plaintext">./feedletter subscribe --subscribable-name stevefeeds-masto --masto-instance-name arbitrary-name --masto-instance-url https://mas.to/
</code></pre>
   <p>For BlueSky, at least for now, we don't really need to provide a URL, there's just one. (In the future, hopefully there will be more BlueSky-like <a href="https://atproto.com/">atproto</a> services, for which you would provide and <code>entryway-url</code>). All you need to provide is <code>bsky-identifier</code>, the DNS handle or <a href="https://atproto.com/specs/did"><code>did</code></a> associated with your BlueSky account.</p>
   <pre><code class="language-plaintext">./feedletter subscribe --subscribable-name stevefeeds-bsky --bsky-identifier testable-bsky.bsky.social
</code></pre>
   <h3><a href="#16-test-in-the-terminal" id="16-test-in-the-terminal" name="16-test-in-the-terminal" class="anchorlink"></a>16. Test in the terminal</h3>
   <p>Finally, all of our setup is done!</p>
   <p>We can get <code>feedletter</code> checking out our feed and syndicating announcements just by running what's usually the daemon process in the terminal.</p>
   <pre><code class="language-plaintext">$ ./feedletter daemon

Jan 13, 2025 5:33:34 PM com.mchange.v2.log.MLog 
INFO: MLog clients using java 1.4+ standard logging.
2025-01-13@17:33:36 [INFO] [com.mchange.feedletter.Daemon] feedletter-0.1.0-13-60e19c daemon (re)starting. 
2025-01-13@17:33:36 [INFO] [com.mchange.feedletter.Daemon] Spawning daemon fibers. 
2025-01-13@17:33:37 [INFO] [com.mchange.feedletter.Daemon] Starting web API service on interface '127.0.0.1', port 8024. 
timestamp=2025-01-13T17:33:37.596959114Z level=INFO thread=#zio-fiber-1822226262 message="Starting the server..." location=com.mchange.feedletter.Daemon.webDaemon file=Daemon.scala line=189
timestamp=2025-01-13T17:33:37.714089350Z level=INFO thread=#zio-fiber-1822226262 message="Server started" location=com.mchange.feedletter.Daemon.webDaemon file=Daemon.scala line=189
2025-01-13@17:33:50 [FINE] [com.mchange.feedletter.db.PgDatabase] Deleting any as-yet-unassigned items that have been deleted from feed with ID 1 
2025-01-13@17:33:50 [INFO] [com.mchange.feedletter.db.PgDatabase] Updated/assigned all items from feed with ID 1, feed URL 'https://www.inoreader.com/stream/user/0000000000/tag/all-articles' 
2025-01-13@17:33:59 [FINE] [com.mchange.feedletter.db.PgDatabase] Deleting any as-yet-unassigned items that have been deleted from feed with ID 1 
2025-01-13@17:33:59 [INFO] [com.mchange.feedletter.db.PgDatabase] Updated/assigned all items from feed with ID 1, feed URL 'https://www.inoreader.com/stream/user/0000000000/tag/all-articles' 
2025-01-13@17:34:03 [FINE] [com.mchange.feedletter.db.PgDatabase] Deleting any as-yet-unassigned items that have been deleted from feed with ID 1 
</code></pre>
   <p>Great! This is what it looks like when the daemon is watch feeds. (In this case, just one feed.)</p>
   <p>Eventually, when a new item is posted, you'll see entries like</p>
   <pre><code class="language-plaintext">2025-01-13@17:34:42 [FINE] [com.mchange.feedletter.db.PgDatabase] Added new item, feed ID 1, guid 'http://www.inoreader.com/article/3a9c6e7789e019a2'. 
2025-01-13@17:34:42 [FINE] [com.mchange.feedletter.db.PgDatabase] Item with GUID 'http://www.inoreader.com/article/3a9c6e7789e019a2' from feed with ID 1 has been assigned in subscribable 'stevefeeds-bsky' with assignable identifier 'http://www.inoreader.com/article/3a9c6e7789e019a2'. 
2025-01-13@17:34:42 [FINE] [com.mchange.feedletter.db.PgDatabase] Item with GUID 'http://www.inoreader.com/article/3a9c6e7789e019a2' from feed with ID 1 has been assigned in subscribable 'stevefeeds-masto' with assignable identifier 'http://www.inoreader.com/article/3a9c6e7789e019a2'. 
2025-01-13@17:34:42 [FINE] [com.mchange.feedletter.db.PgDatabase] Item with GUID 'http://www.inoreader.com/article/3a9c6e7789e019a2' from feed with ID 1 has been assigned (or refused assignment) in all subscribables to that feed. 
</code></pre>
   <p>In English, a new item has been found, and it's been "assigned" to the various subscribables watching the feed, here one that distributes to mastodon, and another that distributes to Mastodon and another that distributes to BlueSky. (You can also <a href="2024/01/29/feedletter-tutorial/index.html#12-define-subscribables-to-feeds">make various forms of e-mail subscribables</a>!)</p>
   <p>Some subscribables collect many posts before distributing them. (For example, a weekly digest e-mail.)</p>
   <p>But for Mastodon and BlueSky post announcements, each post should be distributed immediately following its observation. So soon after we see an add message, we'll see messages like...</p>
   <pre><code class="language-plaintext">2025-01-13@17:34:42 [FINE] [com.mchange.feedletter.db.PgDatabase] Queued Mastodon post for distribution. Content: [stevefeeds-masto] New Post: Thousands sign petition calling on ad titan WPP to rethink its 4-day RTO demand, by pthompson@insider.com (Polly Thompson) https://www.businessinsider.com/wpp-return-to-office-thousands-sign-petition-workers-2025-1 
2025-01-13@17:34:42 [FINE] [com.mchange.feedletter.db.PgDatabase] Assignable (item collection) defined by subscribable name 'stevefeeds-masto', within-type-id 'http://www.inoreader.com/article/3a9c6e7789e019b1' has been deleted. 
2025-01-13@17:34:42 [FINE] [com.mchange.feedletter.db.PgDatabase] Cached values of items fully distributed have been cleared. 
2025-01-13@17:34:42 [INFO] [com.mchange.feedletter.db.PgDatabase] Completed assignable 'http://www.inoreader.com/article/3a9c6e7789e019b1' with subscribable 'stevefeeds-masto'. 
2025-01-13@17:34:42 [INFO] [com.mchange.feedletter.db.PgDatabase] Cleaned away data associated with completed assignable 'http://www.inoreader.com/article/3a9c6e7789e019b1' in subscribable 'stevefeeds-masto'. 
</code></pre>
   <p>After "completion", all data about the post is deleted, except the RSS guid and link are retained to prevent reannouncing the same post should it reappear in the RSS.</p>
   <p>Once queued for distribution, you will see messages about postings to Mastodon and BlueSky.</p>
   <p>Since on very active feeds, you can get a lot of posts at once when they are republished, <code>feedletter</code> spaces postings to a single account by one minute (currently hardcoded, eventually configurable), though it sends its posting streams to all subscribed accounts in parallel.</p>
   <p>So you'll see stuff like this:</p>
   <pre><code class="language-plaintext">2025-01-13@17:52:48 [INFO] [com.mchange.feedletter.db.PgDatabase] Posted BlueSky notification to (https://bsky.social/,testable-bsky.bsky.social) 
2025-01-13@17:53:13 [FINE] [com.mchange.feedletter.db.PgDatabase] Deleting any as-yet-unassigned items that have been deleted from feed with ID 1 
2025-01-13@17:53:13 [INFO] [com.mchange.feedletter.db.PgDatabase] Updated/assigned all items from feed with ID 1, feed URL 'https://www.inoreader.com/stream/user/0000000000/tag/all-articles' 
2025-01-13@17:53:15 [INFO] [com.mchange.feedletter.db.PgDatabase] Posted Mastodon notification to (https://mas.to/,arbitrary-name) 
</code></pre>
   <p>And we see posts!</p>
   <div style="text-align: center; margin-bottom: 1em;">
    <img src="2025/01/14/syndicating-rss-to-mastodon-and-bluesky-with-feedletter/example-masto.png" width="80%">
   </div>
   <div style="text-align: center;">
    <img src="2025/01/14/syndicating-rss-to-mastodon-and-bluesky-with-feedletter/example-bsky.png" width="80%">
   </div>
   <p>Sometimes things do go wrong!</p>
   <pre><code class="language-plaintext">2025-01-13@17:56:49 [WARNING] [com.mchange.feedletter.db.PgDatabase] Failed attempt to post to Bluesky destination 'https://bsky.social/', retried = 0 (maxRetries: 10) 
requests.RequestFailedException: Request to https://bsky.social/xrpc/com.atproto.repo.createRecord failed with status code 400
{"error":"InvalidRequest","message":"Invalid app.bsky.feed.post record: Record/text must not be longer than 300 graphemes"}
	at requests.Requester$$anon$1.readBytesThrough(Requester.scala:360)
	at geny.Readable.writeBytesTo(Writable.scala:93)
	at geny.Readable.writeBytesTo$(Writable.scala:91)
        ...
2025-01-13@17:56:49 [WARNING] [com.mchange.feedletter.db.PgDatabase] Attempt to post BlueSky notification to (https://bsky.social/,testable-bsky.bsky.social) failed or was skipped. Postable: BskyPostable(6,[stevefeeds-bsky] New Post: In DISSENT's winter issue, I make the case for left-YIMBYism in a debate with Brian Callaci and Sandeep Vaheesan https://www.dissentmagazine.org/article/supply-and-the-housing-crisis-a-debate/, by @resnikoff.bsky.social - Ned Resnikoff https://bsky.app/profile/resnikoff.bsky.social/post/3lfnb24zzbc2c,https://bsky.social/,testable-bsky.bsky.social,0,List()) 
</code></pre>
   <p><code>feedletter</code> will retry failed postings up to 10 times by default (the retry count is reconfigurable), then give up. This issue — the announcement is just too long to fit in BlueSky's 300 character limit — will not be cured, so that's what will happen. (I'll probably modify the BlueSky subscribable to just reject too-long posts, but for now they are just tried, retried, and eventually dropped.)</p>
   <h3><a href="#17-enable-feedletter-as-a-systemd-daemon" id="17-enable-feedletter-as-a-systemd-daemon" name="17-enable-feedletter-as-a-systemd-daemon" class="anchorlink"></a>17. Enable feedletter as a systemd daemon</h3>
   <p>We just place a systemd unit file <code>/opt/feedletter</code>, and then symlink it from <code>/etc/systemd/system</code>.</p>
   <pre><code class="language-plaintext">[Unit]
Description=Feedletter RSS-To-Mail-Etc Service
After=syslog.target network.target

[Service]
Type=forking
PIDFile=/opt/feedletter/feedletter.pid
User=feedletter
Group=feedletter
WorkingDirectory=/opt/feedletter

#
# feedletter daemon behaves as a traditional forking service
# when given the --fork flag
#
# its launcher, mill, will fork a feedletter process,
# write a PID file for that process in the base working directory
# and then exit
#
ExecStart=/opt/feedletter/feedletter daemon --fork

TimeoutStopSec=90
Restart=on-failure
RestartSec=10s
StandardError=journal
StandardOutput=journal
StandardInput=null

[Install]
WantedBy=multi-user.target
</code></pre>
   <p>Then it's just</p>
   <pre><code class="language-plaintext"># systemctl enable feedletter
# systemctl start feedletter
</code></pre>
   <p>We verify that the service is running.</p>
   <pre><code class="language-plaintext"># journalctl -u feedletter --follow
Jan 13 20:15:55 temp-feedletter systemd[1]: feedletter.service: Consumed 18.609s CPU time, 222M memory peak.
Jan 13 20:15:55 temp-feedletter systemd[1]: Starting feedletter.service - Feedletter RSS-To-Mail-Etc Service...
Jan 13 20:15:56 temp-feedletter feedletter[70034]: =========================================== runMainDaemon PreMain daemon --fork ======================================
Jan 13 20:15:56 temp-feedletter feedletter[70034]: ======================================================================================================================
Jan 13 20:15:59 temp-feedletter feedletter[70034]: [62/62] =================================== runMainDaemon PreMain daemon --fork =================================== 3s
Jan 13 20:15:59 temp-feedletter feedletter[70034]: ======================================================================================================================
Jan 13 20:16:00 temp-feedletter systemd[1]: Started feedletter.service - Feedletter RSS-To-Mail-Etc Service.
Jan 13 20:16:01 temp-feedletter feedletter[70086]: Jan 13, 2025 8:16:01 PM com.mchange.v2.log.MLog
Jan 13 20:16:01 temp-feedletter feedletter[70086]: INFO: MLog clients using java 1.4+ standard logging.
Jan 13 20:16:03 temp-feedletter feedletter[70086]: 2025-01-13@20:16:03 [INFO] [com.mchange.feedletter.Daemon] feedletter-0.1.0-13-60e19c daemon (re)starting.
Jan 13 20:16:03 temp-feedletter feedletter[70086]: 2025-01-13@20:16:03 [INFO] [com.mchange.feedletter.Daemon] Spawning daemon fibers.
Jan 13 20:16:03 temp-feedletter feedletter[70086]: 2025-01-13@20:16:03 [INFO] [com.mchange.feedletter.Daemon] Starting web API service on interface '127.0.0.1', port 8024.
Jan 13 20:16:04 temp-feedletter feedletter[70086]: timestamp=2025-01-13T20:16:04.337801942Z level=INFO thread=#zio-fiber-614230192 message="Starting the server..." location=com.mchange.feedletter.Daemon.webDaemon file=Daemon.scala line=189
Jan 13 20:16:04 temp-feedletter feedletter[70086]: timestamp=2025-01-13T20:16:04.470643106Z level=INFO thread=#zio-fiber-614230192 message="Server started" location=com.mchange.feedletter.Daemon.webDaemon file=Daemon.scala line=189
Jan 13 20:16:41 temp-feedletter feedletter[70086]: 2025-01-13@20:16:41 [FINE] [com.mchange.feedletter.db.PgDatabase] Deleting any as-yet-unassigned items that have been deleted from feed with ID 1
Jan 13 20:16:41 temp-feedletter feedletter[70086]: 2025-01-13@20:16:41 [INFO] [com.mchange.feedletter.db.PgDatabase] Updated/assigned all items from feed with ID 1, feed URL 'https://www.inoreader.com/stream/user/0000000000/tag/all-articles'

</code></pre>
   <p>Looks Good!</p>
   <h3><a href="#18-conclusion" id="18-conclusion" name="18-conclusion" class="anchorlink"></a>18. Conclusion</h3>
   <p>That's it!</p>
   <p>It seems like a lot, but it's much easier done than said. Give it a try. It won't bite.</p>
   <p>It is also possible to customize the announcement messages that feedletter syndicates, or to include post text, length permitting. If that would be useful to you, <a href="mailto:swaldman@mchange.com">Let me know</a> and I'll add a quick tutorial on that.</p>
  </div>
 </div>
 <div class="entry-footer">
  <div class="post-metainfo">
   <div>
    <a href="2025/01/14/syndicating-rss-to-mastodon-and-bluesky-with-feedletter/index.html" class="pubtime">04:00 PM EST</a>
   </div>
  </div>
 </div>
</article>
<div class="after-article">
</div><!-- after-article --><div class="entry-separator"></div><div class="day-stamp">
 2025-01-06 <span class="arrow">⇒</span>
</div>
<article class="presentation-multiple uid-supporting-all-item-rss">
 <div class="entry-header">
  <h1><a href="2025/01/06/supporting-all-item-rss/index.html">Supporting all-item RSS</a></h1>
  <hr class="below-title">
 </div>
 <div class="entry-body">
  <div class="flexmark markdown">
   <p>In addition to <a href="2024/11/12/supporting-single-item-rss/index.html">single-item RSS</a> for each post, this blog now offers <em>all-item-rss</em>. <a href="/all-item-feed/index.rss">Check it out.</a>. It's effectively a full-content archive of the site, in the form of easy-to-parse RSS.</p>
   <p><a href="drafts.interfluidity.com"><code>drafts.interfluidity.com</code></a> supports both of these features as well. (Here's the <a href="https://drafts.interfluidity.com/all-item-feed/index.rss">all-items-feed</a>, an example <a href="https://drafts.interfluidity.com/2024/09/17/abundance-is-overcapacity/index.rss">single-item-feed</a>.)</p>
   <p>The channel element of these feeds includes metadata describing them. <a href="xml/iffy/index.html#iffy-curation"><code>iffy:curation</code></a> describes how many and what sort of items are included in the feed. <a href="xml/iffy/index.html#iffy-completeness"><code>iffy:completeness</code></a> describes how complete <em>each</em> item is, i.e. whether it include full content, or even potentially embeds media.</p>
   <p>Here's an example from an all-item feed:</p>
   <pre><code class="language-xml">&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;rss version="2.0" xmlns:iffy="http://tech.interfluidity.com/xml/iffy/" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/"&gt;
  &lt;channel&gt;
    ...
    &lt;iffy:curation&gt;
      &lt;iffy:all/&gt;
    &lt;/iffy:curation&gt;
    &lt;iffy:completeness&gt;Content&lt;/iffy:completeness&gt;
    ...
  &lt;/channel&gt;
&lt;/rss&gt;
</code></pre>
   <p>Here is an example from a single-item feed:</p>
   <pre><code class="language-xml">&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;rss version="2.0" xmlns:iffy="http://tech.interfluidity.com/xml/iffy/" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/"&gt;
  &lt;channel&gt;
    ...
    &lt;iffy:curation&gt;
      &lt;iffy:single/&gt;
    &lt;/iffy:curation&gt;
    &lt;iffy:completeness&gt;Content&lt;/iffy:completeness&gt;
    ...
  &lt;/channel&gt;
&lt;/rss&gt;
</code></pre>
   <p>An ordinary syndicatin feed that includes curation and completeness metadata looks like this:</p>
   <pre><code class="language-xml">&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;rss version="2.0" xmlns:iffy="http://tech.interfluidity.com/xml/iffy/" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/"&gt;
  &lt;channel&gt;
    ...
    &lt;iffy:curation&gt;
      &lt;iffy:recent last="5"/&gt;
    &lt;/iffy:curation&gt;
    &lt;iffy:completeness&gt;Content&lt;/iffy:completeness&gt;
    ...
  &lt;/channel&gt;
&lt;/rss&gt;
</code></pre>
   <p>All-item and single-item feeds, like syndication feeds, are discoverable in <code>&lt;link rel="alternate"&gt;</code> elements of the HTML pages of the blog.</p>
   <p>But they are not intended to be discovered by feed readers, which expect short feeds of recent posts for syndication. In order to prevent discovery of these feeds by feed readers, we give them special MIME type <em>in HTML link elements only</em>. These are still RSS feeds. Their "true" MIME type is still <code>application/rss+xml</code>.</p>
   <p>But in HTML link elements — only in HTML link elements — I use more specific, less standard MIME types, to throw unwitting feed readers off the scent. These MIME types are <code>application/x-all-item-rss+xml</code> and <code>application/x-single-item-rss+xml</code>.</p>
   <p>Here's the HTML link element to a site's all-item feed:</p>
   <pre><code class="language-html">  &lt;link rel="alternate" type="application/x-all-item-rss+xml" title="drafts.interfluidity.com - all items" href="https://drafts.interfluidity.com/all-item-feed/index.rss"&gt;
</code></pre>
   <p>Here's the HTML link element from a post permalink to that post's single-item feed:</p>
   <pre><code class="language-html">  &lt;link rel="alternate" type="application/x-single-item-rss+xml" title="Segmentation fault" href="index.rss"&gt;
</code></pre>
   <p>While ordinary feed readers should ignore these feeds, clients resolving <a href="xml/iffy/index.html#iffy-item-ref"><code>iffy:item-ref</code></a> tags might find single-item and all-item feeds very useful.</p>
  </div>
 </div>
 <div class="entry-footer">
  <div class="post-metainfo">
   <div>
    <a href="2025/01/06/supporting-all-item-rss/index.html" class="pubtime">08:30 PM EST</a>
   </div>
  </div>
 </div>
</article>
<div class="after-article">
</div><!-- after-article --><div class="entry-separator"></div><div class="day-stamp">
 2024-12-22 <span class="arrow">⇒</span>
</div>
<article class="presentation-multiple synthetic">
 <div class="entry-header">
  <h1><a href="xml/iffy/index-updated-2024-12-22-10-40-00.html">Updated: The 'iffy' XML namespace</a></h1>
  <hr class="below-title">
 </div>
 <div class="entry-body">
  <p>A significant update of <a href="xml/iffy/index.html"><i>The 'iffy' XML namespace</i></a> was made on 2024-12-22 @ 10:40 AM EST.</p>
  <blockquote>
   → Document <code>iffy:item-ref</code> and <code>iffy:in-reply-to</code>.
  </blockquote>
  <p>The post was originally published 2024-05-13 @ 04:10 AM EDT.</p>
 </div>
 <div class="entry-footer">
  <div class="post-metainfo">
   <div class="synthetic-note">
    <em>This is an automatically generated post.</em>
   </div>
   <div>
    <a href="xml/iffy/index-updated-2024-12-22-10-40-00.html" class="pubtime">10:40 AM EST</a>
   </div>
  </div>
 </div>
</article>
<div class="after-article">
</div><!-- after-article --><div class="entry-separator"></div><div class="day-stamp">
 2024-11-15 <span class="arrow">⇒</span>
</div>
<article class="presentation-multiple synthetic">
 <div class="entry-header">
  <h1><a href="xml/iffy/index-updated-2024-11-15-01-10-00.html">Updated: The 'iffy' XML namespace</a></h1>
  <hr class="below-title">
 </div>
 <div class="entry-body">
  <p>A significant update of <a href="xml/iffy/index.html"><i>The 'iffy' XML namespace</i></a> was made on 2024-11-15 @ 01:10 AM EST.</p>
  <blockquote>
   → Document <code>iffy:curation</code>, and curation type elements <code>iffy:all</code>, <code>iffy:recent</code>, <code>iffy:selection</code>, <code>iffy:single</code>.
  </blockquote>
  <p>The post was originally published 2024-05-13 @ 04:10 AM EDT.</p>
 </div>
 <div class="entry-footer">
  <div class="post-metainfo">
   <div class="synthetic-note">
    <em>This is an automatically generated post.</em>
   </div>
   <div>
    <a href="xml/iffy/index-updated-2024-11-15-01-10-00.html" class="pubtime">01:10 AM EST</a>
   </div>
  </div>
 </div>
</article>
<div class="after-article">
</div><!-- after-article --><div class="entry-separator"></div><div class="day-stamp">
 2024-11-12 <span class="arrow">⇒</span>
</div>
<article class="presentation-multiple uid-supporting-single-item-rss">
 <div class="entry-header">
  <h1><a href="2024/11/12/supporting-single-item-rss/index.html">Supporting single-item RSS</a></h1>
  <hr class="below-title">
 </div>
 <div class="entry-body">
  <div class="flexmark markdown">
   <p>This blog now <a href="2024/11/12/supporting-single-item-rss/index.rss">generates</a> single-item RSS alongside each blog post.</p>
   <p>This is in preparation for how I mean to support blog-to-blog comments, most directly.</p>
   <p>But in general it is offered as an alternative to approaches like <a href="https://microformats.org/">microformats</a>.</p>
   <p>Microformats exist and other people use them. I feel a bit bad not to adopt them. But my preference is to have meta-data more cleanly separated from displayed HTML, even if it is "<a href="https://microformats.org/wiki/posh">POSH</a>". It seems to me like too many concerns are mixed.</p>
   <p>If microformats were very widely adopted — particularly if the JVM ecosystem already had well-supported, widely used microformats parsers — I might swallow my own preference and run with them. But I don't think that's the case. I'm going to have to do my own parsing, and I have good tools for that with XML and RSS.</p>
   <p><a href="https://github.com/swaldman/unstatic"><code>unstatic</code></a> <code>SimpleBlog</code> instances now support generating single-item RSS. Just override</p>
   <pre><code class="language-scala">val generateSingleItemRss : Boolean
</code></pre>
   <p>to <code>true</code>, and they will appear.</p>
   <p>By default, each entry's single-item RSS is placed by converting each <code>whatever.html</code> to <code>whatever.rss</code>, under the same path. (If the leaf of the path does not end with <code>.html</code>, then <code>.rss</code> is simply appended to the full path.)</p>
   <p>If you prefer a different scheme, you can override</p>
   <pre><code class="language-scala">def singleItemRssSiteRootedFromPermalinkSiteRooted( permalinkSiteRooted : Rooted ) : Rooted
</code></pre>
   <p>where <code>Rooted</code> is a <a href="https://github.com/swaldman/unstatic/blob/main/src/unstatic/UrlPath.scala"><code>unstantic.UrlPath.Rooted</code></a>.</p>
   <p>Single-item RSS and the HTML "permalink" for the item should mutually refer to one another.</p>
   <p>In the HTML header tag, we add a <code>&lt;link&gt;</code> tag with <code>rel="alternate"</code> to point to the single-item RSS.</p>
   <p>We <em>don't</em> want feed readers to subscribe to single-item RSS, so, a bit clumsily, we make up a special content type that feed readers won't recognize, <code>application/x-single-item-rss+xml</code>.</p>
   <p>Here's the link you'll find in the source of this post.</p>
   <pre><code class="language-html">&lt;link rel="alternate" type="application/x-single-item-rss+xml" title="Supporting single-item RSS" href="index.rss"&gt;
</code></pre>
   <p>The single-item RSS links back to the HTML as a matter of course, via the standard <code>&lt;link&gt;</code> element within the sole <code>&lt;item&gt;</code>.</p>
   <p>Check out <a href="2024/11/12/supporting-single-item-rss/index.rss">the single-item RSS for this post</a>!</p>
   <hr>
   <div style="font-size: smaller">
    <p><strong>Note:</strong> If an <code>&lt;atom:link rel="self" /&gt;</code> tag is included in the <code>&lt;channel&gt;</code> element of a single-item RSS stream, the type should be the standard <code>type="application/rss+xml"</code>, <span style="color: red"> <strong>and definitely not</strong> </span> <code>application/x-single-item-rss+xml</code>. (I recommend <code>&lt;atom:link rel="self" /&gt;</code> <em>always</em> be included in the <code>&lt;channel&gt;</code> of an RSS stream, whenever there exists a stable link to the stream.) Single-item RSS is just standard RSS for all purposes other than a feed-reader deciding whether to treat a feed as subscribable.</p>
   </div>
  </div>
 </div>
 <div class="entry-footer">
  <div class="post-metainfo">
   <div>
    <a href="2024/11/12/supporting-single-item-rss/index.html" class="pubtime">06:30 AM EST</a>
   </div>
  </div>
 </div>
</article>
<div class="after-article">
</div><!-- after-article --><div class="entry-separator"></div><div class="day-stamp">
 2024-11-02 <span class="arrow">⇒</span>
</div>
<article class="presentation-multiple synthetic">
 <div class="entry-header">
  <h1><a href="xml/iffy/index-updated-2024-11-02-17-15-00.html">Updated: The 'iffy' XML namespace</a></h1>
  <hr class="below-title">
 </div>
 <div class="entry-body">
  <p>A significant update of <a href="xml/iffy/index.html"><i>The 'iffy' XML namespace</i></a> was made on 2024-11-02 @ 05:15 PM EDT.</p>
  <blockquote>
   → Clarifications of iffy:provenance and iffy:update-history.
  </blockquote>
  <p>The post was originally published 2024-05-13 @ 04:10 AM EDT.</p>
 </div>
 <div class="entry-footer">
  <div class="post-metainfo">
   <div class="synthetic-note">
    <em>This is an automatically generated post.</em>
   </div>
   <div>
    <a href="xml/iffy/index-updated-2024-11-02-17-15-00.html" class="pubtime">05:15 PM EDT</a>
   </div>
  </div>
 </div>
</article>
<div class="after-article">
</div><!-- after-article --><div class="entry-separator"></div><div class="day-stamp">
 2024-08-16 <span class="arrow">⇒</span>
</div>
<article class="presentation-multiple synthetic">
 <div class="entry-header">
  <h1><a href="2024/06/06/neonix/index-updated-2024-08-16-11-20-00.html">Updated: Neonix</a></h1>
  <hr class="below-title">
 </div>
 <div class="entry-body">
  <p>A significant update of <a href="2024/06/06/neonix/index.html"><i>Neonix</i></a> was made on 2024-08-16 @ 11:20 AM EDT.</p>
  <blockquote>
   → Add update regarding new location of Bill Mill's "modern unix tool list"
  </blockquote>
  <p>The post was originally published 2024-06-06 @ 03:35 PM EDT.</p>
 </div>
 <div class="entry-footer">
  <div class="post-metainfo">
   <div class="synthetic-note">
    <em>This is an automatically generated post.</em>
   </div>
   <div>
    <a href="2024/06/06/neonix/index-updated-2024-08-16-11-20-00.html" class="pubtime">11:20 AM EDT</a>
   </div>
  </div>
 </div>
</article>
<div class="after-article">
</div><!-- after-article -->
      </div>
      <div id="right-sidebar">
      </div>
    </div>
  </body>
</html>
