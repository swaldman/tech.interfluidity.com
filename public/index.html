<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="description" content="tech notebook @ interfluidity">
    <meta name="keywords" content="Scala, tech, interfluidity">
    <meta name="author" content="Steve Randy Waldman">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- icons / favicons -->

    <!-- we just want the squared-corner image with no overlays for traditional favicon uses at tiny sizes -->
    <!-- swaldman added, ick, firefox scales down the biggest size for its tab icon, so we use the graphic we want for small sizes as the largest... -->
    <link rel="icon" type="image/png" sizes="500x500" href="icon/interfluidity-wave-blank-square-500x500.png"> 
    <link rel="icon" type="image/png" sizes="32x32" href="icon/interfluidity-wave-blank-square-32x32.png">     <!-- swaldman added, for standard favicon size -->
    <link rel="icon" type="image/png" sizes="16x16" href="icon/interfluidity-wave-blank-square-16x16.png">     <!-- swaldman added, for standard favicon size -->
    <link rel="icon" type="image/png" href="icon/interfluidity-wave-blank-square-57x57.png">                   <!-- swaldman added, for small icons by default -->

    <!-- at bigger sizes, we overlay a bit of text -->
    <!-- icons as recommened by https://mathiasbynens.be/notes/touch-icons -->
    <!-- For Chrome for Android: -->
    <link rel="icon" sizes="192x192" href="icon/interfluidity-wave-tech-192x192.png">
    <!-- For iPhone 6 Plus with @3× display: -->
    <link rel="apple-touch-icon-precomposed" sizes="180x180" href="icon/interfluidity-wave-tech-180x180.png">
    <!-- For iPad with @2× display running iOS ≥ 7: -->
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="icon/interfluidity-wave-tech-152x152.png">
    <!-- For iPad with @2× display running iOS ≤ 6: -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="icon/interfluidity-wave-tech-144x144.png">
    <!-- For iPhone with @2× display running iOS ≥ 7: -->
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="icon/interfluidity-wave-tech-120x120.png">
    <!-- For iPhone with @2× display running iOS ≤ 6: -->
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="icon/interfluidity-wave-tech-114x114.png">
    <!-- For the iPad mini and the first- and second-generation iPad (@1× display) on iOS ≥ 7: -->
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="icon/interfluidity-wave-tech-76x76.png">
    <!-- For the iPad mini and the first- and second-generation iPad (@1× display) on iOS ≤ 6: -->
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="icon/interfluidity-wave-tech-72x72.png">
    <!-- For non-Retina iPhone, iPod Touch, and Android 2.1+ devices: -->
    <link rel="apple-touch-icon-precomposed" href="icon/interfluidity-wave-blank-square-57x57.png">

    <!-- end icons / favicons -->
    
    <link rel="alternate" type="application/rss+xml" title="tech.interfluidity.com updates" href="feed/index.rss">
    <link rel="alternate" type="application/rss+xml" title="interfluidity - all blogs" href="https://www.interfluidity.com/unify-rss/all-blogs.rss">
    <link rel="alternate" type="application/rss+xml" title="interfluidity - all blogs and microblogs" href="https://www.interfluidity.com/unify-rss/all-blogs-and-microblogs.rss">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/highlightjs/steve-night-owl.css"><!-- theme for highlight.js -->
    <script src="js/highlight/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
          const regex = /(^.*)\-oldcommit\-[0-9A-Fa-f]+\.html/;
          const match = window.location.pathname.match(regex);
          if (match) {
              const b  = document.querySelector("body");
              const tb = document.getElementById("top-banner");
              b.classList.add("old-draft");
              tb.innerHTML = "You are looking at an old, superceded version of this page. For the current version, please <a href=\"" + match[1] + ".html\">click here</a>.";
          }
       });
    </script>
    <title>tech &mdash; interfluidity</title>
  </head>
  <body>
    <div id="top-banner"></div>
    <div id="header">
      <div id="rss-link-container">
        <a id="rss-link" href="feed/index.rss"><span class="outer">(</span><span class="middle">(</span><span class="inner">(</span><span class="bullet">&bull;</span><span class="inner">)</span><span class="middle">)</span><span class="outer">)</span></a>
      </div>
      <div class="main-title"><a href="https://tech.interfluidity.com/">tech.interfluidity.com</a></div>
      <div class="tagline">a notebook by <a href="https://www.interfluidity.com/">steve&nbsp;randy&nbsp;waldman</a></div>
      <div class="see-also">&rarr; See also <a href="index.html">top</a>, <a href="archive.html">archive</a>, <a href="subscribe.html">subscribe</a>, <a href="https://drafts.interfluidity.com/">drafts blog</a>, <a href="https://www.interfluidity.com/">interfluidity main</a></div>
    </div>
    <div id="main">
      <div id="left-sidebar">
      </div>
      <div id="content">
        <div class="day-stamp">
 2024-06-16 <span class="arrow">⇒</span>
</div>
<article class="presentation-multiple">
 <div class="entry-header">
  <h1><a href="2024/06/16/html-iconography/index.html">HTML iconography</a></h1>
  <hr class="below-title">
 </div>
 <div class="entry-body">
  <div class="flexmark markdown">
   <p>My web skillz are very old-school.</p>
   <p>I only recently learned we're not supposed to use <code>&lt;tt&gt;</code> anymore. (<code>&lt;code&gt;</code> is what the kids use.) We're not supposed to use <code>&lt;a name="whatev"&gt;</code> for our in-document link targets. We should just use <code>&lt;a id="whatev"&gt;</code>.</p>
   <p>(To be fair, it's pretty cool the targets don't have to be <code>&lt;a&gt;</code> tags any more.)</p>
   <p>Anyway, back in my day, to add little icons that might represent your website, we just added a 16x16 pixel <code>/favicon.ico</code> file in some weird, nonstandard Microsoft image format.</p>
   <p>Thank you <em>Internet Explorer</em>, the very first evil internet silo that kids these days have never encountered!</p>
   <p>My ancient <a href="https://www.interfluidity.com/">"interfluidity main" site</a> has one of those old-school <code>/favicon.ico</code> files, and I'm not messing with it. But I thought I'd add fresh icons for this site and <a href="https://drafts.interfluidity.com/"><em>interfluidity drafts</em></a>, for my nouveau web. One 16x16 icon file isn't enough for the modern world. Your site might need an icon on a phone, a tablet, a watch, whatver. Android and Apple devices treat icons differently. Firefox, I discovered, chooses icons differently than other browsers.</p>
   <p>The best resource I found to help make sense of the brave new world of website icons was <a href="https://mathiasbynens.be/notes/touch-icons">an article by Mathias Bynens</a>.</p>
   <p>That article's last update was in 2013, so maybe it's not current? It's a decade newer than my old habits, so hey.</p>
   <p>I used <a href="https://affinity.serif.com/en-us/photo/"><em>Affinity Photo</em></a> to take the photo I use as an avatar on social media, and label it, for this website as "tech". For prettiness as icons on mobile devices, I also needed to give it rounded corners. I wanted to select a rectangle, round the corners, then invert the selection, and delete to transparent to make rounded corners.</p>
   <p>That'a basically what I did, but there's nowhere to set a corner radius on a straight-up rectangualar selection in <em>Affinity Photo</em>.</p>
   <p>However, there is a rounded rectangle drawing tool, which draws on its own layer, and — very useful to know! — there is a <a href="https://forum.affinity.serif.com/index.php?/topic/45495-affinity-photo-how-to-create-rounded-corners/">Selection From Layer</a> menu item, that converts a shape drawn in a layer to a selection. Once I had my selection, invert and delete was no problem and I got my rounded corners.</p>
   <p style="text-align: center;"><img src="2024/06/16/html-iconography/interfluidity-wave-tech-180x180.png" style="width: min-content; left-margin: auto; right-margin: auto;"></p>
   <p>I gather one can omit rounding corners oneself, if you only care about Apple devices. Apple defines <code>apple-touch-icon</code> and <code>apple-touch-icon-precomposed</code>, and if you supply the not-precomposed version, devices should round corners and maybe drop shadow to "compose" your icon.</p>
   <p>Most resources I looked at suggested taking control, so you know what you will get and can use the same icons crossplatform, so that's what I did. So, I rounded my own corners yee-haw!</p>
   <p>Then I exported my image as a PNG in all of the sizes recommended by <a href="https://mathiasbynens.be/notes/touch-icons">the Bynens article</a>, stole his recommended HTML snippet, and added it — with some modification, see below! — to the <a href="https://github.com/swaldman/tech.interfluidity.com/blob/main/untemplate/com/interfluidity/tech/layout-main.html.untemplate">main layout</a> of my <a href="https://github.com/swaldman/unstatic"><code>unstatic</code></a>-based static-site generators.</p>
   <pre><code class="language-html">    &lt;!-- icons / favicons --&gt;

    &lt;!-- we just want the squared-corner image with no overlays for traditional favicon uses at tiny sizes --&gt;
    &lt;!-- swaldman added, ick, firefox scales down the biggest size for its tab icon, so we use the graphic we want for small sizes as the largest... --&gt;
    &lt;link rel="icon" type="image/png" sizes="500x500" href="&lt;( iconLoc.relative )&gt;/interfluidity-wave-blank-square-500x500.png"&gt; 
    &lt;link rel="icon" type="image/png" sizes="32x32" href="&lt;( iconLoc.relative )&gt;/interfluidity-wave-blank-square-32x32.png"&gt;     &lt;!-- swaldman added, for standard favicon size --&gt;
    &lt;link rel="icon" type="image/png" sizes="16x16" href="&lt;( iconLoc.relative )&gt;/interfluidity-wave-blank-square-16x16.png"&gt;     &lt;!-- swaldman added, for standard favicon size --&gt;
    &lt;link rel="icon" type="image/png" href="&lt;( iconLoc.relative )&gt;/interfluidity-wave-blank-square-57x57.png"&gt;                   &lt;!-- swaldman added, for small icons by default --&gt;

    &lt;!-- at bigger sizes, we overlay a bit of text --&gt;
    &lt;!-- icons as recommened by https://mathiasbynens.be/notes/touch-icons --&gt;
    &lt;!-- For Chrome for Android: --&gt;
    &lt;link rel="icon" sizes="192x192" href="&lt;( iconLoc.relative )&gt;/interfluidity-wave-tech-192x192.png"&gt;
    &lt;!-- For iPhone 6 Plus with @3× display: --&gt;
    &lt;link rel="apple-touch-icon-precomposed" sizes="180x180" href="&lt;( iconLoc.relative )&gt;/interfluidity-wave-tech-180x180.png"&gt;
    &lt;!-- For iPad with @2× display running iOS ≥ 7: --&gt;
    &lt;link rel="apple-touch-icon-precomposed" sizes="152x152" href="&lt;( iconLoc.relative )&gt;/interfluidity-wave-tech-152x152.png"&gt;
    &lt;!-- For iPad with @2× display running iOS ≤ 6: --&gt;
    &lt;link rel="apple-touch-icon-precomposed" sizes="144x144" href="&lt;( iconLoc.relative )&gt;/interfluidity-wave-tech-144x144.png"&gt;
    &lt;!-- For iPhone with @2× display running iOS ≥ 7: --&gt;
    &lt;link rel="apple-touch-icon-precomposed" sizes="120x120" href="&lt;( iconLoc.relative )&gt;/interfluidity-wave-tech-120x120.png"&gt;
    &lt;!-- For iPhone with @2× display running iOS ≤ 6: --&gt;
    &lt;link rel="apple-touch-icon-precomposed" sizes="114x114" href="&lt;( iconLoc.relative )&gt;/interfluidity-wave-tech-114x114.png"&gt;
    &lt;!-- For the iPad mini and the first- and second-generation iPad (@1× display) on iOS ≥ 7: --&gt;
    &lt;link rel="apple-touch-icon-precomposed" sizes="76x76" href="&lt;( iconLoc.relative )&gt;/interfluidity-wave-tech-76x76.png"&gt;
    &lt;!-- For the iPad mini and the first- and second-generation iPad (@1× display) on iOS ≤ 6: --&gt;
    &lt;link rel="apple-touch-icon-precomposed" sizes="72x72" href="&lt;( iconLoc.relative )&gt;/interfluidity-wave-tech-72x72.png"&gt;
    &lt;!-- For non-Retina iPhone, iPod Touch, and Android 2.1+ devices: --&gt;
    &lt;link rel="apple-touch-icon-precomposed" href="&lt;( iconLoc.relative )&gt;/interfluidity-wave-blank-square-57x57.png"&gt;

    &lt;!-- end icons / favicons --&gt;
</code></pre>
   <p>A complication emerged, in that my text-labeled icons looked busy and bad, and the text was illegible, when rendered at very small sizes. So you'll note that, for small sizes, I use <code>interfluidity-wave-blank-square</code> files rather than <code>interfluidity-wave-tech</code>. (I thought the very small icons looked better with square corners as well.)</p>
   <p>But Firefox kept picking up the <em>largest</em> <code>&lt;link rel="icon" ... &gt;</code> and downsampling from that, rather than downloading the nearest or nearest-larger icon.</p>
   <p>So I added the image I want used only for small icons also as a very large icon.</p>
   <pre><code class="language-html">    &lt;link rel="icon" type="image/png" sizes="500x500" href="&lt;( iconLoc.relative )&gt;/interfluidity-wave-blank-square-500x500.png"&gt; 
</code></pre>
   <p>Less quirky browsers hopefully never choose this to render from, because there is always a better-sized icon to choose from. But Firefox does choose this one and downsample to render its very small icons-in-a-tab, so the trick gets rid of the ugly, illegibly scaled text in tiny icons under Firefox.</p>
   <p>(It does seem a bit wasteful to trick Firefox into downloading 500x500 images to render at 16x16 or 32x32, but if it smartens up, it can download icons prerendered in just those tiny sizes!)</p>
   <p>Anyway, that was what I did to add icons to this site and to <a href="https://drafts.interfluidity.com/"><em>drafts</em></a>.</p>
   <p>Please let me know if there are much better ways!</p>
  </div>
 </div>
 <div class="entry-footer">
  <div class="post-metainfo">
   <a href="2024/06/16/html-iconography/index.html">07:10 PM EDT</a>
  </div>
 </div>
</article>
<div class="after-article">
</div><!-- after-article --><div class="entry-separator"></div><div class="day-stamp">
 2024-06-08 <span class="arrow">⇒</span>
</div>
<article class="presentation-multiple">
 <div class="entry-header">
  <h1><a href="2024/06/08/should-blogs-adopt-the-itunescategory-rss-tag/index.html">Should blogs adopt the itunes:category RSS tag?</a></h1>
  <hr class="below-title">
 </div>
 <div class="entry-body">
  <div class="flexmark markdown">
   <p>Apple organized a <a href="https://podcasters.apple.com/support/1691-apple-podcasts-categories">whole slew of standard categories or genres</a> for podcasts, when they defined the <a href="https://help.apple.com/itc/podcasts_connect/#/itcb54353390"><code>itunes</code> RSS namespace</a> for podcasts. This helped discoverability of podcasts, as podcast applications and indexers can let users search or browse by genre, or make suggestions based on genres users seem to prefer.</p>
   <p>Apple seems to have done a pretty good job at this. It's not obvious that "podcast genres" are meaningfully distinct from "blog genres". We could, of course, invent some analogous kind of categorization just for blogs, but why? As Dave Winer <a href="http://scripting.com/2017/05/09/rulesForStandardsmakers.html">hath writ</a>:</p>
   <blockquote>
    <p><strong>Fewer format features is better</strong></p>
    <p>If you want to add a feature to a format, first carefully study the existing format and namespaces to be sure what you're doing hasn't already been done. If it has, use the original version. This is how you maximize interop.</p>
   </blockquote>
   <p>Podcasts got a huge lift from what was originally the blog-centric RSS format. Why haven't blogs adopted podcast-RSS best practices to get a lift right back?</p>
   <p>There's a potential issue that some applications may use the presence of <code>itunes</code> RSS tags to imply an RSS feed is for a podcast. But that's pretty dumb. If applications expecting podcasts import blogs without soundfiles because they use this heuristic, well, bad on them. They should fix that. When blogs do contain some posts with audio <code>&lt;enclosure/&gt;</code> elements, then arguably they are podcasts <em>inter alia</em>. Client applications should use intelligent criteria to decide what they want to consider suitably a "podcast" or "podcast episode".</p>
   <p>It strikes me as a good idea to make use of good ideas from the <code>itunes</code> (and <a href="https://github.com/Podcastindex-org/podcast-namespace"><code>podcast</code></a>) namespace for blogs and other RSS applications.</p>
   <p>Starting, perhaps, with <code>itunes:category</code>.</p>
   <p>Apple <a href="https://help.apple.com/itc/podcasts_connect/#/itcb54353390">defines</a> <code>itunes:category</code> as a channel-level element that permits multiple entries (you don't have to be just one genre), and nested entries for subcategories. Seems pretty good!</p>
   <p>What do you think?</p>
  </div>
 </div>
 <div class="entry-footer">
  <div class="post-metainfo">
   <a href="2024/06/08/should-blogs-adopt-the-itunescategory-rss-tag/index.html">07:50 PM EDT</a>
  </div>
 </div>
</article>
<div class="after-article">
</div><!-- after-article --><div class="entry-separator"></div><div class="day-stamp">
 2024-06-06 <span class="arrow">⇒</span>
</div>
<article class="presentation-multiple uid-readying-a-blog-for-sprouts">
 <div class="entry-header">
  <h1><a href="2024/06/06/neonix/index.html">Neonix</a></h1>
  <hr class="below-title">
 </div>
 <div class="update-prepend rss-description-exclude">
  <em> ➣&nbsp;&nbsp;This post was meaningfully revised at 2024-06-06 @ 06:30 PM EDT. The previous revision is <a href="2024/06/06/neonix/index-oldcommit-711778c5fa4d93cd89e9421da6b8d9fb6e71a534.html">here</a>. (See <a href="2024/06/06/neonix/index.html#update-history">update history</a>.) <br>
    ➣&nbsp;&nbsp;This post is expected to evolve over time. You can subscribe to ongoing updates <a href="2024/06/06/neonix/index-sprout.rss">here</a>. 
   <link rel="alternate" type="application/rss+xml" title="Update to Neonix" href="https://tech.interfluidity.com/2024/06/06/neonix/index-sprout.rss"></em>
  <hr>
 </div>
 <div class="entry-body">
  <div class="flexmark markdown">
   <p>I've found <a href="https://github.com/BurntSushi/ripgrep">ripgrep</a> to be an invaluable tool. At some level it's just grep, but its speed and ergonomics make it something else. I find things much more quickly. In combination with <a href="https://docs.projectile.mx/projectile/index.html">projectile</a>, it gives me a fast project-wide find, reducing one of the advantages of commercial IDEs over my humble <a href="https://www.gnu.org/software/emacs/">emacs</a>.</p>
   <p>Today, Bill Mill <a href="https://notes.billmill.org/computer_usage/cli_tips_and_tools/fzf.html">points me</a> to a command line tool called <a href="https://junegunn.github.io/fzf/"><code>fzf</code></a> which looks like kind of a command-line Swiss army knife. It certainly makes sorting through very long <code>find .</code> output a breeze.</p>
   <p>Some of Bill's scripts use a find replacement called <a href="https://github.com/sharkdp/fd"><code>fd</code></a>, which I plan to take a look at.</p>
   <p>I think this is an interesting trend, taking venerable UNIX command-line tools and rethinking, reimplementing them with modern languages and the decades of experience since that first, revolutioary, burst of command-line creativity in the early UNIX days.</p>
   <p>I'll let this post become a <a href="https://v5.chriskrycho.com/essays/feeds-are-not-fit-for-gardening/">"sprout"</a> from which I can track these kinds of tools as I encounter them.</p>
   <ul>
    <li>
     <p><a href="https://github.com/sharkdp/fd"><code>fd</code></a><br>
       A modern retake on <code>find</code> I haven't played with yet.</p></li>
    <li>
     <p><a href="https://junegunn.github.io/fzf/"><code>fzf</code></a><br>
       A fuzzy-matching tool for interactively sorting through large command line and command completion outputs. See <a href="https://notes.billmill.org/computer_usage/cli_tips_and_tools/fzf.html">Bill Mill</a>.</p></li>
    <li>
     <p><a href="https://github.com/BurntSushi/ripgrep"><code>rg</code></a><br>
       "ripgrep". A new take on grep, super fast, seachers directories recursively, by default excluding <code>.git</code> and whatever is <code>.gitignore</code>-d.</p></li>
   </ul>
   <p>I'll add more as I, um, <code>fd</code> them!</p>
   <hr>
   <p>p.s. apparently there's a <a href="https://www.insomniac.com/music/artists/neonix/">DJ called Neonix</a>! Sorry! I'm using the, er, neologism to refer to neo-UNIX.</p>
   <hr>
   <p><strong>Update 2024-06-06:</strong> Kartik Agaram's <a href="https://merveilles.town/@akkartik/112571589796019251">points</a> me to <a href="https://notes.billmill.org/link_blog/2023/10/modern_unix_tools.html">Bill Mill's "modern unix tools" page</a>. Which itself contains a link to a <a href="https://github.com/ibraheemdev/modern-unix">"Modern Unix" collection by Ibraheem Ahmed</a>. So much to play with!</p>
  </div>
 </div>
 <div class="entry-footer">
  <div class="post-metainfo">
   <a href="2024/06/06/neonix/index.html">03:35 PM EDT</a>
   <div class="updated-note">
    <a href="2024/06/06/neonix/index.html#major-updates">Last major update at 2024-06-06 @ 06:30 PM EDT</a>
   </div>
  </div>
 </div>
</article>
<div class="after-article">
</div><!-- after-article --><div class="entry-separator"></div><div class="day-stamp">
 2024-06-05 <span class="arrow">⇒</span>
</div>
<article class="presentation-multiple uid-readying-a-blog-for-sprouts">
 <div class="entry-header">
  <h1><a href="2024/06/02/readying-a-blog-for-revision-histories-and-sprouts-under-unstatic/index.html">Readying a blog for revision histories and sprouts under unstatic</a></h1>
  <hr class="below-title">
 </div>
 <div class="update-prepend rss-description-exclude">
  <em> ➣&nbsp;&nbsp;This post was meaningfully revised at 2024-06-06 @ 01:30 PM EDT. The previous revision is <a href="2024/06/02/readying-a-blog-for-revision-histories-and-sprouts-under-unstatic/index-oldcommit-f9b8a24e6219588d1f7f570dd9d448d02a5c6529.html">here</a>. (See <a href="2024/06/02/readying-a-blog-for-revision-histories-and-sprouts-under-unstatic/index.html#update-history">update history</a>.) </em>
  <hr>
 </div>
 <div class="entry-body">
  <div class="flexmark markdown">
   <p>I've been developing support for my take on <a href="https://v5.chriskrycho.com/essays/feeds-are-not-fit-for-gardening/">Chris Krycho' "sprouts"</a> against this blog. Much of that support is now built into <a href="https://github.com/swaldman/unstatic"><code>unstatic</code></a>, my library for building static-site generators. But it does also require some support from within applications of that library, from the scala code and the <a href="https://github.com/swaldman/untemplate-doc">untemplates</a> of the individual site generators.</p>
   <p>I'm going to upgrade my <a href="https://drafts.interfluidity.com/archive.html">"drafts"</a> blog to support revisions, diffs, and sprouts. I'll document what it takes to do that here.</p>
   <h3><a href="#enable-revision--and-diff-generation-in-scala-code" id="enable-revision--and-diff-generation-in-scala-code" name="enable-revision--and-diff-generation-in-scala-code" class="anchorlink"></a>Enable revision- and diff-generation in Scala code</h3>
   <p>In the object <a href="https://github.com/swaldman/drafts.interfluidity.com/blob/main/src/com/interfluidity/drafts/DraftsSite.scala"><code>DraftsSite</code></a>, the <a href="https://github.com/swaldman/unstatic/blob/main/ztapir/src/unstatic/ztapir/ZTSite.scala"><code>unstatic.ztapir.ZTSite</code></a> that defines the site to be generated, inside the <a href="https://github.com/swaldman/unstatic/blob/main/ztapir/src/unstatic/ztapir/simple/SimpleBlog.scala"><code>unstatic.ztapir.simple.SimpleBlog</code></a> that defines the blog, add a <a href="https://github.com/swaldman/unstatic/blob/main/ztapir/src/unstatic/ztapir/simple/RevisionBinder.scala"><code>RevisionBinder</code></a> that can pull old revisions of pages and generate them into the website, and a <a href="https://github.com/swaldman/unstatic/blob/main/ztapir/src/unstatic/ztapir/simple/DiffBinder.scala"><code>DiffBinder</code></a> that can generate diffs between current and new revisions:</p>
   <pre><code class="language-scala"> override val revisionBinder : Option[RevisionBinder] = Some( RevisionBinder.GitByCommit(DraftsSite, JPath.of("."), siteRooted =&gt; Rel("public/").embedRoot(siteRooted)) )
 override val diffBinder     : Option[DiffBinder]     = Some( DiffBinder.JavaDiffUtils(DraftsSite) )
</code></pre>
   <p>By default, <code>SimpleBlog</code> sets these values to null. We override them.</p>
   <p>The <code>RevisionBinder</code> we are using is <code>RevisionBinder.GitByCommit</code>. Its constructor accepts</p>
   <ol>
    <li>our <code>ZTSite</code>;</li>
    <li>a file path (<code>java.nio.file.Path</code>) to the git repository in which revisions are stored, just '.' for us because the git repository is the static-site generator's working directory;</li>
    <li>a function that converts a site-rooted path (<a href="https://github.com/swaldman/unstatic/blob/main/src/unstatic/UrlPath.scala"><code>unstatic.UrlPath.Rooted</code></a>) into the associated path within the repository relative to its root (as <a href="https://github.com/swaldman/unstatic/blob/main/src/unstatic/UrlPath.scala"><code>unstatic.UrlPath.Rel</code></a>);</li>
    <li>A <code>RevisionBinder.RevisionPathFinder</code>, a function which takes a document's site-rooted path and a "revision spec" (which for this revision binder is a full-size hex git commit) and determines the path the revision should take within the site.</li>
   </ol>
   <p>We omit the fourth argument because we use a default, which coverts a path like <code>/a/b/whatever.html</code> to <code>/a/b/whatever-oldcommit-c6e71f4d689f2b208c3eae19e647435322fa6d04.html</code></p>
   <p>For a <code>DiffBinder</code>, we use <code>DiffBinder.JavaDiffUtils</code>, based on the <a href="https://github.com/java-diff-utils/java-diff-utils"><code>java-diff-utils</code></a> library. When we ask it to generate a diff for a path, we give it a reference to the <code>RevisionBinder.RevisionPathFinder</code> so it can know the filenames old versions get generated into. We also give it a <code>DiffBinder.DiffPathFinder</code>, which computes the pathnames of the generated diffs. Again, the <code>DiffBinder.DiffPathFinder</code> is omitted our code. We rely a default argument, which produces diff paths like <code>/a/b/whatever-diff-72eaf9fdfebc9e627bff33bbe1102d4d250ad1d0-to-199e44561de3fd9e731a335d8b2a655f42d9bc04.html</code>.</p>
   <p>Now, if we ever <a href="2024/06/02/green-shoots-of-sprouts/index.html">provide update histories</a> to any posts, copies of any old revisions referenced will be generated into the public directory of the site, as well as diffs between adjacent items in the update history.</p>
   <h3><a href="#modify-the-site-to-generate-update-histories-at-the-end-of-posts" id="modify-the-site-to-generate-update-histories-at-the-end-of-posts" name="modify-the-site-to-generate-update-histories-at-the-end-of-posts" class="anchorlink"></a>Modify the site to generate update histories at the end of posts</h3>
   <p>It's a matter of taste, but we'll display update histories only on single-post permalink pages, not at the end of each post when concatenated together. And we won't include them as content in RSS. (Update histories <a href="xml/iffy/index.html"><em>do</em> get included</a> as additional metadata in RSS. That's built in.) <code>SimpleBlog</code> conveniently distinguishes between <code>Single</code>, <code>Multiple</code>, and <code>Rss</code>; we can just check our presentation and behave appropriately.</p>
   <p>So... We'll</p>
   <ol>
    <li>Steal <a href="https://github.com/swaldman/tech.interfluidity.com/blob/main/untemplate/com/interfluidity/tech/blog/layout-update-history.html.untemplate"><code>layout-update-history.html.untemplate</code></a> from the tech blog, and <a href="https://github.com/swaldman/drafts.interfluidity.com/blob/main/untemplate/com/interfluidity/drafts/mainblog/layout-update-history.html.untemplate">bring it in as a layout of drafts</a>. (I had to import <code>com.interfluidity.drafts.DraftsSite.MainBlog</code>, and modify the link in the note to point to the drafts got repository, rather than the tech rep.)</li>
    <li>Modify <a href="https://github.com/swaldman/drafts.interfluidity.com/blob/main/untemplate/com/interfluidity/drafts/mainblog/layout-entry.html.untemplate"><code>layout-entry.html.untemplate</code></a> in drafts to bring in the new layout of update history. That turns out to be really easy, because we already have logic at the end of our entry layout to restrict addition of previous and next links to single page presentations. So all we have to do is add our update history layout just after the <code>div</code> for those links, but within the conditionally added region. It's literally just 
     <pre><code class="language-plaintext">&lt;( layout_update_history_html( input ) )&gt;
</code></pre>
     <p>inserted just after that <code>div</code>, still within the conditional region.</p></li>
   </ol>
   <h3><a href="#modify-the-main-layout-and-css-so-that-old-revisions-are-visually-distinct-from-and-link-back-to-current-revisions" id="modify-the-main-layout-and-css-so-that-old-revisions-are-visually-distinct-from-and-link-back-to-current-revisions" name="modify-the-main-layout-and-css-so-that-old-revisions-are-visually-distinct-from-and-link-back-to-current-revisions" class="anchorlink"></a>Modify the main layout and CSS so that old revisions are visually distinct from, and link back to, current revisions</h3>
   <p>At the top of the <code>body</code> element of <a href="https://github.com/swaldman/drafts.interfluidity.com/blob/main/untemplate/com/interfluidity/drafts/layout-main.html.untemplate"><code>layout-main.html.untemplate</code></a>, we add an empty <code>div</code> element called <code>top-banner</code>.</p>
   <pre><code class="language-html">  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id="top-banner"&gt;&lt;/div&gt;
</code></pre>
   <p>In current revisions, this will remain invisible and empty. But we'll add a bit of javascript to detect if we're in an old revision, and add some HTML with a link back to the current revision. If we are in an old revision, we'll also add a class called <code>old-draft</code> to the body element, so that we can do whatever we feel like in CSS to make the old revision visually distinct.</p>
   <p>We use a javascript regular expression and our current location to decide if we are in an old revision.</p>
   <pre><code class="language-javascript">    &lt;script&gt;
      document.addEventListener("DOMContentLoaded", function() {
          const regex = /(^.*)\-oldcommit\-[0-9A-Fa-f]+\.html/;
          const match = window.location.pathname.match(regex);
          if (match) {
              const b  = document.querySelector("body");
              const tb = document.getElementById("top-banner");
              b.classList.add("old-draft");
              tb.innerHTML = "You are looking at an old, superceded version of this page. For the current version, please &lt;a href=\"" + match[1] + ".html\"&gt;click here&lt;/a&gt;.";
          }
       });
    &lt;/script&gt;
</code></pre>
   <p>We adjust <a href="https://github.com/swaldman/drafts.interfluidity.com/blob/main/static/css/style.css">our main CSS</a> to keep the top-banner <code>div</code> at the top of our document, when it's relevant:</p>
   <pre><code class="language-css">body.old-draft #top-banner {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    color: black;
    background-color: yellow;
    text-align: center;
    font-family: 'RobotoCondensed', 'Arial', 'Helvetica', sans-serif;
    font-variation-settings: "wght" 500;
    padding-top: 4px;
    padding-bottom: 4px;
    border-bottom: 2px solid black;
}
</code></pre>
   <p>Also add CSS so that, when viewing old revisions, the documents look, well, old.</p>
   <pre><code class="language-css">body.old-draft {
    padding-top: 1em;
    background-color: #F3F5DA;
    color: #6E7FD9;
    font-family: 'GabrieleD', 'Courier';
}
</code></pre>
   <p>(These choices were inspired by the TT2020 image <a href="https://www.creativebloq.com/typography/free-typewriter-fonts-1131774">here</a>, although ultimately I went for Gabriele, because the TT2020 file sizes were very large.)</p>
   <h3><a href="#add-a-prologue-to-posts-with-revisions-or-that-generate-sprout-rss" id="add-a-prologue-to-posts-with-revisions-or-that-generate-sprout-rss" name="add-a-prologue-to-posts-with-revisions-or-that-generate-sprout-rss" class="anchorlink"></a>Add a prologue to posts with revisions or that generate sprout RSS</h3>
   <p>When a post is a revision or a sprout, we want a prologue that indicated that it is, with links to the prior revision, the update history, and the sprout RSS.</p>
   <p>I'm too lazy to describe what it took to add that in detail, but here's <a href="https://github.com/swaldman/drafts.interfluidity.com/commit/d88d72d099cbe0c542ce2cce039243fb0975e52e">a nice, concise commit</a>. Check out the diff.</p>
   <h3><a href="#miscellaneous-tweaks" id="miscellaneous-tweaks" name="miscellaneous-tweaks" class="anchorlink"></a>Miscellaneous tweaks</h3>
   <p>I don't want to have to import <code>UpdateRecord</code> whenever I want to add update histories to entries, so I added them as an extra import to my <a href="https://github.com/swaldman/untemplate-doc?tab=readme-ov-file#customizers">untemplate customizer</a> in my mill build file, <a href="https://github.com/swaldman/drafts.interfluidity.com/blob/main/build.sc"><code>build.sc</code></a>:</p>
   <pre><code class="language-scala">  override def untemplateSelectCustomizer: untemplate.Customizer.Selector = { key =&gt;
    var out = untemplate.Customizer.empty

    if (key.inferredPackage.indexOf("mainblog")&gt;=0 &amp;&amp; key.inferredFunctionName.startsWith("entry_")) {
      out = out.copy(extraImports=Seq("unstatic.*","com.interfluidity.drafts.DraftsSite.MainBlog","unstatic.ztapir.simple.UpdateRecord"))
    }
</code></pre>
   <p>The "update history note" should be small, so I add to css:</p>
   <pre><code class="language-css">.update-history-note {
    font-size: smaller;
    line-height: 100%;
}
</code></pre>
   <h3><a href="#republish-the-site" id="republish-the-site" name="republish-the-site" class="anchorlink"></a>Republish the site</h3>
   <p>Even though nothing visible should change, let's go ahead and republish the site, so that our javascript and css scaffolding for old-looking updates become available.</p>
   <h3><a href="#test-and-tweak" id="test-and-tweak" name="test-and-tweak" class="anchorlink"></a>Test and tweak</h3>
   <p>Even though I don't have any actual new revisions to create, I added a fake revision history to the most recent post, played around in CSS with the look of the old revision until I liked it, then commented away the fake update history.</p>
  </div>
 </div>
 <div class="entry-footer">
  <div class="post-metainfo">
   <a href="2024/06/02/readying-a-blog-for-revision-histories-and-sprouts-under-unstatic/index.html">11:00 PM EDT</a>
   <div class="updated-note">
    <a href="2024/06/02/readying-a-blog-for-revision-histories-and-sprouts-under-unstatic/index.html#major-updates">Last major update at 2024-06-06 @ 01:30 PM EDT</a>
   </div>
  </div>
 </div>
</article>
<div class="after-article">
</div><!-- after-article --><div class="entry-separator"></div><div class="day-stamp">
 2024-06-02 <span class="arrow">⇒</span>
</div>
<article class="presentation-multiple uid-green-shoots-of-sprouts">
 <div class="entry-header">
  <h1><a href="2024/06/02/green-shoots-of-sprouts/index.html">Green shoots of sprouts</a></h1>
  <hr class="below-title">
 </div>
 <div class="entry-body">
  <div class="flexmark markdown">
   <p><a href="https://mastodon.social/@erlend@writing.exchange">Erlend Sogge Heggen</a> pointed me to a <a href="https://v5.chriskrycho.com/essays/feeds-are-not-fit-for-gardening/">post by Chris Krycho on "sprouts"</a>.</p>
   <p>Krycho points out that most of our online infrastructure is organized around feeds of posts, which are "published" or "announced" as finished work. But creative work naturally develops in drafts and increments. It might be best to publish at first only the barest outline of a thing, and then collaborate in the open to flesh it out and bring it forward. What we want to announce, then, are not new posts, but a beginning and then new milestones. If we can, we'd want to retain the full history of the process.</p>
   <p>I've gone a fair distance towards implementing one version of this vision recently. My blogging infrastructure is my own static-site generation library <a href="https://github.com/swaldman/unstatic/">unstatic</a>, which is built on top of "<a href="https://github.com/swaldman/untemplate-doc#readme">untemplates</a>". Untemplates are just thin wrappers around Scala functions.</p>
   <p>Like lots of static-site generators, I write in files that are mostly markdown, with some metadata in a special header. But in the untemplate header, I literally write Scala code.</p>
   <p>Here's a very simple example, from a recent post, "<a href="2024/03/18/c3p0-and-loom/index.html">c3p0 and loom</a>":</p>
   <pre><code class="language-plaintext">&gt; val UntemplateAttributes = immutable.Map[String,Any] (
&gt;   "Title"     -&gt; "c3p0 and loom",
&gt;   "PubDate"   -&gt; "2024-03-18T22:20:00-04:00",
&gt;   "Anchor"    -&gt; "c3p0-and-loom"
&gt; )

given PageBase = PageBase.fromPage(input.renderLocation)

(input : MainBlog.EntryInput)[]~()&gt;      ### modify Title/Author/Pubdate above, add markdown or html below!

I write [a lot of open source software](https://github.com/swaldman), but I've only ever really had one "hit".
That makes me pretty sad, actually. I think some of what I've written is pretty great, and it's lonesome to be the
sole user...
</code></pre>
   <p>For most posts, I just copy and modify this header, and then write markdown text below. But if I want to do anything more fancy, well, I have the full Scala programming language to work with.</p>
   <p>In order to realize a vision of "sprouts", I first implemented update histories as a simple <code>List</code> of <code>UpdateRecord</code> objects.</p>
   <p>The <a href="xml/iffy/index.html">post prior to this one</a> has already become a particularly sprouty sprout. The post documents experiments with extensions to RSS. I try stuff out, then, as often as not, I untry it. So there's lots of revising. Here's the beginning of that post, for now:</p>
   <pre><code class="language-plaintext">&gt; val updateHistory =
&gt;    UpdateRecord("2024-06-02T00:25:00-04:00",Some("Drop &lt;code&gt;iffy:timestamp&lt;/code&gt;. We can just reuse &lt;code&gt;atom:updated&lt;/code&gt; for the same work."),Some("199e44561de3fd9e731a335d8b2a655f42d9bc04")) ::
&gt;    UpdateRecord("2024-06-01T21:35:00-04:00",Some("Add initial take on tags related to updates and revisions."),Some("72eaf9fdfebc9e627bff33bbe1102d4d250ad1d0")) ::
&gt;    UpdateRecord("2024-05-25T23:00:00-04:00",Some("Add JS/CSS so that prior revisions are visually distinct from current."),Some("13de0232319ceab2f830591c318089d18cbec78d")) ::
&gt;    UpdateRecord("2024-05-24T00:25:00-04:00",Some("Drop tags &lt;code&gt;iffy:when-updated&lt;/code&gt; and &lt;code&gt;iffy:original-guid&lt;/code&gt;, bad appraoch to updates."),Some("394986cb8d9c57f567d324e691a44d50102101ce")) ::
&gt;    Nil
&gt;
&gt; val UntemplateAttributes = immutable.Map[String,Any] (
&gt;   "Title"         -&gt; "The 'iffy' XML namespace",
&gt;   "PubDate"       -&gt; "2024-05-13T04:10:00-04:00",
&gt;   "Permalink"     -&gt; "/xml/iffy/index.html",
&gt;   "UpdateHistory" -&gt; updateHistory,
&gt;   "Sprout"        -&gt; true,
&gt;   "Anchor"        -&gt; "iffy-xml-namespace"
&gt; )

given PageBase = PageBase.fromPage(input.renderLocation)

(input : MainBlog.EntryInput)[]~()&gt;      ### modify Title/Author/Pubdate above, add markdown or html below!

I want to do a lot of things with RSS that require
extensions of RSS (as the RSS spec [foresees](https://www.rssboard.org/rss-specification#extendingRss))...
</code></pre>
   <p>Each <code>UpdateRecord</code> marks a discretionary choice, to declare a "significant" or "material" update. Most updates are not! There are typically several minor revisions, typo fixes, and tweaks, between these noted updates.</p>
   <p>When I decide a revision is serious, I provide a timestamp, and, optionally, a description and a "revision spec". The description is self-explanatory. The revision spec is arbitrary. When I define a site, I optionally provide an <a href="https://github.com/swaldman/unstatic/blob/main/ztapir/src/unstatic/ztapir/simple/RevisionBinder.scala"><code>RevisionBinder</code></a> that is able to convert a revision spec and a path into the contents of a resource within the referenced revision.</p>
   <p>There might be many different implementations of <code>RevisionBinder</code>, each with its own kind of revision specification. The one that exists for now just pulls resources from git commits.</p>
   <p>The revision specs shown are just git commits, referenced in full-length hex. With each "major" update, I provide the hex for the commit <em>prior</em> to my update, the one it is superceding. That usually <em>will not</em> be the same commit as the "major" update prior, because most "major" updates are followed by a series of minor tweaks.</p>
   <p>So, as I work on an evolving document, I note significant updates by adding records to a list, and I include the list I build in <code>UntemplateAttributes</code>, the standard <code>Map</code> in which I also define <code>Title</code>, <code>PubDate</code>, <code>Author</code>, etc. (The example posts omit <code>Author</code>, because this site has a default author — me! — if that field is left unset.)</p>
   <p>The update history converts pretty directly into a user readable history. Let's <a href="xml/iffy/index.html#update-history">take a look</a>!</p>
   <p>(If you want to see the template that lays out the update history, you can find it <a href="https://github.com/swaldman/tech.interfluidity.com/blob/main/untemplate/com/interfluidity/tech/blog/layout-update-history.html.untemplate">here</a>.)</p>
   <p>To realize the "sprout" vision, we need more than this. We need some means by which people can follow the evolutions of the document. Ideally, when a "major update" is published, subscribers to the blog should see something about that in their feeds. The RSS feeds we generate include <code>&lt;atom:updated&gt;</code> tags, but as Krycho points out, very few feed readers do anything with that.</p>
   <p>You'll note that in addition to the <code>UpdateHistory</code>, we've added to <code>UntemplateAttributes</code> a key called <code>Sprout</code>. When the site generator encounters a mapping of <code>Sprout</code> to <code>true</code> on an untemplate, it generates an additional RSS feed that will track the update history of just this post. For our example post, you can find that feed <a href="https://tech.interfluidity.com/xml/iffy/index-sprout.rss">here</a></p>
   <p>The <a href="https://github.com/swaldman/tech.interfluidity.com/blob/main/untemplate/com/interfluidity/tech/blog/layout-entry.html.untemplate">template that lays out blog entries</a> looks for an update history, and if it is there, checks for prior revisions references, diffs, and the <code>sprouts</code> flag. It prepends to the post a brief note with links, to the prior revision if it's available, to the update history, and to the post-specific RSS feed. Go ahead, check out the beginning of our <a href="xml/iffy/index.html">example post</a>.</p>
   <p>Going forward, I think I will add the capability of generating "synthetic" posts when there are new major updates. They'd just be formulaic announcements of the updates. They might never appear on the blog front page. But they would be included in the RSS feed. I'd add metadata to the RSS items for these posts, indicating that they are synthetic and describing them, so that tools like <a href="2024/01/29/feedletter-tutorial/index.html"><code>feedletter</code></a> can make intelligent choices about whether and how subscribers should receive notificatios about these posts.</p>
   <p>But that is all still to come!</p>
   <p>For now, we have update histories with links to prior revisions and diffs, and dedicated RSS feeds by which dedicated collaborators can stay abreast of our burgeoning sprouts.</p>
  </div>
 </div>
 <div class="entry-footer">
  <div class="post-metainfo">
   <a href="2024/06/02/green-shoots-of-sprouts/index.html">03:15 AM EDT</a>
  </div>
 </div>
</article>
<div class="after-article">
</div><!-- after-article --><div class="entry-separator"></div><div class="day-stamp">
 2024-05-13 <span class="arrow">⇒</span>
</div>
<article class="presentation-multiple uid-iffy-xml-namespace">
 <div class="entry-header">
  <h1><a href="xml/iffy/index.html">The 'iffy' XML namespace</a></h1>
  <hr class="below-title">
 </div>
 <div class="update-prepend rss-description-exclude">
  <em> ➣&nbsp;&nbsp;This post was meaningfully revised at 2024-06-11 @ 02:10 PM EDT. The previous revision is <a href="xml/iffy/index-oldcommit-6c5fef82527bd419e8e9c7e7f3a6420c9925cf10.html">here</a>. (See <a href="xml/iffy/index.html#update-history">update history</a>.) <br>
    ➣&nbsp;&nbsp;This post is expected to evolve over time. You can subscribe to ongoing updates <a href="xml/iffy/index-sprout.rss">here</a>. 
   <link rel="alternate" type="application/rss+xml" title="Update to The 'iffy' XML namespace" href="https://tech.interfluidity.com/xml/iffy/index-sprout.rss"></em>
  <hr>
 </div>
 <div class="entry-body">
  <div class="flexmark markdown">
   <p>I want to do a lot of things with RSS that require extensions of RSS (as the RSS spec <a href="https://www.rssboard.org/rss-specification#extendingRss">foresees</a>).</p>
   <p>The URL <code>http://tech.interfluidity.com/xml/iffy/</code> will mark an XML namespace in which some of these extensions will be defined.</p>
   <p>The conventional prefix associated with this namespace will be <code>iffy</code>.</p>
   <p><strong>The current version of this namespace is <code>v0.0.1-SNAPSHOT</code>.</strong></p>
   <p>(<code>-SNAPSHOT</code> signifies that the version preceding that suffix has not yet been finalized. Much more to come!)</p>
   <hr>
   <p><strong>Table of Contents</strong></p>
   <ul>
    <li><a href="#iffy-completeness"><code>iffy:completeness</code></a></li>
    <li><a href="#iffy-diff"><code>iffy:diff</code></a></li>
    <li><a href="#iffy-hint-announce"><code>iffy:hint-announce</code></a></li>
    <li><a href="#iffy-initial"><code>iffy:initial</code></a></li>
    <li><a href="#iffy-policy"><code>iffy:policy</code></a></li>
    <li><a href="#iffy-provenance"><code>iffy:provenance</code></a></li>
    <li><a href="#iffy-restriction"><code>iffy:restriction</code></a></li>
    <li><a href="#iffy-revision"><code>iffy:revision</code></a></li>
    <li><a href="#iffy-update"><code>iffy:update</code></a></li>
    <li><a href="#iffy-update-history"><code>iffy:update-history</code></a></li>
   </ul>
   <hr>
   <p><a id="iffy-completeness" href=""></a><strong>Element — <code>iffy:completeness</code></strong></p>
   <div class="iffy-element-desc">
    <p><strong>Solely a channel level element</strong></p>
    <p>Contains one of the following four values:</p>
    <ol>
     <li><code>Ping</code></li>
     <li><code>Metadata</code></li>
     <li><code>Content</code></li>
     <li><code>Media</code></li>
    </ol>
    <p><code>iffy:completeness</code> describes the completeness that clients should expect of RSS <a href="https://www.rssboard.org/rss-specification#hrelementsOfLtitemgt"><code>item</code></a> elements.</p>
    <ul>
     <li>
      <p><code>Ping</code> makes the least commitment. Items need not include a <a href="https://www.rssboard.org/rss-specification#ltguidgtSubelementOfLtitemgt"><code>guid</code></a> element, or any elements at all beyond <a href="https://www.rssboard.org/rss-specification#hrelementsOfLtitemgt">RSS' requirement</a> that at least one of <code>title</code> or <code>description</code> be present. RSS documents have completion <code>Ping</code> by default. Any or all items may meet the requirement for a higher completeness level, but no promises or commitment is made beyond the base specification.</p></li>
     <li>
      <p><code>Metadata</code> commits that each item MUST include a <a href="https://www.rssboard.org/rss-specification#ltguidgtSubelementOfLtitemgt"><code>guid</code></a> element, as well as meeting the base requirements for an RSS <a href="https://www.rssboard.org/rss-specification#hrelementsOfLtitemgt"><code>item</code></a>.</p></li>
     <li>
      <p><code>Content</code> commits that each item, either inside its <code>description</code> tag, or via an extension such as <code>content:encoded</code>, includes the full content of the items it includes, suitable for independent rendering by any client capable also of resolving references to linked media externally. No limitation is placed on whether the full content is placed in a <code>description</code> element, in <code>content:encoded</code>, or in some other extension.</p></li>
     <li>
      <p><code>Media</code> augments <code>Content</code> by <em>embedding attachments to subsidiary media</em> inside the RSS document. Subsidiary media does not include all potential links, just links which share a prefix with the current RSS document, which by default means all links subsidiary to the parent of the RSS document as specified in an <code>atom:link</code></p>
      <p><em>More information on this soon when <code>iffy:attachment</code> is defined</em></p></li>
    </ul>
    <p>The four values represent nested, hierarchical levels of commitment. <code>Ping</code> commits to nothing more than the spec requires. <code>Media</code> makes every commitment promised by the prior three levels, and an additional one.</p>
    <p>If not specified, no commitment is made, the feed should be considered <code>Ping</code>.</p>
    <p><strong>Example:</strong></p>
    <pre><code class="language-xml">&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;rss version="2.0" xmlns:iffy="http://tech.interfluidity.com/xml/iffy/" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/"&gt;
  &lt;channel&gt;
    &lt;title&gt;tech — interfluidity&lt;/title&gt;
    &lt;atom:link type="application/rss+xml" rel="self" href="https://tech.interfluidity.com/feed/index.rss"/&gt;
    &lt;iffy:completeness&gt;Content&lt;/iffy:completeness&gt;
    &lt;!-- Other channel elements --&gt;
    &lt;item&gt;
      &lt;!-- Other item elements --&gt;
    &lt;/item&gt;
  &lt;/channel&gt;
&lt;/rss&gt;

</code></pre>
   </div>
   <hr>
   <p><a id="iffy-diff" href=""></a><strong>Element — <code>iffy:diff</code></strong></p>
   <div class="iffy-element-desc">
    <p><strong>When a subelement of <a href="#iffy-update-history"><code>iffy:update</code></a></strong></p>
    <p>MUST contain a URL, URI, or <a href="https://datatracker.ietf.org/doc/html/rfc3987">IRI</a> of a human-reviewable a <a href="https://en.wikipedia.org/wiki/Diff"><em>diff</em></a> of the current updated and <em>the final minor revision</em> of the update prior (or of the initially published post, if the current update is the first declared update).</p>
    <p><strong>Example</strong>:</p>
    <pre><code class="language-xml">&lt;iffy:diff&gt;https://tech.interfluidity.com/xml/iffy/index-diff-394986cb8d9c57f567d324e691a44d50102101ce-to-13de0232319ceab2f830591c318089d18cbec78d.html&lt;/iffy:diff&gt;
</code></pre>
    <p>See also <a href="#iffy-update-history"><code>iffy:update-history</code> example</a>.</p>
   </div>
   <hr>
   <p><a id="iffy-hint-announce" href=""></a><strong>Element — <code>iffy:hint-announce</code></strong></p>
   <div class="iffy-element-desc">
    <p><strong>When a subelement of <code>item</code></strong></p>
    <p>Represents a <em>hint</em> to RSS consumers that "push" — announce, rebroadcast, or notify — items whether this item should be so pushed. Consumers are free to ignore this hint or make use of it as they wish.</p>
    <p>MUST contain an <a href="#iffy-policy"><code>iffy:policy</code></a> element, whose values MUST BE one of</p>
    <ul>
     <li><code>Always</code> — the item should always be notified</li>
     <li><code>Never</code> — the item should never be notified</li>
     <li><code>Piggyback</code> — the item should be notified as part of digests or other announcements of multiple items, but should not constitute its own announcement.</li>
    </ul>
    <p>MAY contain an <a href="#iffy-restriction"><code>iffy:restriction</code></a> element, which represents an application-specific restriction over the consumers to which it is addressed. No restrictions are placed on the content of the <code>iffy:restriction</code> element. Applications can define restrictions as they see fit.</p>
    <p>An <code>iffy:hint-announce</code> element with NO <code>iffy:restriction</code> or an empty <code>iffy:restriction</code> tag should be interpreted as the intended default for ALL applications not addressed by an <code>iffy:hint-announce</code> with a more specific restriction.</p>
    <p>Multiple <code>iffy:hint-announce</code> elements may be placed within a single <code>item</code>, provided that only one has an omitted or empty <code>iffy:restriction</code>, and all <code>iffy:hint-announce</code> elements containing an <code>iffy:restriction</code> contain a unique restriction. Each <code>iffy:restriction</code> SHOULD apply to nonoverlapping application-specific contexts. If that is not the case, how applications prioritize or respond to conflicting <code>iffy-hint-announce</code> elements whose restrictions both apply must be determined by the application.</p>
    <p><strong>Example</strong>:</p>
    <pre><code class="language-xml">&lt;iffy:hint-announce&gt;
  &lt;iffy:policy&gt;Piggyback&lt;/iffy:policy&gt;
&lt;/iffy:hint-announce&gt;
</code></pre>
   </div>
   <hr>
   <p><a id="iffy-initial" href=""></a><strong>Element — <code>iffy:initial</code></strong></p>
   <div class="iffy-element-desc">
    <p><strong>When a subelement of <a href="#iffy-update-history"><code>iffy:update-history</code></a></strong></p>
    <p>MAY contain a sequence of <a href="https://www.rssboard.org/rss-profile#namespace-elements-dublin-creator"><code>dc:creator</code></a> elements, defining the initial authorship of an item, if authorship has changed. Since the containing <code>item</code> should always reflect current authorship (that of the most recent revision), but no <a href="#iffy-update"><code>iffy:update</code></a> element is defined for the initially published version, this container is required for completeness.</p>
    <p><strong>Example</strong>:</p>
    <pre><code class="language-xml">&lt;iffy:initial&gt;
  &lt;!-- Perhaps more recent updates, and the current item, include more authors --&gt;
  &lt;dc:creator&gt;First Author, Esq.&lt;/dc:creator&gt;
&lt;/iffy:initial&gt;
</code></pre>
   </div>
   <hr>
   <p><a id="iffy-policy" href=""></a><strong>Element — <code>iffy:policy</code></strong></p>
   <div class="iffy-element-desc">
    <p>In general, represents a statement of some kind of policy with respect to its containing element, suggested to feed consumers for handling a feed or item.</p>
    <p><strong>When a subelement of <a href="#iffy-hint-announce"><code>iffy:hint-announce</code></a></strong></p>
    <p>Please see <a href="#iffy-hint-announce"><code>iffy:hint-announce</code></a>.</p>
   </div>
   <hr>
   <p><a id="iffy-provenance" href=""></a><strong>Element — <code>iffy:provenance</code></strong></p>
   <div class="iffy-element-desc">
    <p><strong>When an item level element</strong></p>
    <p>If present in an item, the item contains a sequence of one or more <a href="https://www.ietf.org/rfc/rfc4287.txt"><code>atom:link</code></a> elements, each of whose</p>
    <ul>
     <li><code>rel</code> attribute is MUST BE <code>via</code></li>
     <li><code>href</code> attribute MUST BE the URL of an RSS feed from which the base contents of this item were drawn</li>
     <li><code>type</code> attribute SHOULD BE <code>application/rss+xml</code></li>
    </ul>
    <p>If the item from which the current item was sourced does not contain an <code>iffy:provenance</code>, then the current item should include just one <code>atom:link</code>.</p>
    <p>If the item from which the current item was sourced <em>does</em> contains an <code>iffy:provenance</code>, then the current feed SHOULD include all items of that element, with the URL of the feed from which the item was sourced PREPENDED.</p>
    <p>This will ensure the most immediate source will be the first <code>atom:link</code> element. The origin — or at least the source for which no further provenance is known — will be the last <code>atom:link</code> element.</p>
    <p>Processors may expect a channel level <code>atom:link</code> element with <code>rel="self"</code> and <code>type="application/rss+xml"</code> to use as the basis for provenance in source documents. See <a href="https://www.rssboard.org/rss-profile#namespace-elements-atom-link">RSS Best Practices</a>.</p>
    <p><strong>Example</strong> (from <a href="https://www.interfluidity.com/unify-rss/all-blogs.rss">here</a>):</p>
    <pre><code class="language-xml">&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;rss version="2.0" xmlns:iffy="http://tech.interfluidity.com/xml/iffy/" xmlns:sy="http://purl.org/rss/1.0/modules/syndication/" xmlns:slash="http://purl.org/rss/1.0/modules/slash/" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:wfw="http://wellformedweb.org/CommentAPI/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/"&gt;
  &lt;channel&gt;
    &lt;title&gt;interfluidity, all blogs&lt;/title&gt;
    &lt;!-- Other channel elements --&gt;
    &lt;atom:link type="application/rss+xml" rel="self" href="https://www.interfluidity.com/unify-rss/all-blogs.rss"/&gt;
    &lt;item&gt;
      &lt;title&gt;Industrial policy and ecosystems&lt;/title&gt;
      &lt;guid isPermalink="true"&gt;https://drafts.interfluidity.com/2024/05/11/industrial-policy-and-ecosystems/index.html&lt;/guid&gt;
      &lt;author&gt;nospam@dev.null (Steve Randy Waldman)&lt;/author&gt;
      &lt;link&gt;https://drafts.interfluidity.com/2024/05/11/industrial-policy-and-ecosystems/index.html&lt;/link&gt;
      &lt;!-- Other item elements --&gt;
      &lt;iffy:provenance&gt;
        &lt;atom:link type="application/rss+xml" rel="via" href="https://drafts.interfluidity.com/feed/index.rss"/&gt;
      &lt;/iffy:provenance&gt;
    &lt;/item&gt;
  &lt;/channel&gt;
&lt;/rss&gt;
</code></pre>
   </div>
   <hr>
   <p><a id="iffy-restriction" href=""></a><strong>Element — <code>iffy:restriction</code></strong></p>
   <div class="iffy-element-desc">
    <p>In general, represents an expressin of some kind of restriction over the application of its containing element.</p>
    <p><strong>When a subelement of <a href="#iffy-hint-announce"><code>iffy:hint-announce</code></a></strong></p>
    <p>Please see <a href="#iffy-hint-announce"><code>iffy:hint-announce</code></a>.</p>
   </div>
   <hr>
   <p><a id="iffy-revision" href=""></a><strong>Element — <code>iffy:revision</code></strong></p>
   <div class="iffy-element-desc">
    <p>MUST contain a URL, URI, or <a href="https://datatracker.ietf.org/doc/html/rfc3987">IRI</a> of a either a fixed past revision or the current (potentially evolving) revision of an item.</p>
    <p><strong>Example</strong>:</p>
    <pre><code class="language-xml">&lt;iffy:revision&gt;https://tech.interfluidity.com/xml/iffy/index-oldcommit-13de0232319ceab2f830591c318089d18cbec78d.html&lt;/iffy:revision&gt;
</code></pre>
    <p>See also <a href="#iffy-update-history"><code>iffy:update-history</code> example</a>.</p>
   </div>
   <hr>
   <p><a id="iffy-update" href=""></a><strong>Element — <code>iffy:update</code></strong></p>
   <div class="iffy-element-desc">
    <p><strong>When a sub-element of <a href="#iffy-update-history"><code>iffy:update-history</code></a></strong></p>
    <p>MUST contain one <a href="https://datatracker.ietf.org/doc/html/rfc4287#section-4.2.15"><code>atom:updated</code></a> element.</p>
    <p>MAY also contain one each of</p>
    <ul>
     <li><a href="https://datatracker.ietf.org/doc/html/rfc4287#section-4.2.13"><code>atom:summary</code></a></li>
     <li><a href="#iffy-diff"><code>iffy:diff</code></a></li>
     <li><a href="#iffy-revision"><code>iffy:revision</code></a></li>
    </ul>
    <p>MAY, but usually will not, contain any number of <a href="https://www.rssboard.org/rss-profile#namespace-elements-dublin-creator"><code>dc:creator</code></a> elements, reflecting <em>authorship specific to this revision</em>. By default, an update's authors are the same as the authorship of the containing item, which always reflects the curren revisions authors. If authorship is evolving over time, it SHOULD be specified for every update except the most recent one. Initial authorship may be specified in an <a href="#iffy-initial"><code>iffy:initial</code></a> element.</p>
    <p><strong><em>Typo fixes, small rephrasings, and other tweaks are not expected to be recorded as distinct updates. That is, within a "single update" there may be a sequence of smaller revisions that go unrecorded.</em></strong> Applications that want a more forensic history might consider including and exposing every published change in version control.</p>
    <p>See <a href="#iffy-update-history"><code>iffy:update-history</code> example</a>.</p>
   </div>
   <hr>
   <p><a id="iffy-update-history" href=""></a><strong>Element — <code>iffy:update-history</code></strong></p>
   <div class="iffy-element-desc">
    <p><strong>When an item level element</strong></p>
    <p>SHOULD contain a sequence of <a href="#iffy-update"><code>iffy:update</code></a> elements, in reverse chronological order, describing the histories of <em>major revisions</em> to an item.</p>
    <p>MAY contain one <a href="#iffy-initial"><code>iffy:initial</code></a> element.</p>
    <p>Items containing an <code>iffy:update-history</code> SHOULD also include an <a href="https://datatracker.ietf.org/doc/html/rfc4287#section-4.2.15"><code>atom:updated</code></a> tag corresponding to the most recent update.</p>
    <p><strong><em>Typo fixes, small rephrasings, and other minor tweaks are not expected to be recorded as distinct updates. That is, within a "single update" there may be a sequence of smaller revisions that go unrecorded.</em></strong> Applications that want a more forensic history might consider including and exposing every published change in version control.</p>
    <p><a id="iffy-update-history-example" href=""></a><strong>Example</strong>:</p>
    <pre><code class="language-xml">&lt;item&gt;
  &lt;!-- Other item elements --&gt;
  &lt;iffy:update-history&gt;
    &lt;iffy:update&gt;
      &lt;atom:updated&gt;2024-06-02T04:20:00Z&lt;/atom:updated&gt;
      &lt;atom:summary&gt;
        &lt;![CDATA[Drop &lt;code&gt;iffy:timestamp&lt;/code&gt;. We can just reuse &lt;code&gt;atom:updated&lt;/code&gt; for the same work.]]&gt;
      &lt;/atom:summary&gt;
      &lt;iffy:revision&gt;
        https://tech.interfluidity.com/xml/iffy/index-oldcommit-199e44561de3fd9e731a335d8b2a655f42d9bc04.html
      &lt;/iffy:revision&gt;
      &lt;iffy:diff&gt;
        https://tech.interfluidity.com/xml/iffy/index-diff-199e44561de3fd9e731a335d8b2a655f42d9bc04-to-current.html
      &lt;/iffy:diff&gt;
    &lt;/iffy:update&gt;
    &lt;iffy:update&gt;
      &lt;atom:updated&gt;2024-06-02T01:35:00Z&lt;/atom:updated&gt;
      &lt;atom:summary&gt;&lt;![CDATA[Add initial take on tags related to updates and revisions.]]&gt;&lt;/atom:summary&gt;
      &lt;iffy:revision&gt;
        https://tech.interfluidity.com/xml/iffy/index-oldcommit-72eaf9fdfebc9e627bff33bbe1102d4d250ad1d0.html
      &lt;/iffy:revision&gt;
      &lt;iffy:diff&gt;
        https://tech.interfluidity.com/xml/iffy/index-diff-72eaf9fdfebc9e627bff33bbe1102d4d250ad1d0-to-199e44561de3fd9e731a335d8b2a655f42d9bc04.html
      &lt;/iffy:diff&gt;
    &lt;/iffy:update&gt;
    &lt;iffy:update&gt;
      &lt;atom:updated&gt;2024-05-26T03:00:00Z&lt;/atom:updated&gt;
      &lt;atom:summary&gt;&lt;![CDATA[Add JS/CSS so that prior revisions are visually distinct from current.]]&gt;&lt;/atom:summary&gt;
      &lt;iffy:revision&gt;
        https://tech.interfluidity.com/xml/iffy/index-oldcommit-13de0232319ceab2f830591c318089d18cbec78d.html
      &lt;/iffy:revision&gt;
      &lt;iffy:diff&gt;
        https://tech.interfluidity.com/xml/iffy/index-diff-13de0232319ceab2f830591c318089d18cbec78d-to-72eaf9fdfebc9e627bff33bbe1102d4d250ad1d0.html
      &lt;/iffy:diff&gt;
    &lt;/iffy:update&gt;
    &lt;iffy:update&gt;
      &lt;atom:updated&gt;2024-05-24T04:25:00Z&lt;/atom:updated&gt;
      &lt;atom:summary&gt;
        &lt;![CDATA[Drop tags &lt;code&gt;iffy:when-updated&lt;/code&gt; and &lt;code&gt;iffy:original-guid&lt;/code&gt;, bad appraoch to updates.]]&gt;
      &lt;/atom:summary&gt;
      &lt;iffy:revision&gt;
        https://tech.interfluidity.com/xml/iffy/index-oldcommit-394986cb8d9c57f567d324e691a44d50102101ce.html
      &lt;/iffy:revision&gt;
      &lt;iffy:diff&gt;
        https://tech.interfluidity.com/xml/iffy/index-diff-394986cb8d9c57f567d324e691a44d50102101ce-to-13de0232319ceab2f830591c318089d18cbec78d.html
      &lt;/iffy:diff&gt;
    &lt;/iffy:update&gt;
  &lt;/iffy:update-history&gt;
&lt;/item&gt;
</code></pre>
   </div>
  </div>
 </div>
 <div class="entry-footer">
  <div class="post-metainfo">
   <a href="xml/iffy/index.html">04:10 AM EDT</a>
   <div class="updated-note">
    <a href="xml/iffy/index.html#major-updates">Last major update at 2024-06-11 @ 02:10 PM EDT</a>
   </div>
  </div>
 </div>
</article>
<div class="after-article">
</div><!-- after-article --><div class="entry-separator"></div><div class="day-stamp">
 2024-04-09 <span class="arrow">⇒</span>
</div>
<article class="presentation-multiple uid-names-too-on-the-nose">
 <div class="entry-header">
  <h1><a href="2024/04/09/names-too-on-the-nose/index.html">Names too on the nose</a></h1>
  <hr class="below-title">
 </div>
 <div class="update-prepend rss-description-exclude">
  <em> ➣&nbsp;&nbsp;This post was meaningfully revised at 2024-06-01 @ 11:40 PM EDT. The previous revision is <a href="2024/04/09/names-too-on-the-nose/index-oldcommit-c6e71f4d689f2b208c3eae19e647435322fa6d04.html">here</a>. (See <a href="2024/04/09/names-too-on-the-nose/index.html#update-history">update history</a>.) <br>
    ➣&nbsp;&nbsp;This post is expected to evolve over time. You can subscribe to ongoing updates <a href="2024/04/09/names-too-on-the-nose/index-sprout.rss">here</a>. 
   <link rel="alternate" type="application/rss+xml" title="Update to Names too on the nose" href="https://tech.interfluidity.com/2024/04/09/names-too-on-the-nose/index-sprout.rss"></em>
  <hr>
 </div>
 <div class="entry-body">
  <div class="flexmark markdown">
   <p>This will be an odd post for a tech blog. But here is a list of names "too on-the-nose":</p>
   <ul>
    <li><strong>Kenneth Chesebro</strong> — <a href="https://en.wikipedia.org/wiki/Kenneth_Chesebro">Guy</a> from Wisconsin who came up with the alternative electors idea to try to confuse the 2020 elections so the House could throw it to Trump. He seems like a pretty cheesy bro to me.</li>
    <li><strong>Bernie Madoff</strong> — He <em>made off</em> with the money.</li>
    <li><strong>Terra Rodgers</strong> — a "<a href="https://www.theguardian.com/environment/2024/apr/02/geothermal-energy-electricity">director for superhot rock energy</a>", that is a form of geothermal energy, a kind of <em>terrestrial</em> energy.</li>
    <li><strong>Yahya Sinwar</strong> — Whatever you think of the broader Israel/Palestine conflict, the operation he ordered on October 7, 2023 was <em>sin</em> and guaranteed a brutal <em>war</em>. That <em>Sinwar</em> is preceded by <em>Yahya</em> renders the name a kind of Satanic cheerleader's chant.</li>
   </ul>
   <p>More names coming soon!</p>
   <p>I've kind of wanted to maintain a list like this for a long time. I sometimes think we're inhabiting a work of fiction, given how contrivedly <em>a propos</em> certain names often are. I encounter these names, and I want to make a note of them.</p>
   <p>I'll do that here!</p>
   <p>(I think I might once have encountered a Twitter thread in this vein. My apologies to whomever I am ripping off!)</p>
   <p>Please get in touch with any suggestions!</p>
   <p><em><strong>Update:</strong> <a href="https://artlung.com/">Joe Crawford</a> writes to point out that the on-the-nosedness of names <a href="https://www.bbc.com/worklife/article/20180404-do-our-names-push-us-toward-certain-jobs">might have mechanisms</a> other than the universe being a crude dissimulation!</em></p>
   <hr>
   <p>Anyway, I'm finally putting together this list here, on my "tech blog", because it's a good way to experiment with an idea that Chris Krycho <a href="https://v5.chriskrycho.com/essays/feeds-are-not-fit-for-gardening/">describes</a> as "sprouts".</p>
   <p>Often "posts" ought not be thought of as finished pieces, but as beginnings — seeds, even — of ongoing, evolving work. (Thanks to <a href="https://mastodon.social/@erlend@writing.exchange">Erlend Sogge Heggen</a> for pointing me to this piece!)</p>
   <p>I've begun by adding support to the <a href="https://www.ietf.org/rfc/rfc4287.txt"><code>&lt;atom:updated&gt;</code> tag</a> in my site generator's RSS.</p>
   <p>When I make meaningful changes, I can update this value, and my feed will re-sort the updated post to the top, and prefix "Updated:" to the title. I can optionally mark posts to create a new GUID for each update, which may cause tools (like my own <a href="2024/01/29/feedletter-tutorial/index.html">feedletter</a>) to treat them as new posts.</p>
   <p>(For now, I am leaving that turned off for this post, and just re-sorting updates to the top of the feed. In the future, who knows?)</p>
   <p>There's lots, lots more to explore in this vein. Do read <a href="https://v5.chriskrycho.com/essays/feeds-are-not-fit-for-gardening/">Chris Krycho's post</a>. But this, I hope, is a start.</p>
  </div>
 </div>
 <div class="entry-footer">
  <div class="post-metainfo">
   <a href="2024/04/09/names-too-on-the-nose/index.html">01:15 AM EDT</a>
   <div class="updated-note">
    <a href="2024/04/09/names-too-on-the-nose/index.html#major-updates">Last major update at 2024-06-01 @ 11:40 PM EDT</a>
   </div>
  </div>
 </div>
</article>
<div class="after-article">
</div><!-- after-article --><div class="entry-separator"></div><div class="day-stamp">
 2024-03-27 <span class="arrow">⇒</span>
</div>
<article class="presentation-multiple">
 <div class="entry-header">
  <h1><a href="2024/03/27/tar-or-tgz/index.html">tar or tgz?</a></h1>
  <hr class="below-title">
 </div>
 <div class="entry-body">
  <div class="flexmark markdown">
   <p>A thing I've done over the last while is automate a lot of my sysadmin, using <code>systemd</code> timers to hit <a href="https://scala-cli.virtuslab.org/">scala-cli</a> scripts.</p>
   <p>I've built for myself a <a href="https://github.com/swaldman/mchange-sysadmin-scala/tree/main?tab=readme-ov-file">little framework</a> that is incredibly in need of documentation, but that lets me define scripts very flexibly and can provide great step-by-step information about what happens and anything that goes wrong in brightly colored HTML e-mails. I love it.</p>
   <p>Much of what I do is back things up to a cloud service using <a href="https://rclone.org/">rclone</a>.</p>
   <p>Last night I wrote a <a href="https://github.com/swaldman/mchange-sysadmin-scripts/blob/main/taskbin/backup-directory-as-tar">script</a> just to back up some directory. I ran into what I consider an age-old dilemma.</p>
   <p>Sometime early in my geekish career, I picked up the nugget that its best to keep important backups as straight <code>tar</code> files rather than <code>tgz</code> (or <code>tbz</code> or whatever), because if some bit gets corrupted, most of a straight <code>tar</code> will remain recoverable, while the compressed archive will just be toast.</p>
   <p>Is that right? Is it a real concern? I don't think I've ever experienced a corrupted archive, <code>tar</code> or <code>tgz</code>, but of course backup is a form of insurance, the whole point is to be resilient to tail risks.</p>
   <p>Still, searching the interwebs, I don't see a lot of people recommending uncompressed archives. Space is more of a bottleneck to me than CPU or time, so if the resilience advantage isn't significant, I'd compress.</p>
   <p>What do you think?</p>
   <hr>
   <p><strong>Update:</strong> Feel free to comment <a href="https://zirk.us/@interfluidity/112168423434044308">here</a></p>
  </div>
 </div>
 <div class="entry-footer">
  <div class="post-metainfo">
   <a href="2024/03/27/tar-or-tgz/index.html">10:55 AM EDT</a>
  </div>
 </div>
</article>
<div class="after-article">
</div><!-- after-article --><div class="entry-separator"></div><div class="day-stamp">
 2024-03-18 <span class="arrow">⇒</span>
</div>
<article class="presentation-multiple uid-c3p0-and-loom">
 <div class="entry-header">
  <h1><a href="2024/03/18/c3p0-and-loom/index.html">c3p0 and loom</a></h1>
  <hr class="below-title">
 </div>
 <div class="entry-body">
  <div class="flexmark markdown">
   <p>I write <a href="https://github.com/swaldman">a lot of open source software</a>, but I've only ever really had one "hit". That makes me pretty sad, actually. I think some of what I've written is pretty great, and it's lonesome to be the sole user.</p>
   <p>Nevertheless, my one "hit" was <a href="https://www.mchange.com/projects/c3p0/">c3p0</a>, a JDBC Connection pool that, in its day, was extremely popular in Java web application stacks.</p>
   <p>Its day was a long time ago, though! c3p0 was first released <a href="https://sourceforge.net/projects/c3p0/files/historical/OldFiles/">on Sourceforge in 2001</a>, and was very widely used from the mid aughts through the early 2010s.</p>
   <p>c3p0 is "mature" software, and I have just let it alone for years at a time. But I do continue to use it in all of my own database projects. Periodically I still put it (and myself) through intense bouts of maintenance.</p>
   <p>Actually, I have hated my years-long lapses (and myself) because github issues collect and I get snarky comments about abandonware and I feel like I am a Very Bad Maintainer. So the first order of business in my most recent "sprint" (isn't that what the kids call it?) was to move c3p0 from a very bespoke and manual <a href="https://ant.apache.org/">ant</a> build to something sleek and modern and automatic, so that maybe I wouldn't put off maintenance into years-delayed batches just because it is annoying to touch. c3p0's new <a href="https://mill-build.com/mill/Intro_to_Mill.html">mill build</a> works beautifully.</p>
   <p>The new build is much lighter, and the modern style of just publishing git repositories rather than source distributions and uploading releases to Sonatype is fast and easy. I think it'll really improve my maintenance promptness.</p>
   <p>c3p0's latest release, <a href="https://github.com/swaldman/c3p0/blob/0.10.x/RELEASE_NOTES-c3p0-0.10.0">0.10.0</a>, includes lots of enhancements and improvements. But a really fun thing was to integrate the very latest shiny new thing in Java — "Project Loom" <a href="https://docs.oracle.com/en/java/javase/21/core/virtual-threads.html">virtual threads</a> — into this very old, highly concurrent library.</p>
   <p>c3p0 is very old school. It was initially written in Java 1.2 or 1.3. Java's standard concurrency utilities, the <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/package-summary.html"><code>java.util.concurrent</code></a> package, did not yet exist. There were no standard thread pools defined as <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/Executors.html"><code>ExecutorService</code> implementations</a>. So I <a href="https://github.com/swaldman/mchange-commons-java/blob/master/src/main/java/com/mchange/v2/async/ThreadPoolAsynchronousRunner.java">rolled my own</a>. c3p0 relies entirely on the JVM's built-in primitives — monitors and <code>synchronized</code> blocks, <code>wait()</code> and <code>notifyAll()</code> — to manage concurrency.</p>
   <p>Over the years, people have requested that c3p0 support asynchroneity via pluggable <code>Executor</code> instances, rather than just its own, hand-rolled thread pool. Users mostly seemed to want this so c3p0 could share existing application thread pools, avoiding the resource footprint of several c3p0-dedicated threads.</p>
   <p>A couple of weeks ago, I finally got around to implementing <a href="https://www.mchange.com/projects/c3p0/#configuring_threading">pluggable threading</a>. Sharing application thread pools is now supported. But I was mostly motivated by curiousity about how well this very old library would work with newfangled loom virtual threads.</p>
   <p>Great, it turns out!</p>
   <ul>
    <li>
     <p>I was concerned, since c3p0 relies so much on monitors and <code>synchronized</code> blocks, that virtual threads would be "pinned". Virtual threads are scheduled to, and deschedule from, "carrier" operating-system threads, but they cannot be descheduled while they hold a monitor. If a thread blocks while holding a monitor, it is described as "pinned", and that's a bad thing.</p>
     <p>But c3p0 is very careful not to perform potentially blocking operations while holding a monitor. Running tests with</p>
     <pre><code class="language-plaintext">-Djdk.tracePinnedThreads=full
</code></pre>
     <p>produced no stack traces of pinned threads, even under heavy load. This was gratifying.</p></li>
    <li>
     <p>Using virtual threads rather than a thread pool can reduce contention for monitors. The thread pool itself is a site of contention, as information about which threads are pooled and which are available to run tasks constitute shared, mutable state. Replacing a thread pool with simply firing and forgetting a virtual thread for each asynchrnous task left nothing to contend for. <a href="https://github.com/swaldman/c3p0-loom"><code>c3p0-loom</code></a> includes two implementations of <a href="https://www.mchange.com/projects/c3p0/apidocs/com/mchange/v2/c3p0/TaskRunnerFactory.html"><code>TaskRunnerFactory</code></a>:</p>
     <ul>
      <li><a href="https://github.com/swaldman/c3p0-loom/blob/main/src/com/mchange/v2/c3p0/loom/UninstrumentedVirtualThreadPerTaskTaskRunnerFactory.java"><code>com.mchange.v2.c3p0.loom.UninstrumentedVirtualThreadPerTaskTaskRunnerFactory</code></a></li>
      <li><a href="https://github.com/swaldman/c3p0-loom/blob/main/src/com/mchange/v2/c3p0/loom/VirtualThreadPerTaskExecutorTaskRunnerFactory.java"><code>com.mchange.v2.c3p0.loom.VirtualThreadPerTaskExecutorTaskRunnerFactory</code></a></li>
     </ul>
     <p><code>com.mchange.v2.c3p0.loom.VirtualThreadPerTaskExecutorTaskRunnerFactory</code> tracks the number of simultaneously active threads (which you can observe via JMX), which involve synchronizing on a monitor so some contention is still possible.</p>
     <p>But with <code>com.mchange.v2.c3p0.loom.UninstrumentedVirtualThreadPerTaskTaskRunnerFactory</code>, nothing at all is tracked and no monitors are acquired. Some analog of contention might result from managing shared state within the loom virtual-threading runtime, but all overt contention for thread-pool monitors is eliminated.</p></li>
   </ul>
   <p>In practice, the thread pool is not c3p0's main site of monitor contention, however.</p>
   <p>c3p0's <a href="https://github.com/swaldman/c3p0/blob/0.10.x/src/com/mchange/v2/resourcepool/BasicResourcePool.java">resource pool</a> is its main site of monitor contention. For most applications, the contention overhead is negligible, when amortized over <code>Connection</code> operations. But in rare cases, when very large numbers of threads are hitting the pool, contention can become an issue. For now, the only way to address contention at the resource pool is to construct multiple <code>DataSource</code> instances and balance the load across them.</p>
   <p>In any case, c3p0 and loom work very well together!</p>
   <p>I still recommend that applications start by using c3p0's default, hand-rolled thread pool. It implements deadlock detection and recovery, and logs verbose debugging information about what happened. This makes it very easy to diagnose what kinds of operations have been hanging and consuming threads when something goes wrong.</p>
   <p>Under loom, applications that might otherwise have logged flamboyant thread-pool problems will proceed gracefully for some time. No matter what operations hang, new (virtual) threads will always be available for the next request, and the memory footprint of the frozen "fibers" (rather than full threads) should be modest.</p>
   <p>But if <code>Connection</code> acquisition, <code>Connection</code> destruction, or <code>Statement</code> destruction tasks do hang, eventually the pool will become exhausted and your application will hang or fail, despite the almost inexhaustible virtual threads.</p>
   <p>I'd start by using c3p0's default, battle-tested thread pool to detect these kinds of issues, and log them with its signature, much-hated <code>APPARENT DEADLOCK</code> messages if they occur. Those very ugly <code>APPARENT DEADLOCK</code> messages make it very easy to figure out just what is going wrong.</p>
   <p>But once your application is stable, then you might absolutely consider setting</p>
   <pre><code class="language-plaintext">c3p0.taskRunnerFactoryClassName=com.mchange.v2.c3p0.loom.UninstrumentedVirtualThreadPerTaskTaskRunnerFactory
</code></pre>
   <p>to reduce monitor contention and eliminate the overhead of a dedicated c3p0 thread pool.</p>
   <hr>
   <p><strong>Note:</strong></p>
   <p>The latest version of c3p0 (as of this writing) is <code>0.10.0</code>. Ordinarily, you'd hit that at Maven Central as</p>
   <ul>
    <li><code>com.mchange:c3p0:0.10.0</code></li>
   </ul>
   <p>But c3p0 is built under older Java version, to support old applications. (c3p0-0.10.0 supports JVMs as old as Java 7.)</p>
   <p>Loom support has to be built under Java 21+, so it is built separately. Just hit</p>
   <ul>
    <li><code>com.mchange:c3p0-loom:0.10.0</code></li>
   </ul>
   <p>at Maven Central. That will bring in the loom implementations, and the rest of c3p0 as a transitive dependency.</p>
  </div>
 </div>
 <div class="entry-footer">
  <div class="post-metainfo">
   <a href="2024/03/18/c3p0-and-loom/index.html">10:20 PM EDT</a>
  </div>
 </div>
</article>
<div class="after-article">
</div><!-- after-article --><div class="entry-separator"></div><div class="day-stamp">
 2024-02-06 <span class="arrow">⇒</span>
</div>
<article class="presentation-multiple">
 <div class="entry-header">
  <h1><a href="2024/02/06/what-does-private-mean-at-package-level-in-scala-3/index.html">What does private mean at package level in Scala 3?</a></h1>
  <hr class="below-title">
 </div>
 <div class="entry-body">
  <div class="flexmark markdown">
   <p><strong>TL; DR:</strong></p>
   <ul>
    <li><code>private</code> declarations at a top-level scope of a package in Scala 3 are equivalent to a <code>private[pkg]</code> in other contexts.</li>
    <li>They are accessible to everything within the package and its subpackages, but nothing else.</li>
   </ul>
   <hr>
   <p>In Scala 2, to place a declaration at the "package" level, one would define a "package object":</p>
   <pre><code class="language-scala">package top

package object pkg {
  private val Hush = 0
  val Loud = Int.MaxValue
}
</code></pre>
   <p>Given this</p>
   <ul>
    <li>one might refer to <code>Loud</code> from anywhere with fully-qualified name <code>top.pkg.Loud</code></li>
    <li><code>import top.pkg._</code> would pick it up</li>
    <li>inside the package <code>top.pkg</code> one coul refer to it simply as <code>Loud</code></li>
   </ul>
   <p>So far, so intuitive.</p>
   <p>In Scala 2, the semantics of <code>private val Loud</code> was also intuitive. A <code>package object</code> is just an <code>object</code>. A <code>private</code> member of an <code>object</code> is only visible within that <code>object</code>'s scope. While the Scala compiler does some magic to make nonprivate declarations more broadly visible, access to <code>private</code> members of the <code>package object</code> was restricted to the <code>object</code> in the ordinary way.</p>
   <p>But Scala 3 introduces "naked" top-level declarations, which I find I use constantly.</p>
   <p>So the declarations above might translate to:</p>
   <pre><code class="language-scala">package top.pkg

private val Hush = 0
val Loud = Int.MaxValue
</code></pre>
   <p>There is no <code>object</code> scope! So what does private even mean in this context.</p>
   <p>I could imagine four possibilities:</p>
   <ol>
    <li><code>private</code> to a virtual object scope constituted of all top-level declaraions</li>
    <li><code>private</code> to the top-level of the current compilation unit (i.e. file)</li>
    <li><code>private</code> to the current compilation unit (including nested scopes)</li>
    <li><code>private</code> to the package as a whole, i.e. the same as <code>private[pkg]</code></li>
   </ol>
   <p>Playing around, it looks like #4 is the winner.</p>
   <p>A <code>private</code> top-level declaration seems visible to any code in the package, even if defined in other files or directories. It is visible from anywhere in the <code>pkg</code> or subpackages of <code>pkg</code>.</p>
   <p>So now I know! And so do you!</p>
  </div>
 </div>
 <div class="entry-footer">
  <div class="post-metainfo">
   <a href="2024/02/06/what-does-private-mean-at-package-level-in-scala-3/index.html">05:50 PM EST</a>
  </div>
 </div>
</article>
<div class="after-article">
</div><!-- after-article -->
      </div>
      <div id="right-sidebar">
      </div>
    </div>
  </body>
</html>
